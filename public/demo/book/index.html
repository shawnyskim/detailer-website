<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Your Detail - DetailerStack</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --obsidian-300: #a8a8a8;
      --obsidian-400: #737373;
      --obsidian-500: #525252;
      --obsidian-600: #404040;
      --obsidian-700: #303030;
      --obsidian-800: #1f1f1f;
      --obsidian-900: #141414;
      --obsidian-950: #0a0a0a;
      --champagne-400: #d4b896;
      --champagne-500: #c9a66b;
      --champagne-600: #b8935a;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--obsidian-950);
      color: #fff;
      line-height: 1.6;
      min-height: 100vh;
    }

    .font-display { font-family: 'Oswald', sans-serif; font-weight: 500; }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--obsidian-900);
      border-bottom: 1px solid var(--obsidian-800);
      padding: 1rem 1.5rem;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--champagne-400), var(--champagne-600));
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      color: var(--obsidian-950);
    }

    .logo-text {
      font-family: 'Oswald', sans-serif;
      font-size: 1.25rem;
      letter-spacing: 0.15em;
    }

    .logo-text span:first-child { color: #fff; }
    .logo-text span:last-child { color: var(--champagne-400); }

    .back-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--obsidian-400);
      text-decoration: none;
      font-size: 0.875rem;
      transition: color 0.2s;
    }

    .back-link:hover { color: #fff; }

    /* Main Layout */
    .main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem 8rem;
      display: grid;
      gap: 2rem;
    }

    @media (min-width: 1024px) {
      .main {
        grid-template-columns: 1fr 360px;
        padding-bottom: 4rem;
      }
    }

    /* Progress Steps */
    .progress {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1.5rem 0;
      overflow-x: auto;
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      min-width: 60px;
    }

    .progress-icon {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--obsidian-800);
      border: 2px solid var(--obsidian-700);
      color: var(--obsidian-500);
      transition: all 0.3s;
    }

    .progress-step.active .progress-icon {
      background: var(--champagne-500);
      border-color: var(--champagne-500);
      color: var(--obsidian-950);
    }

    .progress-step.completed .progress-icon {
      background: var(--obsidian-800);
      border-color: var(--champagne-500);
      color: var(--champagne-500);
    }

    .progress-step.clickable {
      cursor: pointer;
    }

    .progress-step.clickable .progress-icon:hover {
      transform: scale(1.1);
      box-shadow: 0 0 0 3px rgba(201, 166, 107, 0.2);
    }

    .progress-label {
      font-size: 0.75rem;
      color: var(--obsidian-500);
      text-align: center;
      display: none;
    }

    @media (min-width: 640px) {
      .progress-label { display: block; }
    }

    .progress-step.active .progress-label { color: var(--champagne-500); }
    .progress-step.completed .progress-label { color: var(--obsidian-300); }

    .progress-line {
      width: 40px;
      height: 2px;
      background: var(--obsidian-700);
      margin-bottom: 1.5rem;
    }

    .progress-line.completed { background: var(--champagne-500); }

    @media (min-width: 640px) {
      .progress-line { width: 60px; }
    }

    /* Step Content */
    .step-content { display: none; }
    .step-content.active { display: block; }

    .step-title {
      font-family: 'Oswald', sans-serif;
      font-size: 1.75rem;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .step-subtitle {
      color: var(--obsidian-400);
      margin-bottom: 2rem;
    }

    /* Service Cards */
    .service-card {
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-800);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .service-card:hover { border-color: var(--obsidian-600); }
    .service-card.selected { border-color: var(--champagne-500); background: rgba(201, 166, 107, 0.05); }

    .service-card-header {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }

    .service-icon {
      width: 48px;
      height: 48px;
      background: var(--obsidian-800);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--obsidian-400);
      flex-shrink: 0;
    }

    .service-card.selected .service-icon {
      background: var(--champagne-500);
      color: var(--obsidian-950);
    }

    .service-info { flex: 1; }

    .service-name-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.25rem;
    }

    .service-name {
      font-weight: 600;
      font-size: 1rem;
    }

    .service-badge {
      padding: 0.125rem 0.5rem;
      background: var(--champagne-500);
      color: var(--obsidian-950);
      font-size: 0.625rem;
      font-weight: 600;
      border-radius: 4px;
      text-transform: uppercase;
    }

    .service-desc {
      color: var(--obsidian-400);
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    .service-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--obsidian-500);
      font-size: 0.8rem;
    }

    .service-price {
      color: var(--champagne-500);
      font-weight: 600;
      font-size: 1.125rem;
    }

    .service-radio {
      width: 24px;
      height: 24px;
      border: 2px solid var(--obsidian-600);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .service-card.selected .service-radio {
      border-color: var(--champagne-500);
      background: var(--champagne-500);
    }

    .service-radio::after {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--obsidian-950);
      border-radius: 50%;
      opacity: 0;
    }

    .service-card.selected .service-radio::after { opacity: 1; }

    /* Expandable Details */
    .service-expand-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      color: var(--champagne-500);
      font-size: 0.8rem;
      font-weight: 500;
      background: rgba(201, 166, 107, 0.08);
      border: 1px solid rgba(201, 166, 107, 0.2);
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
      padding: 0.625rem 1rem;
      width: 100%;
      transition: all 0.2s ease;
    }

    .service-expand-btn:hover {
      background: rgba(201, 166, 107, 0.15);
      border-color: rgba(201, 166, 107, 0.4);
    }

    .service-expand-btn:active {
      transform: scale(0.98);
    }

    .service-expand-btn svg {
      transition: transform 0.2s;
    }

    .service-card.expanded .service-expand-btn {
      background: rgba(201, 166, 107, 0.12);
      border-color: rgba(201, 166, 107, 0.3);
    }

    .service-card.expanded .service-expand-btn svg {
      transform: rotate(180deg);
    }

    .service-details {
      display: none;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--obsidian-800);
    }

    .service-card.expanded .service-details { display: block; }

    .service-features {
      list-style: none;
      display: grid;
      gap: 0.5rem;
    }

    .service-features li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--obsidian-300);
    }

    .service-features li::before {
      content: '';
      width: 6px;
      height: 6px;
      background: var(--champagne-500);
      border-radius: 50%;
    }

    /* Vehicle Type Cards */
    .vehicle-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .vehicle-card {
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-800);
      border-radius: 8px;
      padding: 1.25rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .vehicle-card:hover { border-color: var(--obsidian-600); }
    .vehicle-card.selected { border-color: var(--champagne-500); }

    .vehicle-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .vehicle-name { font-weight: 600; font-size: 0.95rem; }

    .vehicle-price {
      font-size: 0.8rem;
      color: var(--obsidian-400);
    }

    .vehicle-card.selected .vehicle-check {
      color: var(--champagne-500);
    }

    /* Form Inputs */
    .form-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .form-group { margin-bottom: 1rem; }

    .form-label {
      display: block;
      font-size: 0.875rem;
      color: var(--obsidian-400);
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-700);
      border-radius: 6px;
      color: #fff;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--champagne-500);
    }

    .form-input::placeholder { color: var(--obsidian-500); }

    /* Add-ons */
    .addons-title {
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .addon-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-800);
      border-radius: 8px;
      padding: 1rem 1.25rem;
      margin-bottom: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .addon-card:hover { border-color: var(--obsidian-600); }
    .addon-card.selected { border-color: var(--champagne-500); background: rgba(201, 166, 107, 0.05); }

    .addon-name { font-weight: 500; }

    .addon-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .addon-price { color: var(--champagne-500); font-weight: 500; }

    .addon-check {
      width: 22px;
      height: 22px;
      border: 2px solid var(--obsidian-600);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: transparent;
    }

    .addon-card.selected .addon-check {
      background: var(--champagne-500);
      border-color: var(--champagne-500);
      color: var(--obsidian-950);
    }

    /* Calendly-Style Calendar & Time Selection */
    .datetime-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    @media (min-width: 768px) {
      .datetime-container {
        flex-direction: row;
        gap: 0;
      }
    }

    /* Calendar Section */
    .calendar-section {
      flex: 1;
    }

    .calendar-section-title {
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      margin-bottom: 1rem;
    }

    .calendar-container {
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-800);
      border-radius: 12px;
      padding: 1.25rem;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }

    .calendar-month-year {
      font-weight: 600;
      font-size: 1rem;
      color: #fff;
      min-width: 140px;
      text-align: center;
    }

    .calendar-nav-btn {
      width: 32px;
      height: 32px;
      background: transparent;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--obsidian-400);
      transition: all 0.2s;
    }

    .calendar-nav-btn:hover {
      background: var(--obsidian-800);
      color: #fff;
    }

    .calendar-nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-bottom: 0.5rem;
    }

    .calendar-weekday {
      text-align: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--obsidian-500);
      padding: 0.5rem 0;
      text-transform: uppercase;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: 50%;
      cursor: default;
      transition: all 0.15s;
      position: relative;
      color: var(--obsidian-600);
    }

    .calendar-day.available {
      color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
      cursor: pointer;
      font-weight: 600;
    }

    .calendar-day.available:hover {
      background: rgba(59, 130, 246, 0.2);
    }

    .calendar-day.today::after {
      content: '';
      position: absolute;
      bottom: 3px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 4px;
      background: currentColor;
      border-radius: 50%;
    }

    .calendar-day.selected {
      background: #3b82f6 !important;
      color: #fff !important;
    }

    .calendar-day.selected::after {
      display: none;
    }

    .calendar-day.unavailable {
      color: var(--obsidian-700);
    }

    /* Time Panel - Desktop Side */
    .time-panel {
      display: none;
      flex: 0 0 280px;
      padding-left: 1.5rem;
      border-left: 1px solid var(--obsidian-800);
    }

    @media (min-width: 768px) {
      .time-panel {
        display: flex;
        flex-direction: column;
      }

      .time-panel:not(.has-date) {
        opacity: 0.4;
        pointer-events: none;
      }

      .time-panel:not(.has-date) .time-slots-list {
        display: none;
      }
    }

    .time-panel-header {
      margin-bottom: 1rem;
    }

    .time-panel-date {
      font-weight: 600;
      font-size: 1rem;
      color: #fff;
      margin-bottom: 0.75rem;
    }

    .time-panel-availability {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: var(--obsidian-400);
    }

    .availability-dot {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
    }

    .time-slots-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-height: 340px;
      overflow-y: auto;
    }

    .time-slot-row {
      display: flex;
      gap: 0.5rem;
    }

    .time-slot {
      flex: 1;
      padding: 0.875rem 1rem;
      background: transparent;
      border: 1px solid var(--obsidian-600);
      border-radius: 6px;
      text-align: center;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.875rem;
      color: #3b82f6;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .time-slot::before {
      content: '';
      width: 6px;
      height: 6px;
      background: #22c55e;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .time-slot:hover {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
    }

    .time-slot.selected {
      background: var(--obsidian-700);
      border-color: var(--obsidian-600);
      color: #fff;
    }

    .time-slot.selected::before {
      display: none;
    }

    .time-slot-next {
      flex: 0 0 auto;
      padding: 0.875rem 1.25rem;
      background: #3b82f6;
      border: none;
      border-radius: 6px;
      color: #fff;
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.15s;
      display: none;
    }

    .time-slot-next.visible {
      display: block;
    }

    .time-slot-next:hover {
      background: #2563eb;
    }

    /* Mobile Time View */
    .mobile-time-view {
      display: none;
      background: var(--obsidian-950);
      padding-top: 0.5rem;
    }

    .mobile-time-view.visible {
      display: block;
    }

    .mobile-time-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .mobile-back-btn {
      width: 40px;
      height: 40px;
      background: var(--obsidian-800);
      border: 1px solid var(--obsidian-700);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--obsidian-400);
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .mobile-back-btn:hover {
      background: var(--obsidian-700);
      color: #fff;
    }

    .mobile-time-info {
      flex: 1;
    }

    .mobile-time-day {
      font-weight: 600;
      font-size: 1.1rem;
      color: #fff;
    }

    .mobile-time-date {
      font-size: 0.85rem;
      color: var(--obsidian-400);
    }

    .mobile-time-section-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #fff;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--obsidian-800);
    }

    .mobile-time-availability {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: var(--obsidian-400);
      margin-bottom: 1rem;
    }

    .mobile-time-grid {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    /* Desktop shows time panel, mobile hides it */
    @media (max-width: 767px) {
      .calendar-section.hidden-mobile {
        display: none;
      }

      .time-panel {
        display: none !important;
      }

      .datetime-container {
        display: block;
      }

      /* Hide step title/subtitle when in mobile time view */
      .mobile-time-view.visible ~ .step-title,
      .mobile-time-view.visible ~ .step-subtitle {
        display: none;
      }
    }

    @media (min-width: 768px) {
      .mobile-time-view {
        display: none !important;
      }
    }

    /* Legacy Date/Time Section styles (keeping for backwards compat) */
    .date-section { margin-bottom: 2rem; }
    .date-label { font-weight: 500; margin-bottom: 1rem; }
    .time-section { display: none; }
    .time-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }

    /* Location Cards */
    .location-card {
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-800);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .location-card:hover { border-color: var(--obsidian-600); }
    .location-card.selected { border-color: var(--champagne-500); }

    .location-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .location-address {
      color: var(--obsidian-400);
      font-size: 0.875rem;
    }

    /* Booking Summary */
    .summary {
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-800);
      border-radius: 12px;
      padding: 1.5rem;
      position: sticky;
      top: 100px;
    }

    .summary-title {
      font-family: 'Oswald', sans-serif;
      font-size: 1.25rem;
      letter-spacing: 0.05em;
      margin-bottom: 1.5rem;
    }

    .summary-empty {
      color: var(--obsidian-500);
      font-size: 0.875rem;
      padding: 1rem 0;
    }

    .summary-items { margin-bottom: 1.5rem; }

    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      font-size: 0.9rem;
    }

    .summary-item-name { color: var(--obsidian-300); }
    .summary-item-price { color: #fff; }
    .summary-item.addon .summary-item-name { color: var(--obsidian-400); font-size: 0.85rem; }

    .summary-divider {
      height: 1px;
      background: var(--obsidian-800);
      margin: 1rem 0;
    }

    .summary-total {
      display: flex;
      justify-content: space-between;
      font-weight: 600;
    }

    .summary-total-price {
      color: var(--champagne-500);
      font-size: 1.25rem;
    }

    .summary-trust {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--obsidian-800);
    }

    .trust-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: var(--obsidian-400);
      margin-bottom: 0.5rem;
    }

    .trust-item svg { color: var(--champagne-500); width: 16px; height: 16px; }

    /* Anchored Bottom Bar (all devices) */
    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--obsidian-900);
      border-top: 1px solid var(--obsidian-800);
      padding: 1rem 1.5rem;
      z-index: 40;
      transition: all 0.3s ease;
    }

    .bottom-bar.hidden {
      transform: translateY(100%);
    }

    .bottom-bar-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .bottom-bar .btn-continue {
      flex-shrink: 0;
    }

    @media (max-width: 640px) {
      .bottom-bar {
        padding: 1rem;
        overflow: hidden;
      }
      .bottom-bar-content {
        width: 100%;
      }
      .bottom-bar .btn-continue {
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
        flex-shrink: 1;
        min-width: 0;
      }
    }

    .bottom-bar-info {
      cursor: pointer;
    }

    .bottom-bar-label {
      font-size: 0.75rem;
      color: var(--obsidian-400);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .bottom-bar-price {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--champagne-500);
    }

    /* Hide sidebar summary on mobile, show on desktop */
    @media (max-width: 1023px) {
      .summary { display: none; }
    }

    /* Mobile Drawer */
    .mobile-drawer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--obsidian-900);
      border-top: 1px solid var(--obsidian-700);
      border-radius: 16px 16px 0 0;
      padding: 1rem 1.5rem 6rem;
      z-index: 45;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      max-height: 70vh;
      overflow-y: auto;
    }

    .mobile-drawer.open {
      transform: translateY(0);
    }

    .mobile-drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 0.75rem;
      margin-bottom: 0.75rem;
      border-bottom: 1px solid var(--obsidian-800);
      cursor: pointer;
    }

    .mobile-drawer-title {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      letter-spacing: 0.05em;
    }

    .mobile-drawer-close {
      width: 24px;
      height: 24px;
      color: var(--obsidian-400);
    }

    .mobile-drawer-content {
      font-size: 0.875rem;
    }

    .mobile-drawer-item {
      display: flex;
      justify-content: space-between;
      padding: 0.375rem 0;
    }

    .mobile-drawer-item-name {
      color: var(--obsidian-300);
    }

    .mobile-drawer-item-price {
      color: #fff;
    }

    .mobile-drawer-item.addon .mobile-drawer-item-name {
      color: var(--obsidian-400);
      font-size: 0.8rem;
      padding-left: 0.5rem;
    }

    /* Mobile Overlay */
    .mobile-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 35;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .mobile-overlay.active {
      display: block;
      opacity: 1;
    }

    /* Navigation */
    .nav-buttons {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 2rem;
      margin-top: 2rem;
      border-top: 1px solid var(--obsidian-800);
    }

    .btn-back {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--obsidian-400);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.75rem 0;
      transition: color 0.2s;
    }

    .btn-back:hover { color: #fff; }

    .btn-continue {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 2rem;
      background: linear-gradient(135deg, var(--champagne-500), var(--champagne-600));
      color: var(--obsidian-950);
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .btn-continue:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(201, 166, 107, 0.3);
    }

    .btn-continue:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Urgency Banner */
    .urgency-banner {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #fca5a5;
    }

    .urgency-banner svg { color: #ef4444; }

    /* Contact Form */
    .contact-grid {
      display: grid;
      gap: 1rem;
    }

    @media (min-width: 640px) {
      .contact-grid { grid-template-columns: repeat(2, 1fr); }
    }

    /* Payment Section */
    .payment-info {
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-800);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .payment-total {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .payment-total-label {
      color: var(--obsidian-400);
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    .payment-total-amount {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--champagne-500);
    }

    .payment-methods {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .payment-method {
      padding: 0.75rem 1.5rem;
      background: var(--obsidian-800);
      border: 1px solid var(--obsidian-700);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .payment-method.selected {
      border-color: var(--champagne-500);
      background: rgba(201, 166, 107, 0.1);
    }

    /* Success State */
    .success-screen {
      display: none;
      text-align: center;
      padding: 3rem 1rem;
    }

    .success-screen.active { display: block; }

    .success-icon {
      width: 80px;
      height: 80px;
      background: var(--champagne-500);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 2rem;
    }

    .success-icon svg { width: 40px; height: 40px; color: var(--obsidian-950); }

    .success-title {
      font-family: 'Oswald', sans-serif;
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .success-message {
      color: var(--obsidian-400);
      margin-bottom: 2rem;
    }

    /* Congrats Overlay */
    .congrats-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }

    .congrats-overlay.active {
      display: flex;
    }

    .congrats-content {
      text-align: center;
      padding: 2rem;
      animation: congratsFadeIn 0.5s ease-out;
    }

    @keyframes congratsFadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .congrats-icon {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 auto 2rem;
    }

    .congrats-circle {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--champagne-400), var(--champagne-600));
      animation: congratsPulse 1.5s ease-out infinite;
    }

    @keyframes congratsPulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    .congrats-icon svg {
      position: relative;
      z-index: 1;
      width: 50px;
      height: 50px;
      color: var(--obsidian-950);
      margin-top: 25px;
    }

    .congrats-title {
      font-family: 'Oswald', sans-serif;
      font-size: 2.5rem;
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
      color: #fff;
    }

    .congrats-message {
      color: var(--obsidian-400);
      font-size: 1.1rem;
      margin-bottom: 2rem;
      max-width: 400px;
    }

    .congrats-btn {
      font-size: 1.1rem;
      padding: 1rem 2rem;
    }

    /* Confetti animation */
    .confetti {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
    }

    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--champagne-500);
      animation: confettiFall 3s ease-out forwards;
    }

    @keyframes confettiFall {
      0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /* Purchased Services List */
    .purchased-service-card {
      background: var(--obsidian-900);
      border: 2px solid var(--obsidian-700);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .purchased-service-card:hover {
      border-color: var(--obsidian-600);
    }

    .purchased-service-card.selected {
      border-color: var(--champagne-500);
      background: rgba(201, 166, 107, 0.1);
    }

    .purchased-service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .purchased-service-name {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .purchased-service-check {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--obsidian-600);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .purchased-service-card.selected .purchased-service-check {
      background: var(--champagne-500);
      border-color: var(--champagne-500);
    }

    .purchased-service-check svg {
      width: 14px;
      height: 14px;
      color: var(--obsidian-950);
      opacity: 0;
    }

    .purchased-service-card.selected .purchased-service-check svg {
      opacity: 1;
    }

    .purchased-service-details {
      font-size: 0.875rem;
      color: var(--obsidian-400);
    }

    .purchased-service-scheduled {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--obsidian-800);
      font-size: 0.85rem;
      color: var(--champagne-500);
    }

    .purchased-service-scheduled svg {
      width: 16px;
      height: 16px;
    }

    /* Multiple Service Selection - Checkbox Style */
    .service-checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid var(--obsidian-600);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .service-card.selected .service-checkbox {
      border-color: var(--champagne-500);
      background: var(--champagne-500);
    }

    .service-checkbox svg {
      width: 14px;
      height: 14px;
      color: var(--obsidian-950);
      opacity: 0;
    }

    .service-card.selected .service-checkbox svg {
      opacity: 1;
    }

    /* Service Add Button */
    .service-add-btn {
      display: none;
      padding: 0.5rem 1rem;
      background: var(--champagne-500);
      color: var(--obsidian-950);
      border: none;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-left: auto;
    }

    .service-card.selected .service-add-btn {
      display: block;
    }

    .service-add-btn:hover {
      background: var(--champagne-400);
    }

    /* Bundle Pricing */
    .service-price-container {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.125rem;
    }

    .service-price-original {
      color: var(--obsidian-500);
      font-size: 0.875rem;
      text-decoration: line-through;
    }

    .service-price-bundle {
      color: #22c55e;
      font-weight: 600;
      font-size: 1.125rem;
    }

    .service-bundle-badge {
      background: #22c55e;
      color: #fff;
      padding: 0.125rem 0.5rem;
      font-size: 0.625rem;
      font-weight: 600;
      border-radius: 4px;
      text-transform: uppercase;
      margin-left: 0.5rem;
    }

    /* Bundle Upsell Popup */
    .bundle-upsell-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .bundle-upsell-overlay.active {
      display: flex;
    }

    .bundle-upsell-popup {
      background: var(--obsidian-900);
      border: 1px solid var(--obsidian-700);
      border-radius: 12px;
      max-width: 420px;
      width: 100%;
      padding: 2rem;
      animation: popupSlideIn 0.3s ease-out;
    }

    @keyframes popupSlideIn {
      from { opacity: 0; transform: translateY(20px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .bundle-upsell-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .bundle-upsell-save {
      display: inline-block;
      background: #22c55e;
      color: #fff;
      padding: 0.375rem 1rem;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .bundle-upsell-title {
      font-family: 'Oswald', sans-serif;
      font-size: 1.75rem;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
      color: #fff;
    }

    .bundle-upsell-subtitle {
      color: var(--obsidian-400);
      font-size: 0.95rem;
    }

    .bundle-upsell-pricing {
      background: var(--obsidian-800);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .bundle-upsell-service-name {
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #fff;
    }

    .bundle-upsell-prices {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    .bundle-old-price {
      font-size: 1.25rem;
      color: var(--obsidian-500);
      text-decoration: line-through;
    }

    .bundle-arrow {
      color: var(--obsidian-500);
    }

    .bundle-new-price {
      font-size: 1.5rem;
      font-weight: 700;
      color: #22c55e;
    }

    .bundle-savings {
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: #22c55e;
    }

    .bundle-upsell-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .bundle-add-btn {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .bundle-add-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }

    .bundle-skip-btn {
      width: 100%;
      padding: 0.875rem;
      background: transparent;
      color: var(--obsidian-400);
      border: 1px solid var(--obsidian-700);
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .bundle-skip-btn:hover {
      color: #fff;
      border-color: var(--obsidian-500);
    }

    /* Responsive - Mobile First Optimizations */
    /* Medium mobile devices (iPhone 12/13/14, Pixel, Galaxy S) - 390-414px */
    @media (max-width: 640px) {
      .form-row { grid-template-columns: 1fr; }
      .vehicle-grid { grid-template-columns: 1fr; }

      /* Header compact */
      .header {
        padding: 0.75rem 1rem;
      }

      .logo-icon {
        width: 32px;
        height: 32px;
        font-size: 0.875rem;
      }

      .logo-text {
        font-size: 1rem;
        letter-spacing: 0.1em;
      }

      .back-link span {
        display: none;
      }

      /* Main padding */
      .main {
        padding: 1rem 1rem 7rem;
      }

      /* Progress stepper - compact for mobile */
      .progress {
        padding: 1rem 0;
        gap: 0.25rem;
      }

      .progress-step {
        min-width: 40px;
      }

      .progress-icon {
        width: 36px;
        height: 36px;
      }

      .progress-icon svg {
        width: 16px;
        height: 16px;
      }

      .progress-line {
        width: 20px;
        margin-bottom: 1rem;
      }

      /* Step content */
      .step-title {
        font-size: 1.375rem;
      }

      .step-subtitle {
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
      }

      /* Service cards - mobile optimized */
      .service-card {
        padding: 1rem;
      }

      .service-card-header {
        flex-wrap: wrap;
        gap: 0.75rem;
      }

      .service-icon {
        width: 40px;
        height: 40px;
      }

      .service-icon svg {
        width: 20px;
        height: 20px;
      }

      .service-info {
        flex: 1;
        min-width: calc(100% - 90px);
      }

      .service-name {
        font-size: 0.9rem;
      }

      .service-desc {
        font-size: 0.8rem;
        line-height: 1.4;
      }

      .service-price {
        font-size: 1rem;
        position: absolute;
        top: 1rem;
        right: 1rem;
      }

      /* Hide radio on mobile - use card highlight instead */
      .service-radio {
        display: none;
      }

      /* Enhanced selected state for mobile */
      .service-card.selected {
        border-color: var(--champagne-500);
        background: rgba(201, 166, 107, 0.1);
        box-shadow: 0 0 0 2px rgba(201, 166, 107, 0.3);
      }

      .service-card.selected .service-name {
        color: var(--champagne-400);
      }

      /* Vehicle cards */
      .vehicle-card {
        padding: 1rem;
      }

      .vehicle-name {
        font-size: 0.9rem;
      }

      /* Add-ons mobile */
      .addon-card {
        padding: 0.875rem 1rem;
      }

      .addon-name {
        font-size: 0.9rem;
      }

      .addon-right {
        gap: 0.75rem;
      }

      .addon-price {
        font-size: 0.9rem;
      }

      /* Calendar mobile */
      .calendar-container {
        padding: 1rem;
        border-radius: 10px;
      }

      .calendar-header {
        margin-bottom: 1rem;
      }

      .calendar-month-year {
        font-size: 1.1rem;
      }

      .calendar-nav-btn {
        width: 32px;
        height: 32px;
      }

      .calendar-weekday {
        font-size: 0.65rem;
        padding: 0.375rem 0;
      }

      .calendar-day {
        font-size: 0.85rem;
      }

      .time-section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .selected-date-display {
        width: 100%;
        justify-content: center;
      }

      /* Time slots mobile - larger touch targets */
      .time-slot {
        padding: 0.875rem;
        font-size: 0.9rem;
        min-height: 54px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      /* Location cards mobile */
      .location-card {
        padding: 1rem;
      }

      .location-name {
        font-size: 0.95rem;
      }

      .location-address {
        font-size: 0.8rem;
      }

      /* Navigation buttons mobile */
      .nav-buttons {
        flex-direction: column-reverse;
        gap: 1rem;
        padding-top: 1.5rem;
        margin-top: 1.5rem;
      }

      .btn-continue {
        width: 100%;
        justify-content: center;
        padding: 1rem;
      }

      .btn-back {
        width: 100%;
        justify-content: center;
        padding: 0.75rem;
        background: var(--obsidian-800);
        border-radius: 6px;
      }

      /* Mobile summary bar enhanced */
      .mobile-summary {
        padding: 0.875rem 1rem;
        padding-bottom: calc(0.875rem + env(safe-area-inset-bottom, 0));
      }

      .mobile-summary .btn-continue {
        padding: 0.875rem 1.25rem;
        font-size: 0.9rem;
      }

      /* Payment mobile */
      .payment-info {
        padding: 1.25rem;
      }

      .payment-total-amount {
        font-size: 2rem;
      }

      /* Success screen mobile */
      .success-icon {
        width: 64px;
        height: 64px;
      }

      .success-icon svg {
        width: 32px;
        height: 32px;
      }

      .success-title {
        font-size: 1.5rem;
      }

      .success-message {
        font-size: 0.9rem;
      }

      /* Urgency banner mobile */
      .urgency-banner {
        font-size: 0.8rem;
        padding: 0.625rem 0.875rem;
      }
    }

    /* iPhone 12/13/14 and similar devices (390px) */
    @media (max-width: 414px) {
      .main {
        padding: 0.875rem 0.875rem 7rem;
      }

      /* Progress stepper for 390px screens */
      .progress {
        gap: 0.125rem;
        padding: 0.875rem 0;
      }

      .progress-step {
        min-width: 36px;
      }

      .progress-icon {
        width: 34px;
        height: 34px;
      }

      .progress-icon svg {
        width: 15px;
        height: 15px;
      }

      .progress-line {
        width: 16px;
        margin-bottom: 0.875rem;
      }

      /* Step titles */
      .step-title {
        font-size: 1.25rem;
      }

      .step-subtitle {
        font-size: 0.85rem;
      }

      /* Service cards optimized for 390px */
      .service-card {
        padding: 0.875rem;
      }

      .service-icon {
        width: 36px;
        height: 36px;
      }

      .service-icon svg {
        width: 18px;
        height: 18px;
      }

      .service-name {
        font-size: 0.875rem;
        line-height: 1.3;
      }

      .service-desc {
        font-size: 0.75rem;
      }

      .service-badge {
        font-size: 0.6rem;
        padding: 0.1rem 0.375rem;
      }

      .service-meta {
        font-size: 0.75rem;
      }

      .service-expand-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
        margin-top: 0.75rem;
      }

      .service-features li {
        font-size: 0.8rem;
      }

      /* Vehicle cards */
      .vehicle-card {
        padding: 0.875rem;
      }

      .vehicle-name {
        font-size: 0.85rem;
      }

      .vehicle-price {
        font-size: 0.75rem;
      }

      /* Add-ons */
      .addon-card {
        padding: 0.75rem 0.875rem;
      }

      .addon-name {
        font-size: 0.85rem;
      }

      .addon-price {
        font-size: 0.85rem;
      }

      .addon-right {
        gap: 0.5rem;
      }

      .addon-check {
        width: 20px;
        height: 20px;
      }

      /* Form inputs */
      .form-input {
        padding: 0.75rem 0.875rem;
        font-size: 0.95rem;
      }

      .form-label {
        font-size: 0.8rem;
      }

      /* Calendar for 414px */
      .calendar-container {
        padding: 0.875rem;
      }

      .calendar-month-year {
        font-size: 1rem;
      }

      .calendar-nav-btn {
        width: 30px;
        height: 30px;
      }

      .calendar-weekday {
        font-size: 0.6rem;
      }

      .calendar-day {
        font-size: 0.8rem;
      }

      .selected-date-text {
        font-size: 0.85rem;
      }

      /* Time slots */
      .time-slot {
        padding: 0.75rem 0.5rem;
        font-size: 0.85rem;
        min-height: 50px;
      }

      .time-slot-limited {
        font-size: 0.65rem;
      }

      /* Location cards */
      .location-card {
        padding: 0.875rem;
      }

      .location-name {
        font-size: 0.9rem;
      }

      .location-address {
        font-size: 0.75rem;
      }

      /* Mobile summary bar */
      .mobile-summary {
        padding: 0.75rem 0.875rem;
      }

      .mobile-summary-label {
        font-size: 0.7rem;
      }

      .mobile-summary-price {
        font-size: 1.125rem;
      }

      .mobile-summary .btn-continue {
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
      }

      /* Payment section */
      .payment-info {
        padding: 1rem;
      }

      .payment-total-amount {
        font-size: 1.75rem;
      }

      .payment-total-label {
        font-size: 0.8rem;
      }

      /* Urgency banner */
      .urgency-banner {
        font-size: 0.75rem;
        padding: 0.5rem 0.75rem;
      }
    }

    /* Small devices - iPhone SE, older phones (375px and below) */
    @media (max-width: 380px) {
      .main {
        padding: 0.75rem 0.75rem 7rem;
      }

      /* Progress stepper ultra-compact */
      .progress {
        gap: 0;
        padding: 0.75rem 0;
      }

      .progress-step {
        min-width: 32px;
      }

      .progress-icon {
        width: 30px;
        height: 30px;
      }

      .progress-icon svg {
        width: 13px;
        height: 13px;
      }

      .progress-line {
        width: 10px;
        margin-bottom: 0.75rem;
      }

      .step-title {
        font-size: 1.125rem;
      }

      .step-subtitle {
        font-size: 0.8rem;
      }

      /* Service cards compact */
      .service-card {
        padding: 0.75rem;
      }

      .service-icon {
        width: 32px;
        height: 32px;
      }

      .service-icon svg {
        width: 16px;
        height: 16px;
      }

      .service-name {
        font-size: 0.8rem;
      }

      .service-desc {
        font-size: 0.7rem;
      }

      .service-price {
        font-size: 0.9rem;
      }

      .service-radio {
        width: 18px;
        height: 18px;
      }

      /* Calendar for 380px */
      .calendar-container {
        padding: 0.75rem;
      }

      .calendar-month-year {
        font-size: 0.95rem;
      }

      .calendar-nav-btn {
        width: 28px;
        height: 28px;
      }

      .calendar-weekday {
        font-size: 0.55rem;
      }

      .calendar-day {
        font-size: 0.75rem;
      }

      /* Time grid - single column on very small screens */
      .time-grid {
        gap: 0.5rem;
      }

      .time-slot {
        padding: 0.625rem 0.375rem;
        font-size: 0.8rem;
        min-height: 46px;
      }

      /* Mobile summary compact */
      .mobile-summary {
        padding: 0.625rem 0.75rem;
      }

      .mobile-summary-price {
        font-size: 1rem;
      }

      .mobile-summary .btn-continue {
        padding: 0.625rem 0.875rem;
        font-size: 0.8rem;
      }

      /* Form inputs compact */
      .form-input {
        padding: 0.625rem 0.75rem;
        font-size: 0.9rem;
      }

      /* Payment compact */
      .payment-total-amount {
        font-size: 1.5rem;
      }

      /* Success screen */
      .success-icon {
        width: 56px;
        height: 56px;
      }

      .success-icon svg {
        width: 28px;
        height: 28px;
      }

      .success-title {
        font-size: 1.25rem;
      }
    }

    /* Extra small devices - iPhone 5/SE (320px) */
    @media (max-width: 340px) {
      .main {
        padding: 0.5rem 0.5rem 6.5rem;
      }

      .header {
        padding: 0.5rem 0.75rem;
      }

      .logo-icon {
        width: 28px;
        height: 28px;
        font-size: 0.75rem;
      }

      .logo-text {
        font-size: 0.875rem;
      }

      /* Progress even smaller */
      .progress-icon {
        width: 26px;
        height: 26px;
      }

      .progress-icon svg {
        width: 12px;
        height: 12px;
      }

      .progress-line {
        width: 8px;
      }

      .step-title {
        font-size: 1rem;
      }

      /* Service cards minimal */
      .service-info {
        min-width: calc(100% - 75px);
      }

      .service-name {
        font-size: 0.75rem;
      }

      .service-expand-btn {
        padding: 0.375rem 0.5rem;
        font-size: 0.7rem;
      }

      /* Vehicle cards single column for tiny screens */
      .vehicle-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .vehicle-card {
        padding: 0.625rem;
      }

      /* Time grid single column */
      .time-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      /* Contact grid single column */
      .contact-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Safe area support for notched phones */
    @supports (padding: env(safe-area-inset-bottom)) {
      .mobile-summary {
        padding-bottom: calc(0.875rem + env(safe-area-inset-bottom));
      }

      .main {
        padding-bottom: calc(7rem + env(safe-area-inset-bottom));
      }
    }

    /* Touch improvements */
    @media (hover: none) and (pointer: coarse) {
      .service-card:hover,
      .vehicle-card:hover,
      .addon-card:hover,
      .date-card:hover,
      .time-slot:hover,
      .location-card:hover {
        border-color: var(--obsidian-800);
      }

      .service-card:active,
      .vehicle-card:active,
      .addon-card:active,
      .date-card:active,
      .time-slot:active,
      .location-card:active {
        transform: scale(0.98);
      }

      .btn-continue:hover {
        transform: none;
        box-shadow: none;
      }

      .btn-continue:active {
        transform: scale(0.98);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="/demo" class="logo">
        <div class="logo-icon">DS</div>
        <div class="logo-text"><span>DETAILER</span><span>STACK</span></div>
      </a>
    </div>
  </header>

  <main class="main">
    <div class="content-area">
      <!-- Progress Steps -->
      <div class="progress" id="progressBar">
        <div class="progress-step active" data-step="1">
          <div class="progress-icon"><i data-lucide="sparkles"></i></div>
          <span class="progress-label">Service</span>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="2">
          <div class="progress-icon"><i data-lucide="car"></i></div>
          <span class="progress-label">Vehicle</span>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="3">
          <div class="progress-icon"><i data-lucide="credit-card"></i></div>
          <span class="progress-label">Payment</span>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="4">
          <div class="progress-icon"><i data-lucide="calendar-check"></i></div>
          <span class="progress-label">Schedule</span>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="5">
          <div class="progress-icon"><i data-lucide="clock"></i></div>
          <span class="progress-label">Date & Time</span>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="6">
          <div class="progress-icon"><i data-lucide="map-pin"></i></div>
          <span class="progress-label">Location</span>
        </div>
      </div>

      <!-- Step 1: Service Selection -->
      <div class="step-content active" data-step="1">
        <h2 class="step-title">CHOOSE YOUR SERVICES</h2>
        <p class="step-subtitle">Select one or more detailing packages</p>

        <div id="serviceList"></div>
      </div>

      <!-- Step 2: Vehicle Information -->
      <div class="step-content" data-step="2">
        <h2 class="step-title">VEHICLE INFORMATION</h2>
        <p class="step-subtitle">Tell us about your vehicle</p>

        <h3 class="addons-title">Vehicle Type</h3>
        <div class="vehicle-grid" id="vehicleTypes"></div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Year</label>
            <input type="text" class="form-input" id="vehicleYear" placeholder="2024">
          </div>
          <div class="form-group">
            <label class="form-label">Make</label>
            <input type="text" class="form-input" id="vehicleMake" placeholder="BMW">
          </div>
          <div class="form-group">
            <label class="form-label">Model</label>
            <input type="text" class="form-input" id="vehicleModel" placeholder="M4">
          </div>
        </div>

        <h3 class="addons-title">Add-ons (Optional)</h3>
        <div id="addonsList"></div>
      </div>

      <!-- Step 3: Payment -->
      <div class="step-content" data-step="3">
        <h2 class="step-title">PAYMENT</h2>
        <p class="step-subtitle">Complete your purchase</p>

        <div class="payment-info">
          <div class="payment-total">
            <div class="payment-total-label">Total Amount</div>
            <div class="payment-total-amount" id="paymentTotal">$0</div>
          </div>

          <h3 class="addons-title" style="margin-top: 1.5rem;">Contact Information</h3>
          <div class="contact-grid">
            <div class="form-group">
              <label class="form-label">First Name</label>
              <input type="text" class="form-input" id="firstName" placeholder="John">
            </div>
            <div class="form-group">
              <label class="form-label">Last Name</label>
              <input type="text" class="form-input" id="lastName" placeholder="Doe">
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="email" placeholder="john@example.com">
            </div>
            <div class="form-group">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-input" id="phone" placeholder="(555) 123-4567">
            </div>
          </div>

          <h3 class="addons-title" style="margin-top: 1.5rem;">Payment Details</h3>
          <div class="form-group">
            <label class="form-label">Card Number</label>
            <input type="text" class="form-input" placeholder="4242 4242 4242 4242">
          </div>
          <div class="contact-grid">
            <div class="form-group">
              <label class="form-label">Expiry Date</label>
              <input type="text" class="form-input" placeholder="MM/YY">
            </div>
            <div class="form-group">
              <label class="form-label">CVC</label>
              <input type="text" class="form-input" placeholder="123">
            </div>
          </div>
        </div>
      </div>

      <!-- Step 4: Schedule Your Service -->
      <div class="step-content" data-step="4">
        <h2 class="step-title">SCHEDULE YOUR SERVICE</h2>
        <p class="step-subtitle">Select a service to schedule your appointment</p>

        <div id="purchasedServicesList"></div>

        <!-- Add-ons for selected service -->
        <div id="scheduleAddonsSection" style="display: none;">
          <h3 class="addons-title" style="margin-top: 2rem;">Add Extras to This Appointment</h3>
          <p class="step-subtitle" style="margin-bottom: 1rem;">Enhance your service with these add-ons</p>
          <div id="scheduleAddonsList"></div>
        </div>
      </div>

      <!-- Step 5: Date & Time -->
      <div class="step-content" data-step="5">
        <h2 class="step-title">SELECT DATE & TIME</h2>
        <p class="step-subtitle">Choose your preferred appointment slot</p>

        <div class="urgency-banner" id="urgencyBanner" style="display: none;">
          <i data-lucide="clock"></i>
          <span>Only 2 slots left for today!</span>
        </div>

        <!-- Desktop: Side-by-side layout / Mobile: Calendar only -->
        <div class="datetime-container">
          <!-- Calendar Section -->
          <div class="calendar-section" id="calendarSection">
            <div class="calendar-section-title">Select a Day</div>
            <div class="calendar-container">
              <div class="calendar-header">
                <button class="calendar-nav-btn" id="calendarPrev" onclick="prevMonth()">
                  <i data-lucide="chevron-left" style="width:18px;height:18px;"></i>
                </button>
                <span class="calendar-month-year" id="calendarMonthYear"></span>
                <button class="calendar-nav-btn" id="calendarNext" onclick="nextMonth()">
                  <i data-lucide="chevron-right" style="width:18px;height:18px;"></i>
                </button>
              </div>
              <div class="calendar-weekdays">
                <div class="calendar-weekday">Sun</div>
                <div class="calendar-weekday">Mon</div>
                <div class="calendar-weekday">Tue</div>
                <div class="calendar-weekday">Wed</div>
                <div class="calendar-weekday">Thu</div>
                <div class="calendar-weekday">Fri</div>
                <div class="calendar-weekday">Sat</div>
              </div>
              <div class="calendar-grid" id="calendarGrid"></div>
            </div>
          </div>

          <!-- Desktop Time Panel (side panel) -->
          <div class="time-panel" id="timePanel">
            <div class="time-panel-header">
              <div class="time-panel-date" id="timePanelDate">Select a date</div>
              <div class="time-panel-availability">
                <span class="availability-dot"></span>
                <span>times you're available</span>
              </div>
            </div>
            <div class="time-slots-list" id="desktopTimeSlots"></div>
          </div>
        </div>

        <!-- Mobile Time View (full screen overlay) -->
        <div class="mobile-time-view" id="mobileTimeView">
          <div class="mobile-time-header">
            <button class="mobile-back-btn" onclick="hideMobileTimeView()">
              <i data-lucide="chevron-left" style="width:20px;height:20px;"></i>
            </button>
            <div class="mobile-time-info">
              <div class="mobile-time-day" id="mobileTimeDay">Wednesday</div>
              <div class="mobile-time-date" id="mobileTimeDate">December 17, 2025</div>
            </div>
          </div>
          <div class="mobile-time-section-title">Select a Time</div>
          <div class="mobile-time-availability">
            <span class="availability-dot"></span>
            <span>times you're available</span>
          </div>
          <div class="mobile-time-grid" id="mobileTimeSlots"></div>
        </div>
      </div>

      <!-- Step 6: Location -->
      <div class="step-content" data-step="6">
        <h2 class="step-title">SELECT LOCATION</h2>
        <p class="step-subtitle">Choose where you'd like to have your vehicle detailed</p>

        <div id="locationList"></div>
      </div>

      <!-- Success Screen -->
      <div class="success-screen" id="successScreen">
        <div class="success-icon"><i data-lucide="check"></i></div>
        <h2 class="success-title">APPOINTMENT CONFIRMED!</h2>
        <p class="success-message">
          We've sent a confirmation email to your inbox.<br>
          See you soon!
        </p>
        <a href="/demo" class="btn-continue">Back to Home</a>
      </div>

      <!-- Congrats Overlay (shows after payment) -->
      <div class="congrats-overlay" id="congratsOverlay">
        <div class="congrats-content">
          <div class="congrats-icon">
            <div class="congrats-circle"></div>
            <i data-lucide="check"></i>
          </div>
          <h2 class="congrats-title">PAYMENT SUCCESSFUL!</h2>
          <p class="congrats-message">Thank you for your purchase. Now let's schedule your service.</p>
          <button class="btn-continue congrats-btn" onclick="closeCongratsAndContinue()">
            Schedule Now <i data-lucide="chevron-right"></i>
          </button>
        </div>
        <div class="confetti" id="confetti"></div>
      </div>

      <!-- Bundle Upsell Popup -->
      <div class="bundle-upsell-overlay" id="bundleUpsellOverlay">
        <div class="bundle-upsell-popup">
          <div class="bundle-upsell-header">
            <div class="bundle-upsell-save">SAVE 10%</div>
            <h2 class="bundle-upsell-title">5-PACK BUNDLE</h2>
            <p class="bundle-upsell-subtitle">Get 5 services for the price of 4.5!</p>
          </div>
          <div class="bundle-upsell-pricing">
            <div class="bundle-upsell-service-name" id="bundleServiceName">Complete Detail  5</div>
            <div class="bundle-upsell-prices">
              <span class="bundle-old-price" id="bundleOldPrice">$1,245</span>
              <span class="bundle-arrow"></span>
              <span class="bundle-new-price" id="bundleNewPrice">$1,120</span>
            </div>
            <div class="bundle-savings" id="bundleSavings">You save $125!</div>
          </div>
          <div class="bundle-upsell-actions">
            <button class="bundle-add-btn" onclick="addBundleToCart()">
              <i data-lucide="package"></i>
              Add 5-Pack Bundle
            </button>
            <button class="bundle-skip-btn" onclick="skipBundle()">
              No thanks, just add single service
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Summary Sidebar -->
    <aside class="summary" id="summaryPanel">
      <h3 class="summary-title">BOOKING SUMMARY</h3>
      <div class="summary-empty" id="summaryEmpty">Select a service to see your booking summary</div>
      <div class="summary-items" id="summaryItems" style="display: none;"></div>
      <div class="summary-divider" id="summaryDivider" style="display: none;"></div>
      <div class="summary-total" id="summaryTotal" style="display: none;">
        <span>Total</span>
        <span class="summary-total-price" id="summaryTotalPrice">$0</span>
      </div>
      <div class="summary-trust">
        <div class="trust-item"><i data-lucide="shield"></i> Secure payment with Stripe</div>
        <div class="trust-item"><i data-lucide="check"></i> Free cancellation 24h before</div>
      </div>
    </aside>
  </main>

  <!-- Anchored Bottom Bar (all devices) -->
  <div class="bottom-bar" id="bottomBar">
    <div class="bottom-bar-content">
      <div class="bottom-bar-info" onclick="toggleMobileDrawer()">
        <div class="bottom-bar-label">Total <i data-lucide="chevron-up" style="width:12px;height:12px;"></i></div>
        <div class="bottom-bar-price" id="bottomBarPrice">$0</div>
      </div>
      <button class="btn-continue" id="bottomContinueBtn" onclick="handleContinue()" disabled>
        Continue <i data-lucide="chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Mobile drawer overlay -->
  <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobileDrawer()"></div>

  <!-- Mobile Summary Drawer -->
  <div class="mobile-drawer" id="mobileDrawer">
    <div class="mobile-drawer-header" onclick="toggleMobileDrawer()">
      <span class="mobile-drawer-title">Booking Summary</span>
      <i data-lucide="x" class="mobile-drawer-close"></i>
    </div>
    <div class="mobile-drawer-content" id="mobileDrawerContent"></div>
  </div>

  <script>
    // Data
    const services = [
      {
        id: 'eco-wash',
        name: 'ECO Wash Package',
        price: 79,
        description: 'Waterless hand wash exterior with premium eco-friendly products',
        duration: '45 min',
        icon: 'droplets',
        features: ['Waterless Ceramic Hand Wash', 'Vacuum Interior', 'Dashboard Wipe Down', 'Windows Inside & Out', 'Mirrors & Door Jambs']
      },
      {
        id: 'complete-detail',
        name: 'Complete Detail',
        price: 249,
        description: 'Full interior and exterior detail - our most popular service',
        duration: '3 hours',
        icon: 'sparkles',
        popular: true,
        features: ['Everything in ECO Wash', 'Full Interior Detail', 'Leather Conditioning', 'ECO Wax Protection', 'Exterior Speed Polish', 'Tire & Wheel Cleaning']
      },
      {
        id: 'interior-detail',
        name: 'Interior Detail',
        price: 149,
        description: 'Deep clean with steam, odor elimination, and leather treatment',
        duration: '2 hours',
        icon: 'sofa',
        features: ['ECO Wash Included', 'Cup Holders, Vents & Crevices', 'Floor Mats, Carpets & Seats', 'Trunk & Lining', 'Leather Treatment', 'Odor Elimination']
      },
      {
        id: 'ceramic-coating',
        name: 'Ceramic Coating',
        price: 599,
        description: 'Professional-grade protection with hydrophobic finish',
        duration: '1 day',
        icon: 'shield',
        features: ['Multi-stage Process', 'Ultimate Paint Protection', 'Scratch and Swirl Removal', '1-5 Year Protection', 'Hydrophobic Finish', 'UV Protection']
      },
      {
        id: 'paint-correction',
        name: 'Paint Correction',
        price: 399,
        description: 'Multi-stage polish to remove scratches and swirls',
        duration: '4-6 hours',
        icon: 'paintbrush',
        features: ['Paint Inspection', 'Clay Bar Treatment', 'Multi-Stage Polish', 'Swirl Removal', 'Mirror Finish', 'Sealant Application']
      }
    ];

    const vehicleTypes = [
      { id: 'sedan', name: 'Sedan / Coupe', description: 'Standard vehicles', multiplier: 1 },
      { id: 'suv', name: 'SUV / Crossover', description: '+20% for larger vehicles', multiplier: 1.2 },
      { id: 'truck', name: 'Truck / Van', description: '+30% for trucks and vans', multiplier: 1.3 },
      { id: 'luxury', name: 'Luxury / Exotic', description: 'Premium care for high-end vehicles', multiplier: 1.5 }
    ];

    const addons = [
      { id: 'headlight', name: 'Headlight Restoration', price: 49 },
      { id: 'engine', name: 'Engine Bay Detail', price: 79 },
      { id: 'pet-hair', name: 'Pet Hair Removal', price: 39 },
      { id: 'odor', name: 'Odor Elimination', price: 49 },
      { id: 'scratch', name: 'Scratch Removal (per panel)', price: 99 }
    ];

    const locations = [
      { id: 'westside', name: 'Westside', address: '123 Main Street, Anytown, ST 12345' },
      { id: 'midtown', name: 'Midtown', address: '456 Oak Avenue, Anytown, ST 12345' },
      { id: 'downtown', name: 'Downtown', address: '789 Commerce Blvd, Anytown, ST 12345' }
    ];

    // State
    let currentStep = 1;
    let booking = {
      services: [], // Array of {service, isBundle, quantity}
      vehicleType: null,
      vehicleInfo: {},
      addons: [], // Pre-purchase add-ons (kept for compatibility)
      date: null,
      time: null,
      location: null,
      contact: {},
      selectedScheduleService: null,
      currentScheduleAddons: [], // Add-ons for current service being scheduled
      scheduledServices: {} // {serviceId: {date, time, location, addons: []}}
    };

    // Bundle upsell state
    let pendingService = null; // Service awaiting bundle decision

    // Calendar state
    let calendarDate = new Date();
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    // Available days (next 60 days from today, excluding Sundays for demo)
    const availableDays = new Set();
    for (let i = 0; i < 60; i++) {
      const d = new Date(today);
      d.setDate(today.getDate() + i);
      // Make all days except Sundays available (for demo purposes)
      if (d.getDay() !== 0) {
        availableDays.add(d.toISOString().split('T')[0]);
      }
    }

    // Check URL params for pre-selected package
    const urlParams = new URLSearchParams(window.location.search);
    const preSelectedPackage = urlParams.get('package');

    // Initialize
    function init() {
      renderServices();
      renderVehicleTypes();
      renderAddons();
      renderCalendar();
      renderLocations();
      lucide.createIcons();

      // If package pre-selected, add to cart and skip to step 2
      if (preSelectedPackage) {
        const service = services.find(s => s.id === preSelectedPackage);
        if (service) {
          booking.services.push({
            service: service,
            isBundle: false,
            quantity: 1
          });
          currentStep = 2;
          renderServices();
          updateProgress();
          updateStepVisibility();
          updateSummary();
        }
      }
    }

    // Helper to check if service is in cart
    function isServiceInCart(serviceId) {
      return booking.services.some(s => s.service.id === serviceId);
    }

    function getServiceFromCart(serviceId) {
      return booking.services.find(s => s.service.id === serviceId);
    }

    // Render Services
    function renderServices() {
      const container = document.getElementById('serviceList');
      container.innerHTML = services.map(service => {
        const inCart = isServiceInCart(service.id);
        const cartItem = getServiceFromCart(service.id);
        const isBundle = cartItem && cartItem.isBundle;
        const quantity = cartItem ? cartItem.quantity : 1;
        const bundlePrice = Math.round(service.price * 5 * 0.9);

        return `
        <div class="service-card ${inCart ? 'selected' : ''}" data-service="${service.id}" onclick="toggleServiceSelection('${service.id}')">
          <div class="service-card-header">
            <div class="service-icon"><i data-lucide="${service.icon}"></i></div>
            <div class="service-info">
              <div class="service-name-row">
                <span class="service-name">${service.name}</span>
                ${service.popular ? '<span class="service-badge">Popular</span>' : ''}
                ${isBundle ? '<span class="service-bundle-badge">5-Pack</span>' : ''}
              </div>
              <div class="service-desc">${service.description}</div>
              <div class="service-meta">
                <i data-lucide="clock" style="width:14px;height:14px;"></i>
                ${service.duration}${isBundle ? '  5' : ''}
              </div>
            </div>
            ${isBundle ? `
              <div class="service-price-container">
                <span class="service-price-original">$${service.price * 5}</span>
                <span class="service-price-bundle">$${bundlePrice}</span>
              </div>
            ` : `
              <span class="service-price">$${service.price}</span>
            `}
            <div class="service-checkbox"><i data-lucide="check"></i></div>
          </div>
          ${inCart ? `
            <button class="service-add-btn" onclick="event.stopPropagation(); showBundleUpsell('${service.id}')">
              ${isBundle ? 'Bundle Added' : 'Upgrade to 5-Pack'}
            </button>
          ` : ''}
          <button class="service-expand-btn" onclick="event.stopPropagation(); toggleServiceDetails('${service.id}')">
            <span>What's included</span>
            <i data-lucide="chevron-down" style="width:16px;height:16px;"></i>
          </button>
          <div class="service-details">
            <ul class="service-features">
              ${service.features.map(f => `<li>${f}</li>`).join('')}
            </ul>
          </div>
        </div>
      `}).join('');
      lucide.createIcons();
    }

    function toggleServiceDetails(serviceId) {
      const card = document.querySelector(`[data-service="${serviceId}"]`);
      card.classList.toggle('expanded');
      lucide.createIcons();
    }

    function toggleServiceSelection(serviceId) {
      const service = services.find(s => s.id === serviceId);
      const existingIndex = booking.services.findIndex(s => s.service.id === serviceId);

      if (existingIndex >= 0) {
        // Remove service from cart
        booking.services.splice(existingIndex, 1);
        renderServices();
        updateSummary();
        updateBottomBar();
      } else {
        // Show bundle upsell popup for new selection
        pendingService = service;
        showBundleUpsell(serviceId);
      }
    }

    function showBundleUpsell(serviceId) {
      const service = services.find(s => s.id === serviceId);
      pendingService = service;

      const originalPrice = service.price * 5;
      const bundlePrice = Math.round(originalPrice * 0.9);
      const savings = originalPrice - bundlePrice;

      document.getElementById('bundleServiceName').textContent = `${service.name}  5`;
      document.getElementById('bundleOldPrice').textContent = `$${originalPrice}`;
      document.getElementById('bundleNewPrice').textContent = `$${bundlePrice}`;
      document.getElementById('bundleSavings').textContent = `You save $${savings}!`;

      document.getElementById('bundleUpsellOverlay').classList.add('active');
      lucide.createIcons();
    }

    function addBundleToCart() {
      if (!pendingService) return;

      // Remove existing single if present
      const existingIndex = booking.services.findIndex(s => s.service.id === pendingService.id);
      if (existingIndex >= 0) {
        booking.services.splice(existingIndex, 1);
      }

      // Add as bundle
      booking.services.push({
        service: pendingService,
        isBundle: true,
        quantity: 5
      });

      document.getElementById('bundleUpsellOverlay').classList.remove('active');
      pendingService = null;
      renderServices();
      updateSummary();
      updateBottomBar();
    }

    function skipBundle() {
      if (!pendingService) return;

      // Check if already in cart
      const existingIndex = booking.services.findIndex(s => s.service.id === pendingService.id);
      if (existingIndex < 0) {
        // Add as single
        booking.services.push({
          service: pendingService,
          isBundle: false,
          quantity: 1
        });
      }

      document.getElementById('bundleUpsellOverlay').classList.remove('active');
      pendingService = null;
      renderServices();
      updateSummary();
      updateBottomBar();
    }

    // Render Vehicle Types
    function renderVehicleTypes() {
      const container = document.getElementById('vehicleTypes');
      container.innerHTML = vehicleTypes.map(vt => `
        <div class="vehicle-card ${booking.vehicleType?.id === vt.id ? 'selected' : ''}" onclick="selectVehicleType('${vt.id}')">
          <div class="vehicle-card-header">
            <span class="vehicle-name">${vt.name}</span>
            <span class="vehicle-check"><i data-lucide="check" style="width:18px;height:18px;"></i></span>
          </div>
          <div class="vehicle-price">${vt.description}</div>
        </div>
      `).join('');
    }

    function selectVehicleType(typeId) {
      booking.vehicleType = vehicleTypes.find(v => v.id === typeId);
      document.querySelectorAll('.vehicle-card').forEach(c => c.classList.remove('selected'));
      document.querySelector(`.vehicle-card:nth-child(${vehicleTypes.findIndex(v => v.id === typeId) + 1})`).classList.add('selected');
      updateSummary();
      updateBottomBar();
      lucide.createIcons();
    }

    // Render Addons
    function renderAddons() {
      const container = document.getElementById('addonsList');
      container.innerHTML = addons.map(addon => `
        <div class="addon-card ${booking.addons.includes(addon.id) ? 'selected' : ''}" onclick="toggleAddon('${addon.id}')">
          <span class="addon-name">${addon.name}</span>
          <div class="addon-right">
            <span class="addon-price">+$${addon.price}</span>
            <div class="addon-check"><i data-lucide="check" style="width:14px;height:14px;"></i></div>
          </div>
        </div>
      `).join('');
    }

    function toggleAddon(addonId) {
      const idx = booking.addons.indexOf(addonId);
      if (idx > -1) {
        booking.addons.splice(idx, 1);
      } else {
        booking.addons.push(addonId);
      }
      renderAddons();
      updateSummary();
      lucide.createIcons();
    }

    // Calendar Functions
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const monthNamesShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    function renderCalendar() {
      const grid = document.getElementById('calendarGrid');
      const monthYearLabel = document.getElementById('calendarMonthYear');
      const prevBtn = document.getElementById('calendarPrev');

      const year = calendarDate.getFullYear();
      const month = calendarDate.getMonth();

      // Update month/year label
      monthYearLabel.textContent = `${monthNames[month]} ${year}`;

      // Disable prev button if viewing current month
      const currentMonth = new Date();
      prevBtn.disabled = (year === currentMonth.getFullYear() && month === currentMonth.getMonth());

      // Get first day of month and total days
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startingDay = firstDay.getDay();
      const totalDays = lastDay.getDate();

      // Build calendar grid
      let html = '';

      // Empty cells before first day
      for (let i = 0; i < startingDay; i++) {
        html += '<div class="calendar-day empty"></div>';
      }

      // Days of the month
      for (let day = 1; day <= totalDays; day++) {
        const date = new Date(year, month, day);
        const dateStr = date.toISOString().split('T')[0];
        const isToday = date.getTime() === today.getTime();
        const isSelected = booking.date === dateStr;
        const isAvailable = availableDays.has(dateStr);
        const isPast = date < today;

        let classes = 'calendar-day';
        if (isToday) classes += ' today';
        if (isSelected) classes += ' selected';
        if (isAvailable && !isPast) {
          classes += ' available';
        } else if (isPast || !isAvailable) {
          classes += ' unavailable';
        }

        const clickHandler = (isAvailable && !isPast) ? `onclick="selectDate('${dateStr}')"` : '';
        html += `<div class="${classes}" ${clickHandler}>${day}</div>`;
      }

      grid.innerHTML = html;
      lucide.createIcons();
    }

    function prevMonth() {
      calendarDate.setMonth(calendarDate.getMonth() - 1);
      renderCalendar();
    }

    function nextMonth() {
      calendarDate.setMonth(calendarDate.getMonth() + 1);
      renderCalendar();
    }

    function selectDate(dateStr) {
      booking.date = dateStr;
      booking.time = null; // Reset time when date changes

      // Update calendar display
      renderCalendar();

      // Update selected date display
      const selectedDate = new Date(dateStr + 'T00:00:00');
      const dayName = dayNames[selectedDate.getDay()];
      const monthName = monthNames[selectedDate.getMonth()];
      const formattedDate = `${monthName} ${selectedDate.getDate()}, ${selectedDate.getFullYear()}`;

      // Update desktop time panel
      const timePanel = document.getElementById('timePanel');
      timePanel.classList.add('has-date');
      document.getElementById('timePanelDate').textContent = `${dayName}, ${monthNamesShort[selectedDate.getMonth()]} ${selectedDate.getDate()}`;

      // Update mobile time view
      document.getElementById('mobileTimeDay').textContent = dayName;
      document.getElementById('mobileTimeDate').textContent = formattedDate;

      // Render time slots
      renderTimes();

      // Show urgency for today
      const todayStr = today.toISOString().split('T')[0];
      document.getElementById('urgencyBanner').style.display = dateStr === todayStr ? 'flex' : 'none';

      // On mobile, show the mobile time view
      if (window.innerWidth < 768) {
        showMobileTimeView();
      }

      lucide.createIcons();
      checkStep3();
    }

    // Show mobile time view
    function showMobileTimeView() {
      const calendarSection = document.getElementById('calendarSection');
      const mobileTimeView = document.getElementById('mobileTimeView');

      calendarSection.classList.add('hidden-mobile');
      mobileTimeView.classList.add('visible');

      lucide.createIcons();
    }

    // Hide mobile time view (back to calendar)
    function hideMobileTimeView() {
      const calendarSection = document.getElementById('calendarSection');
      const mobileTimeView = document.getElementById('mobileTimeView');

      calendarSection.classList.remove('hidden-mobile');
      mobileTimeView.classList.remove('visible');
      // Reset time selection if going back
      booking.time = null;
      checkStep3();
    }

    // Render Times
    function renderTimes() {
      const desktopContainer = document.getElementById('desktopTimeSlots');
      const mobileContainer = document.getElementById('mobileTimeSlots');
      const times = ['7:30am', '7:45am', '8:00am', '9:00am', '10:00am', '11:00am', '12:00pm', '1:00pm', '2:00pm', '3:00pm', '4:00pm'];

      // Render desktop time slots (simple list, no inline Next button)
      desktopContainer.innerHTML = times.map(time => `
        <div class="time-slot ${booking.time === time ? 'selected' : ''}" onclick="selectTime('${time}')">
          ${time}
        </div>
      `).join('');

      // Render mobile time slots (same pattern)
      mobileContainer.innerHTML = times.map(time => `
        <div class="time-slot ${booking.time === time ? 'selected' : ''}" onclick="selectTime('${time}')">
          ${time}
        </div>
      `).join('');
    }

    function selectTime(time) {
      booking.time = time;
      renderTimes();
      checkStep3();
    }

    function checkStep3() {
      updateBottomBar();
    }

    // Render Locations
    function renderLocations() {
      const container = document.getElementById('locationList');
      container.innerHTML = locations.map(loc => `
        <div class="location-card ${booking.location === loc.id ? 'selected' : ''}" onclick="selectLocation('${loc.id}')">
          <div class="location-name">
            <i data-lucide="map-pin" style="width:18px;height:18px;color:var(--champagne-500);"></i>
            ${loc.name}
          </div>
          <div class="location-address">${loc.address}</div>
        </div>
      `).join('');
    }

    function selectLocation(locId) {
      booking.location = locId;
      renderLocations();
      updateBottomBar();
      lucide.createIcons();
    }

    // Summary
    function updateSummary() {
      const empty = document.getElementById('summaryEmpty');
      const items = document.getElementById('summaryItems');
      const divider = document.getElementById('summaryDivider');
      const total = document.getElementById('summaryTotal');
      const mobileDrawerContent = document.getElementById('mobileDrawerContent');

      if (booking.services.length === 0) {
        empty.style.display = 'block';
        items.style.display = 'none';
        divider.style.display = 'none';
        total.style.display = 'none';
        mobileDrawerContent.innerHTML = '<div style="color: var(--obsidian-500); text-align: center; padding: 1rem 0;">Select a service to see your booking summary</div>';
        return;
      }

      empty.style.display = 'none';
      items.style.display = 'block';
      divider.style.display = 'block';
      total.style.display = 'flex';

      let html = '';
      let mobileHtml = '';

      // Add each service
      booking.services.forEach(item => {
        const serviceName = item.isBundle ? `${item.service.name} (5-Pack)` : item.service.name;
        const servicePrice = item.isBundle ? Math.round(item.service.price * 5 * 0.9) : item.service.price;
        html += `<div class="summary-item"><span class="summary-item-name">${serviceName}</span><span class="summary-item-price">$${servicePrice}</span></div>`;
        mobileHtml += `<div class="mobile-drawer-item"><span class="mobile-drawer-item-name">${serviceName}</span><span class="mobile-drawer-item-price">$${servicePrice}</span></div>`;
      });

      // Vehicle adjustment (apply to base price of all services)
      if (booking.vehicleType && booking.vehicleType.multiplier > 1) {
        const baseTotal = booking.services.reduce((sum, item) => {
          return sum + (item.isBundle ? Math.round(item.service.price * 5 * 0.9) : item.service.price);
        }, 0);
        const adj = Math.round(baseTotal * (booking.vehicleType.multiplier - 1));
        html += `<div class="summary-item addon"><span class="summary-item-name">${booking.vehicleType.name} adjustment</span><span class="summary-item-price">+$${adj}</span></div>`;
        mobileHtml += `<div class="mobile-drawer-item addon"><span class="mobile-drawer-item-name">${booking.vehicleType.name} adjustment</span><span class="mobile-drawer-item-price">+$${adj}</span></div>`;
      }

      booking.addons.forEach(addonId => {
        const addon = addons.find(a => a.id === addonId);
        html += `<div class="summary-item addon"><span class="summary-item-name">${addon.name}</span><span class="summary-item-price">+$${addon.price}</span></div>`;
        mobileHtml += `<div class="mobile-drawer-item addon"><span class="mobile-drawer-item-name">${addon.name}</span><span class="mobile-drawer-item-price">+$${addon.price}</span></div>`;
      });

      items.innerHTML = html;
      mobileDrawerContent.innerHTML = mobileHtml;

      const totalPrice = calculateTotal();
      document.getElementById('summaryTotalPrice').textContent = `$${totalPrice}`;
      document.getElementById('bottomBarPrice').textContent = `$${totalPrice}`;
      document.getElementById('paymentTotal').textContent = `$${totalPrice}`;
    }

    // Mobile drawer toggle
    function toggleMobileDrawer() {
      const drawer = document.getElementById('mobileDrawer');
      const overlay = document.getElementById('mobileOverlay');
      const isOpen = drawer.classList.contains('open');

      if (isOpen) {
        drawer.classList.remove('open');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      } else {
        drawer.classList.add('open');
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
        lucide.createIcons();
      }
    }

    // Update bottom bar based on current step and selections
    function updateBottomBar() {
      const btn = document.getElementById('bottomContinueBtn');
      const bottomBar = document.getElementById('bottomBar');

      // Check if step is valid for showing continue button
      let canContinue = false;
      let buttonText = 'Continue';
      let buttonIcon = 'chevron-right';

      switch (currentStep) {
        case 1:
          canContinue = booking.services.length > 0;
          break;
        case 2:
          canContinue = booking.vehicleType !== null;
          break;
        case 3:
          canContinue = true; // Payment step
          buttonText = 'Complete Payment';
          buttonIcon = 'check';
          break;
        case 4:
          canContinue = booking.selectedScheduleService !== null;
          break;
        case 5:
          canContinue = booking.date !== null && booking.time !== null;
          break;
        case 6:
          canContinue = booking.location !== null;
          buttonText = 'Confirm Appointment';
          buttonIcon = 'check';
          break;
      }

      btn.disabled = !canContinue;
      btn.innerHTML = `${buttonText} <i data-lucide="${buttonIcon}"></i>`;
      lucide.createIcons();

      // Hide bottom bar on success screen or congrats overlay
      if (document.getElementById('successScreen').classList.contains('active') ||
          document.getElementById('congratsOverlay').classList.contains('active')) {
        bottomBar.classList.add('hidden');
      } else {
        bottomBar.classList.remove('hidden');
      }
    }

    // Handle continue button click
    function handleContinue() {
      if (currentStep === 3) {
        // Payment step - show congrats animation
        showCongratsOverlay();
      } else if (currentStep === 6) {
        // Final step - complete booking
        completeBooking();
      } else {
        nextStep();
      }
    }

    // Congrats overlay functions
    function showCongratsOverlay() {
      const overlay = document.getElementById('congratsOverlay');
      overlay.classList.add('active');
      document.getElementById('bottomBar').classList.add('hidden');
      createConfetti();
      lucide.createIcons();
    }

    function closeCongratsAndContinue() {
      const overlay = document.getElementById('congratsOverlay');
      overlay.classList.remove('active');
      // Move to step 4 (Schedule Your Service)
      currentStep = 4;
      booking.selectedScheduleService = null;
      booking.currentScheduleAddons = [];
      updateProgress();
      updateStepVisibility();
      renderPurchasedServices();
      // Hide add-ons section until service is selected
      document.getElementById('scheduleAddonsSection').style.display = 'none';
      updateBottomBar();
      window.scrollTo(0, 0);
    }

    function createConfetti() {
      const confettiContainer = document.getElementById('confetti');
      confettiContainer.innerHTML = '';
      const colors = ['#c9a66b', '#d4b896', '#fff', '#b8935a'];

      for (let i = 0; i < 50; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.left = Math.random() * 100 + '%';
        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
        piece.style.animationDelay = Math.random() * 2 + 's';
        piece.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confettiContainer.appendChild(piece);
      }
    }

    // Render purchased services for scheduling
    function renderPurchasedServices() {
      const container = document.getElementById('purchasedServicesList');

      // Build list of purchased items (services + addons)
      let purchasedItems = [];

      // Add all purchased services
      booking.services.forEach((item, index) => {
        const serviceId = `service-${item.service.id}`;
        if (item.isBundle) {
          // For bundles, show each of the 5 as separate schedulable items
          for (let i = 1; i <= 5; i++) {
            const bundleItemId = `${serviceId}-${i}`;
            purchasedItems.push({
              id: bundleItemId,
              name: `${item.service.name} (${i}/5)`,
              details: item.service.duration,
              scheduled: booking.scheduledServices && booking.scheduledServices[bundleItemId]
            });
          }
        } else {
          purchasedItems.push({
            id: serviceId,
            name: item.service.name,
            details: item.service.duration,
            scheduled: booking.scheduledServices && booking.scheduledServices[serviceId]
          });
        }
      });

      // Add addons
      booking.addons.forEach(addonId => {
        const addon = addons.find(a => a.id === addonId);
        if (addon) {
          purchasedItems.push({
            id: `addon-${addonId}`,
            name: addon.name,
            details: 'Add-on service',
            scheduled: booking.scheduledServices && booking.scheduledServices[`addon-${addonId}`]
          });
        }
      });

      container.innerHTML = purchasedItems.map(item => `
        <div class="purchased-service-card ${booking.selectedScheduleService === item.id ? 'selected' : ''}"
             onclick="selectScheduleService('${item.id}')">
          <div class="purchased-service-header">
            <span class="purchased-service-name">${item.name}</span>
            <div class="purchased-service-check">
              <i data-lucide="check"></i>
            </div>
          </div>
          <div class="purchased-service-details">${item.details}</div>
          ${item.scheduled ? `
            <div class="purchased-service-scheduled">
              <i data-lucide="calendar-check"></i>
              <span>Scheduled: ${item.scheduled}</span>
            </div>
          ` : ''}
        </div>
      `).join('');

      lucide.createIcons();
    }

    function selectScheduleService(serviceId) {
      booking.selectedScheduleService = serviceId;
      booking.currentScheduleAddons = []; // Reset add-ons when selecting new service
      renderPurchasedServices();
      renderScheduleAddons();
      updateBottomBar();
    }

    // Render add-ons for scheduling step
    function renderScheduleAddons() {
      const section = document.getElementById('scheduleAddonsSection');
      const container = document.getElementById('scheduleAddonsList');

      if (!booking.selectedScheduleService) {
        section.style.display = 'none';
        return;
      }

      section.style.display = 'block';

      container.innerHTML = addons.map(addon => `
        <div class="addon-card ${booking.currentScheduleAddons.includes(addon.id) ? 'selected' : ''}"
             onclick="toggleScheduleAddon('${addon.id}')">
          <div class="addon-info">
            <span class="addon-name">${addon.name}</span>
          </div>
          <div class="addon-right">
            <span class="addon-price">+$${addon.price}</span>
            <div class="addon-check"><i data-lucide="check"></i></div>
          </div>
        </div>
      `).join('');

      lucide.createIcons();
    }

    function toggleScheduleAddon(addonId) {
      const index = booking.currentScheduleAddons.indexOf(addonId);
      if (index >= 0) {
        booking.currentScheduleAddons.splice(index, 1);
      } else {
        booking.currentScheduleAddons.push(addonId);
      }
      renderScheduleAddons();
    }

    function calculateTotal() {
      if (booking.services.length === 0) return 0;

      // Sum all services (with bundle discount if applicable)
      let total = booking.services.reduce((sum, item) => {
        if (item.isBundle) {
          return sum + Math.round(item.service.price * 5 * 0.9);
        }
        return sum + item.service.price;
      }, 0);

      // Apply vehicle multiplier
      if (booking.vehicleType) {
        total = Math.round(total * booking.vehicleType.multiplier);
      }

      // Add addons
      booking.addons.forEach(addonId => {
        const addon = addons.find(a => a.id === addonId);
        total += addon.price;
      });

      return total;
    }

    // Navigation
    function nextStep() {
      if (currentStep < 6) {
        // If leaving step 5 (Date & Time), reset mobile time view state
        if (currentStep === 5) {
          resetMobileTimeView();
        }
        currentStep++;
        updateProgress();
        updateStepVisibility();
        updateBottomBar();
        window.scrollTo(0, 0);
      }
    }

    function prevStep() {
      // Don't allow going back before step 4 (after payment)
      if (currentStep > 4) {
        currentStep--;
        updateProgress();
        updateStepVisibility();
        updateBottomBar();
        // If returning to step 5, reset mobile time view and show calendar
        if (currentStep === 5) {
          resetMobileTimeView();
        }
        window.scrollTo(0, 0);
      } else if (currentStep > 1 && currentStep <= 3) {
        // Can go back during service/vehicle/payment selection
        currentStep--;
        updateProgress();
        updateStepVisibility();
        updateBottomBar();
        window.scrollTo(0, 0);
      }
    }

    // Reset mobile time view to calendar state
    function resetMobileTimeView() {
      const calendarSection = document.getElementById('calendarSection');
      const mobileTimeView = document.getElementById('mobileTimeView');

      if (calendarSection) calendarSection.classList.remove('hidden-mobile');
      if (mobileTimeView) mobileTimeView.classList.remove('visible');
    }

    function updateProgress() {
      document.querySelectorAll('.progress-step').forEach((step, idx) => {
        const stepNum = idx + 1;
        step.classList.remove('active', 'completed', 'clickable');

        if (stepNum === currentStep) {
          step.classList.add('active');
        } else if (stepNum < currentStep) {
          step.classList.add('completed', 'clickable');
        }

        // Add click handler for completed steps
        step.onclick = () => {
          if (stepNum < currentStep) {
            goToStep(stepNum);
          }
        };
      });

      document.querySelectorAll('.progress-line').forEach((line, idx) => {
        line.classList.toggle('completed', idx < currentStep - 1);
      });
    }

    function goToStep(stepNum) {
      // After payment (step 4+), don't allow going back before step 4
      if (currentStep >= 4 && stepNum < 4) {
        return;
      }
      if (stepNum >= 1 && stepNum < currentStep) {
        // If leaving step 5 (date/time), reset mobile time view
        if (currentStep === 5) {
          resetMobileTimeView();
        }
        currentStep = stepNum;
        updateProgress();
        updateStepVisibility();
        updateBottomBar();
        // If going to step 5, reset mobile time view
        if (stepNum === 5) {
          resetMobileTimeView();
        }
        window.scrollTo(0, 0);
      }
    }

    function updateStepVisibility() {
      document.querySelectorAll('.step-content').forEach(step => {
        step.classList.remove('active');
      });
      const activeStep = document.querySelector(`.step-content[data-step="${currentStep}"]`);
      if (activeStep) activeStep.classList.add('active');
      lucide.createIcons();
    }

    function completeBooking() {
      document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
      document.getElementById('successScreen').classList.add('active');
      document.getElementById('progressBar').style.display = 'none';
      document.querySelector('.summary').style.display = 'none';
      document.getElementById('bottomBar').classList.add('hidden');
    }

    // Init
    init();
    updateBottomBar();
  </script>
</body>
</html>
