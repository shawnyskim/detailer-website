<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DetailerStack Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* DetailerStack Admin - Purple theme */
      --ds-primary: #7c3aed;
      --ds-primary-dark: #6d28d9;
      --ds-primary-light: #a78bfa;

      /* Car Detailer - Blue theme */
      --cd-primary: #2563eb;
      --cd-primary-dark: #1d4ed8;
      --cd-primary-light: #60a5fa;

      /* Customer - Green theme */
      --cust-primary: #059669;
      --cust-primary-dark: #047857;
      --cust-primary-light: #34d399;

      /* Shared colors */
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;

      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;

      --sidebar-width: 260px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--gray-100);
      color: var(--gray-800);
      min-height: 100vh;
    }

    /* Role Switcher Bar */
    .role-switcher {
      background: var(--gray-900);
      padding: 8px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      height: 48px;
    }

    .role-switcher-label {
      color: var(--gray-400);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .role-buttons {
      display: flex;
      gap: 8px;
    }

    .role-btn {
      padding: 6px 16px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--gray-700);
      color: var(--gray-300);
    }

    .role-btn:hover {
      background: var(--gray-600);
    }

    .role-btn.active[data-role="detailerstack"] {
      background: var(--ds-primary);
      color: white;
    }

    .role-btn.active[data-role="detailer"] {
      background: var(--cd-primary);
      color: white;
    }

    .role-btn.active[data-role="customer"] {
      background: var(--cust-primary);
      color: white;
    }

    .demo-badge {
      background: var(--warning);
      color: var(--gray-900);
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    /* Main Layout */
    .app-container {
      display: flex;
      padding-top: 48px;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: white;
      border-right: 1px solid var(--gray-200);
      position: fixed;
      top: 48px;
      left: 0;
      bottom: 0;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--gray-200);
    }

    .sidebar-logo {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-logo-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
    }

    [data-portal="detailerstack"] .sidebar-logo-icon { background: var(--ds-primary); }
    [data-portal="detailer"] .sidebar-logo-icon { background: var(--cd-primary); }
    [data-portal="customer"] .sidebar-logo-icon { background: var(--cust-primary); }

    .sidebar-subtitle {
      font-size: 12px;
      color: var(--gray-500);
      margin-top: 4px;
    }

    /* Client Switcher (DetailerStack only) */
    .client-switcher {
      padding: 16px 20px;
      border-bottom: 1px solid var(--gray-200);
      display: none;
    }

    [data-portal="detailerstack"] .client-switcher {
      display: block;
    }

    .client-switcher label {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--gray-500);
      font-weight: 600;
      letter-spacing: 0.5px;
      display: block;
      margin-bottom: 8px;
    }

    .client-switcher select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--gray-300);
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    /* Navigation */
    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--gray-400);
      font-weight: 600;
      letter-spacing: 0.5px;
      padding: 0 8px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      color: var(--gray-600);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }

    .nav-item:hover {
      background: var(--gray-100);
      color: var(--gray-800);
    }

    .nav-item.active {
      color: var(--gray-900);
    }

    [data-portal="detailerstack"] .nav-item.active {
      background: #f3e8ff;
      color: var(--ds-primary);
    }

    [data-portal="detailer"] .nav-item.active {
      background: #dbeafe;
      color: var(--cd-primary);
    }

    [data-portal="customer"] .nav-item.active {
      background: #d1fae5;
      color: var(--cust-primary);
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .nav-badge {
      margin-left: auto;
      background: var(--error);
      color: white;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: 600;
    }

    /* Main Content */
    .main-content {
      margin-left: var(--sidebar-width);
      flex: 1;
      padding: 24px;
    }

    /* Page Header */
    .page-header {
      margin-bottom: 24px;
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--gray-900);
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--gray-500);
      margin-top: 4px;
    }

    /* Cards */
    .card {
      background: white;
      border-radius: 12px;
      border: 1px solid var(--gray-200);
      padding: 20px;
      margin-bottom: 20px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      border: 1px solid var(--gray-200);
      padding: 20px;
    }

    .stat-label {
      font-size: 13px;
      color: var(--gray-500);
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--gray-900);
    }

    .stat-change {
      font-size: 13px;
      margin-top: 4px;
    }

    .stat-change.positive { color: var(--success); }
    .stat-change.negative { color: var(--error); }

    /* Buttons */
    .btn {
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      color: white;
    }

    [data-portal="detailerstack"] .btn-primary { background: var(--ds-primary); }
    [data-portal="detailerstack"] .btn-primary:hover { background: var(--ds-primary-dark); }
    [data-portal="detailer"] .btn-primary { background: var(--cd-primary); }
    [data-portal="detailer"] .btn-primary:hover { background: var(--cd-primary-dark); }
    [data-portal="customer"] .btn-primary { background: var(--cust-primary); }
    [data-portal="customer"] .btn-primary:hover { background: var(--cust-primary-dark); }

    .btn-secondary {
      background: white;
      border: 1px solid var(--gray-300);
      color: var(--gray-700);
    }

    .btn-secondary:hover {
      background: var(--gray-50);
    }

    /* Tables */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
    }

    th {
      font-size: 12px;
      text-transform: uppercase;
      color: var(--gray-500);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    td {
      font-size: 14px;
    }

    tr:hover {
      background: var(--gray-50);
    }

    /* Status Badges */
    .status-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-active { background: #d1fae5; color: #065f46; }
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-inactive { background: var(--gray-200); color: var(--gray-600); }

    /* Calendar Drag & Drop */
    .calendar-appt {
      cursor: grab;
      user-select: none;
    }

    .calendar-appt:active {
      cursor: grabbing;
    }

    .calendar-appt.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
    }

    .calendar-slot.drag-over {
      background: rgba(37, 99, 235, 0.15) !important;
      border: 2px solid var(--cd-primary) !important;
    }

    /* Portal Sections - Show/Hide */
    .portal-section {
      display: none;
    }

    .portal-section.active {
      display: block;
    }

    /* Hide nav sections based on portal */
    .nav-detailerstack,
    .nav-detailer,
    .nav-customer {
      display: none;
    }

    [data-portal="detailerstack"] .nav-detailerstack { display: block; }
    [data-portal="detailer"] .nav-detailer { display: block; }
    [data-portal="customer"] .nav-customer { display: block; }

    /* User Menu */
    .sidebar-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--gray-200);
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--gray-300);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      color: var(--gray-600);
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
    }

    .user-role {
      font-size: 12px;
      color: var(--gray-500);
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: 16px;
      max-width: 520px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(-20px);
      transition: transform 0.2s ease;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--gray-200);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: var(--gray-100);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--gray-500);
      transition: all 0.15s;
    }

    .modal-close:hover {
      background: var(--gray-200);
      color: var(--gray-700);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--gray-200);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--gray-700);
    }

    .form-input {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.15s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--cd-primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    [data-portal="detailerstack"] .form-input:focus {
      border-color: var(--ds-primary);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }

    [data-portal="customer"] .form-input:focus {
      border-color: var(--cust-primary);
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }

    .form-select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .form-hint {
      font-size: 12px;
      color: var(--gray-500);
      margin-top: 4px;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 64px;
      right: 24px;
      z-index: 3000;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      background: white;
      border-radius: 10px;
      padding: 14px 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      transform: translateX(120%);
      transition: transform 0.3s ease;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .toast-success .toast-icon {
      background: #d1fae5;
      color: #065f46;
    }

    .toast-error .toast-icon {
      background: #fee2e2;
      color: #991b1b;
    }

    .toast-info .toast-icon {
      background: #dbeafe;
      color: #1e40af;
    }

    .toast-message {
      flex: 1;
      font-size: 14px;
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--gray-400);
      cursor: pointer;
      padding: 4px;
    }

    /* Confirmation Dialog */
    .confirm-modal .modal {
      max-width: 400px;
    }

    .confirm-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #fee2e2;
      color: #dc2626;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 24px;
    }

    .confirm-title {
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 8px;
    }

    .confirm-message {
      text-align: center;
      color: var(--gray-500);
      font-size: 14px;
    }

    /* Loading Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .btn-loading {
      position: relative;
      color: transparent !important;
    }

    .btn-loading::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      top: 50%;
      left: 50%;
      margin-left: -8px;
      margin-top: -8px;
      border: 2px solid transparent;
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    /* Search Input */
    .search-container {
      position: relative;
    }

    .search-input {
      width: 280px;
      padding: 8px 14px 8px 36px;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 14px;
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray-400);
      width: 16px;
      height: 16px;
    }

    /* Dropdown Menu */
    .dropdown {
      position: relative;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      min-width: 160px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.15s;
    }

    .dropdown.open .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(4px);
    }

    .dropdown-item {
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.15s;
    }

    .dropdown-item:hover {
      background: var(--gray-50);
    }

    .dropdown-item:first-child {
      border-radius: 8px 8px 0 0;
    }

    .dropdown-item:last-child {
      border-radius: 0 0 8px 8px;
    }

    .dropdown-item.danger {
      color: var(--error);
    }

    .dropdown-divider {
      height: 1px;
      background: var(--gray-200);
      margin: 4px 0;
    }

    /* Clickable Table Rows */
    .table-clickable tbody tr {
      cursor: pointer;
    }

    .table-clickable tbody tr:hover {
      background: var(--gray-100);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--gray-500);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: 8px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 4px;
      background: var(--gray-100);
      padding: 4px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .tab {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      color: var(--gray-600);
      background: transparent;
      border: none;
      transition: all 0.15s;
    }

    .tab:hover {
      color: var(--gray-800);
    }

    .tab.active {
      background: white;
      color: var(--gray-900);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body data-portal="detailerstack">

  <!-- Role Switcher (Demo Only) -->
  <div class="role-switcher">
    <div style="display: flex; align-items: center; gap: 16px;">
      <span class="demo-badge">Demo Mode</span>
      <span class="role-switcher-label">Switch Portal View:</span>
    </div>
    <div class="role-buttons">
      <button class="role-btn active" data-role="detailerstack" onclick="switchPortal('detailerstack')">
        DetailerStack Admin
      </button>
      <button class="role-btn" data-role="detailer" onclick="switchPortal('detailer')">
        Car Detailer
      </button>
      <button class="role-btn" data-role="customer" onclick="switchPortal('customer')">
        Customer
      </button>
    </div>
  </div>

  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">DS</div>
          <span class="logo-text">DetailerStack</span>
        </div>
        <div class="sidebar-subtitle portal-subtitle">Platform Admin</div>
      </div>

      <!-- Client Switcher (DetailerStack only) -->
      <div class="client-switcher">
        <label>Viewing Client</label>
        <select id="clientSelect" onchange="switchClient(this.value)">
          <option value="">-- Platform Overview --</option>
          <option value="elite">Elite Auto Spa</option>
          <option value="pristine">Pristine Detail Co.</option>
          <option value="mobile">Mobile Shine Pro</option>
        </select>
      </div>

      <!-- DetailerStack Navigation -->
      <nav class="sidebar-nav nav-detailerstack">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <div class="nav-item active" onclick="showPage('ds-dashboard')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            Dashboard
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Management</div>
          <div class="nav-item" onclick="showPage('ds-clients')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
            Clients
          </div>
          <div class="nav-item" onclick="showPage('ds-websites')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path></svg>
            Websites
          </div>
          <div class="nav-item" onclick="showPage('ds-users')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            Users
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Platform</div>
          <div class="nav-item" onclick="showPage('ds-templates')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg>
            Templates
          </div>
          <div class="nav-item" onclick="showPage('ds-settings')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            Settings
          </div>
        </div>
      </nav>

      <!-- Car Detailer Navigation -->
      <nav class="sidebar-nav nav-detailer">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <div class="nav-item active" onclick="showPage('cd-dashboard')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            Dashboard
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Bookings</div>
          <div class="nav-item" onclick="showPage('cd-calendar')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            Calendar
          </div>
          <div class="nav-item" onclick="showPage('cd-appointments')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
            Appointments
            <span class="nav-badge">3</span>
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Business</div>
          <div class="nav-item" onclick="showPage('cd-services')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
            Services
          </div>
          <div class="nav-item" onclick="showPage('cd-customers')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
            Customers
          </div>
          <div class="nav-item" onclick="showPage('cd-staff')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            Staff
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Marketing</div>
          <div class="nav-item" onclick="showPage('cd-loyalty')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Loyalty Program
          </div>
          <div class="nav-item" onclick="showPage('cd-reviews')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
            Reviews
          </div>
          <div class="nav-item" onclick="showPage('cd-communications')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
            Communications
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Finance</div>
          <div class="nav-item" onclick="showPage('cd-payments')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
            Payments
          </div>
          <div class="nav-item" onclick="showPage('cd-reports')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
            Reports
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Settings</div>
          <div class="nav-item" onclick="showPage('cd-settings')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            Settings
          </div>
        </div>
      </nav>

      <!-- Customer Navigation -->
      <nav class="sidebar-nav nav-customer">
        <div class="nav-section">
          <div class="nav-section-title">My Account</div>
          <div class="nav-item active" onclick="showPage('cust-dashboard')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            Dashboard
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Services</div>
          <div class="nav-item" onclick="showPage('cust-book')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            Book Service
          </div>
          <div class="nav-item" onclick="showPage('cust-appointments')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            My Appointments
          </div>
          <div class="nav-item" onclick="showPage('cust-packages')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
            My Packages
            <span class="nav-badge">2</span>
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Rewards</div>
          <div class="nav-item" onclick="showPage('cust-loyalty')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Loyalty Points
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Account</div>
          <div class="nav-item" onclick="showPage('cust-vehicles')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h8m-8 5h8m-4 5v-5m-8 9h16a1 1 0 001-1V6a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"></path></svg>
            My Vehicles
          </div>
          <div class="nav-item" onclick="showPage('cust-profile')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            Profile
          </div>
        </div>
      </nav>

      <!-- User Menu Footer -->
      <div class="sidebar-footer">
        <div class="user-menu">
          <div class="user-avatar">JD</div>
          <div class="user-info">
            <div class="user-name user-display-name">John Doe</div>
            <div class="user-role user-display-role">Platform Admin</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Content will be injected by JavaScript based on current page -->
      <div id="page-content">
        <!-- Default: DS Dashboard -->
      </div>
    </main>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Modal: Add Client -->
  <div class="modal-overlay" id="modal-add-client">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add New Client</h3>
        <button class="modal-close" onclick="hideModal('modal-add-client')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Business Name</label>
          <input type="text" class="form-input" id="client-name" placeholder="Elite Auto Spa">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Owner Name</label>
            <input type="text" class="form-input" id="client-owner" placeholder="John Smith">
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="client-email" placeholder="owner@business.com">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Plan</label>
            <select class="form-select" id="client-plan">
              <option value="pro">Pro - $299/mo</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Website Subdomain</label>
            <input type="text" class="form-input" id="client-subdomain" placeholder="eliteautospa">
            <span class="form-hint">.detailerstack.com</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-add-client')">Cancel</button>
        <button class="btn btn-primary" onclick="submitAddClient()">Add Client</button>
      </div>
    </div>
  </div>

  <!-- Modal: Add Service -->
  <div class="modal-overlay" id="modal-add-service">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add New Service</h3>
        <button class="modal-close" onclick="hideModal('modal-add-service')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Service Name</label>
          <input type="text" class="form-input" id="service-name" placeholder="Full Detail">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-input" id="service-description" rows="3" placeholder="Complete interior and exterior detail..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Price ($)</label>
            <input type="number" class="form-input" id="service-price" placeholder="199">
          </div>
          <div class="form-group">
            <label class="form-label">Duration (minutes)</label>
            <input type="number" class="form-input" id="service-duration" placeholder="180">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-select" id="service-category">
            <option value="wash">Wash</option>
            <option value="detail">Detail</option>
            <option value="interior">Interior</option>
            <option value="exterior">Exterior</option>
            <option value="protection">Protection</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-add-service')">Cancel</button>
        <button class="btn btn-primary" onclick="submitAddService()">Add Service</button>
      </div>
    </div>
  </div>

  <!-- Modal: Add Staff -->
  <div class="modal-overlay" id="modal-add-staff">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Team Member</h3>
        <button class="modal-close" onclick="hideModal('modal-add-staff')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="staff-name" placeholder="John Smith">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="staff-email" placeholder="john@business.com">
          </div>
          <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" id="staff-phone" placeholder="(555) 123-4567">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Role</label>
          <select class="form-select" id="staff-role">
            <option value="detailer">Detailer</option>
            <option value="manager">Manager</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Services They Can Perform</label>
          <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;">
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Express Wash</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Full Detail</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Interior Clean</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox"> Ceramic Coating</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox"> Paint Correction</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-add-staff')">Cancel</button>
        <button class="btn btn-primary" onclick="submitAddStaff()">Add Team Member</button>
      </div>
    </div>
  </div>

  <!-- Modal: Add Customer -->
  <div class="modal-overlay" id="modal-add-customer">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add New Customer</h3>
        <button class="modal-close" onclick="hideModal('modal-add-customer')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="customer-name" placeholder="Jane Doe">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="customer-email" placeholder="jane@email.com">
          </div>
          <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" id="customer-phone" placeholder="(555) 123-4567">
          </div>
        </div>
        <div style="border-top: 1px solid var(--gray-200); margin: 20px 0; padding-top: 20px;">
          <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Vehicle Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Make</label>
              <input type="text" class="form-input" id="vehicle-make" placeholder="BMW">
            </div>
            <div class="form-group">
              <label class="form-label">Model</label>
              <input type="text" class="form-input" id="vehicle-model" placeholder="X5">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Year</label>
              <input type="number" class="form-input" id="vehicle-year" placeholder="2022">
            </div>
            <div class="form-group">
              <label class="form-label">Color</label>
              <input type="text" class="form-input" id="vehicle-color" placeholder="Black">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-add-customer')">Cancel</button>
        <button class="btn btn-primary" onclick="submitAddCustomer()">Add Customer</button>
      </div>
    </div>
  </div>

  <!-- Modal: New Booking -->
  <div class="modal-overlay" id="modal-new-booking">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">New Booking</h3>
        <button class="modal-close" onclick="hideModal('modal-new-booking')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Customer</label>
          <select class="form-select" id="booking-customer">
            <option value="">Select customer...</option>
            <option value="1">Sarah Smith - 2022 BMW X5</option>
            <option value="2">John Davis - 2021 Tesla Model 3</option>
            <option value="3">Emily Chen - 2023 Mercedes GLE</option>
            <option value="4">Robert Wilson - 2020 Audi Q7</option>
            <option value="5">Amanda Lee - 2022 Porsche Cayenne</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Service</label>
          <select class="form-select" id="booking-service">
            <option value="">Select service...</option>
            <option value="1">Express Wash - $35 (30 min)</option>
            <option value="2">Full Detail - $199 (3 hrs)</option>
            <option value="3">Interior Clean - $89 (1 hr)</option>
            <option value="4">Exterior Polish - $129 (1.5 hrs)</option>
            <option value="5">Ceramic Coating - $599 (8 hrs)</option>
            <option value="6">Paint Correction - $349 (5 hrs)</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="booking-date">
          </div>
          <div class="form-group">
            <label class="form-label">Time</label>
            <select class="form-select" id="booking-time">
              <option value="9:00">9:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="12:00">12:00 PM</option>
              <option value="13:00">1:00 PM</option>
              <option value="14:00">2:00 PM</option>
              <option value="15:00">3:00 PM</option>
              <option value="16:00">4:00 PM</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Staff Member</label>
          <select class="form-select" id="booking-staff">
            <option value="">Select staff...</option>
            <option value="1">Mike Johnson</option>
            <option value="2">Lisa Park</option>
            <option value="3">Tom Harris</option>
            <option value="4">Jake Wilson</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-input" id="booking-notes" rows="2" placeholder="Any special instructions..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-new-booking')">Cancel</button>
        <button class="btn btn-primary" onclick="submitNewBooking()">Create Booking</button>
      </div>
    </div>
  </div>

  <!-- Modal: Add Vehicle (Customer Portal) -->
  <div class="modal-overlay" id="modal-add-vehicle">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Vehicle</h3>
        <button class="modal-close" onclick="hideModal('modal-add-vehicle')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Make</label>
            <input type="text" class="form-input" id="new-vehicle-make" placeholder="BMW">
          </div>
          <div class="form-group">
            <label class="form-label">Model</label>
            <input type="text" class="form-input" id="new-vehicle-model" placeholder="X5">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Year</label>
            <input type="number" class="form-input" id="new-vehicle-year" placeholder="2022">
          </div>
          <div class="form-group">
            <label class="form-label">Color</label>
            <input type="text" class="form-input" id="new-vehicle-color" placeholder="Black">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">License Plate</label>
          <input type="text" class="form-input" id="new-vehicle-plate" placeholder="ABC1234">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-add-vehicle')">Cancel</button>
        <button class="btn btn-primary" onclick="submitAddVehicle()">Add Vehicle</button>
      </div>
    </div>
  </div>

  <!-- Modal: Book Service (Customer Portal) -->
  <div class="modal-overlay" id="modal-book-service">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Book Service</h3>
        <button class="modal-close" onclick="hideModal('modal-book-service')">&times;</button>
      </div>
      <div class="modal-body">
        <div id="booking-service-name" style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">Full Detail</div>
        <div id="booking-service-price" style="font-size: 24px; font-weight: 700; color: var(--cust-primary); margin-bottom: 20px;">$199</div>

        <div class="form-group">
          <label class="form-label">Select Vehicle</label>
          <select class="form-select" id="book-vehicle">
            <option value="1">2022 BMW X5 (Black)</option>
            <option value="2">2020 Mini Cooper (Red)</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="book-date">
          </div>
          <div class="form-group">
            <label class="form-label">Time</label>
            <select class="form-select" id="book-time">
              <option value="9:00">9:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="13:00">1:00 PM</option>
              <option value="14:00">2:00 PM</option>
              <option value="15:00">3:00 PM</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Special Requests (optional)</label>
          <textarea class="form-input" id="book-notes" rows="2" placeholder="Any special instructions..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-book-service')">Cancel</button>
        <button class="btn btn-primary" onclick="submitBookService()">Confirm Booking</button>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmation Dialog -->
  <div class="modal-overlay confirm-modal" id="modal-confirm">
    <div class="modal">
      <div class="modal-body" style="padding: 32px;">
        <div class="confirm-icon">!</div>
        <div class="confirm-title" id="confirm-title">Are you sure?</div>
        <p class="confirm-message" id="confirm-message">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-confirm')">Cancel</button>
        <button class="btn btn-primary" id="confirm-action" style="background: var(--error);">Delete</button>
      </div>
    </div>
  </div>

  <!-- Modal: Redeem Points -->
  <div class="modal-overlay" id="modal-redeem-points">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Redeem Points</h3>
        <button class="modal-close" onclick="hideModal('modal-redeem-points')">&times;</button>
      </div>
      <div class="modal-body" style="text-align: center;">
        <div style="font-size: 48px; margin-bottom: 16px;">&#x1F381;</div>
        <div style="font-size: 18px; font-weight: 600;" id="redeem-reward-name">$10 Off Any Service</div>
        <div style="font-size: 14px; color: var(--gray-500); margin-top: 8px;" id="redeem-points-cost">Cost: 500 points</div>
        <div style="margin-top: 20px; padding: 16px; background: var(--gray-50); border-radius: 8px;">
          <div style="font-size: 13px; color: var(--gray-500);">Your Balance After Redemption</div>
          <div style="font-size: 24px; font-weight: 700; color: var(--cust-primary);" id="redeem-balance">1,950 points</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-redeem-points')">Cancel</button>
        <button class="btn btn-primary" onclick="submitRedeemPoints()">Confirm Redemption</button>
      </div>
    </div>
  </div>

  <!-- Modal: Send Email -->
  <div class="modal-overlay" id="modal-send-email">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Send Email</h3>
        <button class="modal-close" onclick="hideModal('modal-send-email')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">To</label>
          <select class="form-select" id="email-to">
            <option value="all">All Customers (156)</option>
            <option value="active">Active Customers (89)</option>
            <option value="inactive">Haven't visited in 30+ days (45)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Subject</label>
          <input type="text" class="form-input" id="email-subject" placeholder="Special offer just for you!">
        </div>
        <div class="form-group">
          <label class="form-label">Message</label>
          <textarea class="form-input" id="email-message" rows="6" placeholder="Write your message here..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-send-email')">Cancel</button>
        <button class="btn btn-primary" onclick="submitSendEmail()">Send Email</button>
      </div>
    </div>
  </div>

  <!-- Modal: Edit Appointment -->
  <div class="modal-overlay" id="modal-edit-appointment">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">Edit Appointment</h3>
        <button class="modal-close" onclick="hideModal('modal-edit-appointment')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Customer</label>
            <select class="form-select" id="edit-appt-customer">
              <option value="1">Sarah Smith - 2022 BMW X5</option>
              <option value="2">John Davis - 2021 Tesla Model 3</option>
              <option value="3">Emily Chen - 2023 Mercedes GLE</option>
              <option value="4">Robert Wilson - 2020 Audi Q7</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Service</label>
            <select class="form-select" id="edit-appt-service">
              <option value="1">Express Wash - $35</option>
              <option value="2">Full Detail - $199</option>
              <option value="3">Interior Clean - $89</option>
              <option value="4">Exterior Polish - $129</option>
              <option value="5">Ceramic Coating - $599</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="edit-appt-date">
          </div>
          <div class="form-group">
            <label class="form-label">Time</label>
            <select class="form-select" id="edit-appt-time">
              <option value="9:00">9:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="12:00">12:00 PM</option>
              <option value="13:00">1:00 PM</option>
              <option value="14:00">2:00 PM</option>
              <option value="15:00">3:00 PM</option>
              <option value="16:00">4:00 PM</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Staff Member</label>
            <select class="form-select" id="edit-appt-staff">
              <option value="1">Mike Johnson</option>
              <option value="2">Lisa Park</option>
              <option value="3">Tom Harris</option>
              <option value="4">Jake Wilson</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-select" id="edit-appt-status">
              <option value="confirmed">Confirmed</option>
              <option value="in-progress">In Progress</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
              <option value="no-show">No Show</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-input" id="edit-appt-notes" rows="3" placeholder="Internal notes about this appointment..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Price Adjustment</label>
          <div class="form-row">
            <input type="number" class="form-input" id="edit-appt-price" placeholder="199">
            <select class="form-select" id="edit-appt-discount">
              <option value="">No discount</option>
              <option value="10">10% off</option>
              <option value="15">15% off (Gold member)</option>
              <option value="20">20% off (Promo)</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-edit-appointment')">Cancel</button>
        <button class="btn btn-primary" onclick="submitEditAppointment()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Modal: Appointment Detail -->
  <div class="modal-overlay" id="modal-appointment-detail">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h3 class="modal-title">Appointment Details</h3>
        <button class="modal-close" onclick="hideModal('modal-appointment-detail')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="display: flex; gap: 24px; margin-bottom: 24px;">
          <div style="flex: 1;">
            <div style="font-size: 12px; color: var(--gray-500); text-transform: uppercase; margin-bottom: 4px;">Customer</div>
            <div style="font-size: 18px; font-weight: 600;" id="detail-appt-customer">Sarah Smith</div>
            <div style="color: var(--gray-500);" id="detail-appt-vehicle">2022 BMW X5 (Black)</div>
          </div>
          <div style="flex: 1;">
            <div style="font-size: 12px; color: var(--gray-500); text-transform: uppercase; margin-bottom: 4px;">Service</div>
            <div style="font-size: 18px; font-weight: 600;" id="detail-appt-service">Full Detail</div>
            <div style="color: var(--gray-500);" id="detail-appt-duration">~2-3 hours</div>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 12px; color: var(--gray-500); text-transform: uppercase; margin-bottom: 4px;">Amount</div>
            <div style="font-size: 24px; font-weight: 700; color: var(--cd-primary);" id="detail-appt-amount">$199</div>
            <span class="status-badge status-active" id="detail-appt-status" style="margin-top: 8px; display: inline-block;">confirmed</span>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 24px;">
          <div>
            <div style="font-size: 12px; color: var(--gray-500);">Date</div>
            <div style="font-weight: 500;" id="detail-appt-date">Dec 28, 2024</div>
          </div>
          <div>
            <div style="font-size: 12px; color: var(--gray-500);">Time</div>
            <div style="font-weight: 500;" id="detail-appt-time">10:00 AM</div>
          </div>
          <div>
            <div style="font-size: 12px; color: var(--gray-500);">Assigned To</div>
            <div style="font-weight: 500;" id="detail-appt-staff">Mike Johnson</div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Service Notes</label>
          <textarea class="form-input" id="detail-appt-notes" rows="3" placeholder="Add notes during or after service..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Photos</label>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <div onclick="document.getElementById('photo-upload').click()" style="width: 100px; height: 100px; border: 2px dashed var(--gray-300); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; color: var(--gray-400);">
              <span style="font-size: 24px;">+</span>
              <span style="font-size: 11px;">Add Photo</span>
            </div>
            <div style="width: 100px; height: 100px; background: var(--gray-200); border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative;">
              <span style="font-size: 11px; color: var(--gray-500);">Before</span>
              <span style="position: absolute; top: 4px; right: 4px; background: var(--gray-700); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">Before</span>
            </div>
            <div style="width: 100px; height: 100px; background: var(--gray-200); border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative;">
              <span style="font-size: 11px; color: var(--gray-500);">After</span>
              <span style="position: absolute; top: 4px; right: 4px; background: var(--success); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">After</span>
            </div>
          </div>
          <input type="file" id="photo-upload" style="display: none;" accept="image/*" onchange="handlePhotoUpload(this)">
        </div>
      </div>
      <div class="modal-footer" style="justify-content: space-between;">
        <div>
          <button class="btn btn-secondary" style="color: var(--error);" onclick="cancelFromDetailModal()">Cancel Appointment</button>
        </div>
        <div style="display: flex; gap: 12px;">
          <button class="btn btn-secondary" onclick="editFromDetailModal()">Edit</button>
          <button class="btn btn-primary" onclick="completeFromDetailModal()">Complete & Collect Payment</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Payment -->
  <div class="modal-overlay" id="modal-payment">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">Collect Payment</h3>
        <button class="modal-close" onclick="hideModal('modal-payment')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span>Full Detail</span>
            <span id="payment-service-amount">$199.00</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--gray-500);">
            <span>Gold Member Discount (15%)</span>
            <span id="payment-discount">-$29.85</span>
          </div>
          <div style="border-top: 1px solid var(--gray-300); margin: 12px 0; padding-top: 12px; display: flex; justify-content: space-between; font-weight: 600; font-size: 18px;">
            <span>Subtotal</span>
            <span id="payment-subtotal">$169.15</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Add Tip</label>
          <div style="display: flex; gap: 8px; margin-bottom: 12px;">
            <button class="btn btn-secondary" onclick="setTip(15)" style="flex: 1;">15%</button>
            <button class="btn btn-secondary" onclick="setTip(18)" style="flex: 1;">18%</button>
            <button class="btn btn-secondary" onclick="setTip(20)" style="flex: 1;">20%</button>
            <button class="btn btn-secondary" onclick="setTip(0)" style="flex: 1;">No Tip</button>
          </div>
          <div class="form-row">
            <input type="number" class="form-input" id="payment-tip" placeholder="Custom amount" value="25.37">
            <div style="display: flex; align-items: center; padding: 0 16px; background: var(--gray-100); border-radius: 8px; font-weight: 500;">
              <span id="payment-tip-display">$25.37</span>
            </div>
          </div>
        </div>
        <div style="padding: 16px; background: var(--cd-primary); color: white; border-radius: 8px; margin: 20px 0;">
          <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: 700;">
            <span>Total</span>
            <span id="payment-total">$194.52</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Payment Method</label>
          <div style="display: flex; gap: 12px;">
            <label style="flex: 1; padding: 16px; border: 2px solid var(--cd-primary); border-radius: 8px; text-align: center; cursor: pointer; background: #dbeafe;">
              <input type="radio" name="payment-method" value="card" checked style="display: none;">
              <div style="font-size: 20px; margin-bottom: 4px;">&#x1F4B3;</div>
              <div style="font-weight: 500;">Card</div>
            </label>
            <label style="flex: 1; padding: 16px; border: 2px solid var(--gray-200); border-radius: 8px; text-align: center; cursor: pointer;">
              <input type="radio" name="payment-method" value="cash" style="display: none;">
              <div style="font-size: 20px; margin-bottom: 4px;">&#x1F4B5;</div>
              <div style="font-weight: 500;">Cash</div>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-payment')">Cancel</button>
        <button class="btn btn-primary" onclick="submitPayment()">Process Payment</button>
      </div>
    </div>
  </div>

  <!-- Modal: Edit Customer -->
  <div class="modal-overlay" id="modal-edit-customer">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h3 class="modal-title">Edit Customer</h3>
        <button class="modal-close" onclick="hideModal('modal-edit-customer')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-input" id="edit-cust-name" value="Sarah Smith">
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="edit-cust-email" value="sarah@email.com">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" id="edit-cust-phone" value="(555) 123-4567">
          </div>
          <div class="form-group">
            <label class="form-label">Loyalty Points</label>
            <input type="number" class="form-input" id="edit-cust-points" value="2450" readonly style="background: var(--gray-50);">
            <div style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">Use Loyalty section to adjust points</div>
          </div>
        </div>
        <div style="border-top: 1px solid var(--gray-200); margin: 20px 0; padding-top: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h4 style="font-size: 14px; font-weight: 600;">Vehicles</h4>
            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="addVehicleRow()">+ Add Vehicle</button>
          </div>
          <div id="edit-customer-vehicles">
            <div style="display: flex; gap: 12px; margin-bottom: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
              <input type="text" class="form-input" value="BMW" placeholder="Make" style="flex: 1;">
              <input type="text" class="form-input" value="X5" placeholder="Model" style="flex: 1;">
              <input type="number" class="form-input" value="2022" placeholder="Year" style="width: 80px;">
              <input type="text" class="form-input" value="Black" placeholder="Color" style="width: 80px;">
              <button class="btn btn-secondary" style="padding: 8px; color: var(--error);" onclick="this.parentElement.remove()">&#x2715;</button>
            </div>
            <div style="display: flex; gap: 12px; margin-bottom: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
              <input type="text" class="form-input" value="Mini" placeholder="Make" style="flex: 1;">
              <input type="text" class="form-input" value="Cooper" placeholder="Model" style="flex: 1;">
              <input type="number" class="form-input" value="2020" placeholder="Year" style="width: 80px;">
              <input type="text" class="form-input" value="Red" placeholder="Color" style="width: 80px;">
              <button class="btn btn-secondary" style="padding: 8px; color: var(--error);" onclick="this.parentElement.remove()">&#x2715;</button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Customer Notes</label>
          <textarea class="form-input" id="edit-cust-notes" rows="2" placeholder="Preferences, special requests, etc.">Prefers morning appointments. VIP customer - always uses premium services.</textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Tags</label>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <span style="padding: 4px 12px; background: var(--cd-primary); color: white; border-radius: 20px; font-size: 12px;">VIP</span>
            <span style="padding: 4px 12px; background: var(--gray-200); border-radius: 20px; font-size: 12px;">Regular</span>
            <span style="padding: 4px 12px; background: var(--gray-200); border-radius: 20px; font-size: 12px; cursor: pointer;">+ Add Tag</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-edit-customer')">Cancel</button>
        <button class="btn btn-primary" onclick="submitEditCustomer()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Modal: Customer Detail -->
  <div class="modal-overlay" id="modal-customer-detail">
    <div class="modal" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title">Customer Profile</h3>
        <button class="modal-close" onclick="hideModal('modal-customer-detail')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="display: flex; gap: 24px; margin-bottom: 24px;">
          <div style="width: 80px; height: 80px; background: var(--cd-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 600;">SS</div>
          <div style="flex: 1;">
            <div style="font-size: 24px; font-weight: 700;" id="detail-cust-name">Sarah Smith</div>
            <div style="color: var(--gray-500); margin-top: 4px;" id="detail-cust-contact">sarah@email.com | (555) 123-4567</div>
            <div style="display: flex; gap: 8px; margin-top: 12px;">
              <span class="status-badge status-active">Gold Member</span>
              <span style="padding: 4px 12px; background: var(--cd-primary); color: white; border-radius: 20px; font-size: 12px;">VIP</span>
            </div>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 12px; color: var(--gray-500);">Loyalty Points</div>
            <div style="font-size: 28px; font-weight: 700; color: var(--cd-primary);">2,450</div>
            <button class="btn btn-secondary" style="padding: 4px 12px; font-size: 12px; margin-top: 8px;" onclick="showAdjustPointsModal()">Adjust Points</button>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
          <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700;">12</div>
            <div style="font-size: 12px; color: var(--gray-500);">Total Visits</div>
          </div>
          <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700;">$2,450</div>
            <div style="font-size: 12px; color: var(--gray-500);">Total Spent</div>
          </div>
          <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700;">$204</div>
            <div style="font-size: 12px; color: var(--gray-500);">Avg. Ticket</div>
          </div>
          <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700;">2</div>
            <div style="font-size: 12px; color: var(--gray-500);">Vehicles</div>
          </div>
        </div>
        <div style="margin-bottom: 24px;">
          <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Vehicles</h4>
          <div style="display: flex; gap: 12px;">
            <div style="flex: 1; padding: 12px; border: 1px solid var(--gray-200); border-radius: 8px;">
              <div style="font-weight: 500;">2022 BMW X5</div>
              <div style="font-size: 13px; color: var(--gray-500);">Black | ABC1234</div>
            </div>
            <div style="flex: 1; padding: 12px; border: 1px solid var(--gray-200); border-radius: 8px;">
              <div style="font-weight: 500;">2020 Mini Cooper</div>
              <div style="font-size: 13px; color: var(--gray-500);">Red | XYZ5678</div>
            </div>
          </div>
        </div>
        <div>
          <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Service History</h4>
          <div style="max-height: 200px; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-100);">
              <div>
                <div style="font-weight: 500;">Full Detail</div>
                <div style="font-size: 13px; color: var(--gray-500);">2022 BMW X5 | Dec 15, 2024</div>
              </div>
              <div style="text-align: right;">
                <div style="font-weight: 500;">$199</div>
                <div style="font-size: 13px; color: var(--success);">Completed</div>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-100);">
              <div>
                <div style="font-weight: 500;">Express Wash</div>
                <div style="font-size: 13px; color: var(--gray-500);">2022 BMW X5 | Dec 1, 2024</div>
              </div>
              <div style="text-align: right;">
                <div style="font-weight: 500;">$35</div>
                <div style="font-size: 13px; color: var(--success);">Completed</div>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-100);">
              <div>
                <div style="font-weight: 500;">Interior Clean</div>
                <div style="font-size: 13px; color: var(--gray-500);">2020 Mini Cooper | Nov 20, 2024</div>
              </div>
              <div style="text-align: right;">
                <div style="font-weight: 500;">$89</div>
                <div style="font-size: 13px; color: var(--success);">Completed</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="sendIndividualEmail()">Send Email</button>
        <button class="btn btn-secondary" onclick="openEditCustomerModal()">Edit Customer</button>
        <button class="btn btn-primary" onclick="hideModal('modal-customer-detail'); showModal('modal-new-booking')">Book Appointment</button>
      </div>
    </div>
  </div>

  <!-- Modal: Edit Service -->
  <div class="modal-overlay" id="modal-edit-service">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Service</h3>
        <button class="modal-close" onclick="hideModal('modal-edit-service')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Service Name</label>
          <input type="text" class="form-input" id="edit-service-name" value="Full Detail">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-input" id="edit-service-description" rows="3">Complete interior and exterior detail including wash, wax, and interior deep clean.</textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Price ($)</label>
            <input type="number" class="form-input" id="edit-service-price" value="199">
          </div>
          <div class="form-group">
            <label class="form-label">Duration (minutes)</label>
            <input type="number" class="form-input" id="edit-service-duration" value="180">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-select" id="edit-service-category">
            <option value="wash">Wash</option>
            <option value="detail" selected>Detail</option>
            <option value="interior">Interior</option>
            <option value="exterior">Exterior</option>
            <option value="protection">Protection</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <div style="display: flex; gap: 16px;">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="service-status" value="active" checked> Active
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="service-status" value="inactive"> Inactive
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="justify-content: space-between;">
        <button class="btn btn-secondary" style="color: var(--error);" onclick="deleteService()">Delete Service</button>
        <div style="display: flex; gap: 12px;">
          <button class="btn btn-secondary" onclick="hideModal('modal-edit-service')">Cancel</button>
          <button class="btn btn-primary" onclick="submitEditService()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Edit Staff -->
  <div class="modal-overlay" id="modal-edit-staff">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Team Member</h3>
        <button class="modal-close" onclick="hideModal('modal-edit-staff')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="edit-staff-name" value="Mike Johnson">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="edit-staff-email" value="mike@eliteautospa.com">
          </div>
          <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" id="edit-staff-phone" value="(555) 111-2222">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Role</label>
          <select class="form-select" id="edit-staff-role">
            <option value="detailer">Detailer</option>
            <option value="manager">Manager</option>
            <option value="owner" selected>Owner</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Services They Can Perform</label>
          <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;">
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Express Wash</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Full Detail</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Interior Clean</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Ceramic Coating</label>
            <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Paint Correction</label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Working Hours</label>
          <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; text-align: center;">
            <div style="padding: 8px 4px; background: var(--cd-primary); color: white; border-radius: 6px; font-size: 12px;">Mon<br>8-6</div>
            <div style="padding: 8px 4px; background: var(--cd-primary); color: white; border-radius: 6px; font-size: 12px;">Tue<br>8-6</div>
            <div style="padding: 8px 4px; background: var(--cd-primary); color: white; border-radius: 6px; font-size: 12px;">Wed<br>8-6</div>
            <div style="padding: 8px 4px; background: var(--cd-primary); color: white; border-radius: 6px; font-size: 12px;">Thu<br>8-6</div>
            <div style="padding: 8px 4px; background: var(--cd-primary); color: white; border-radius: 6px; font-size: 12px;">Fri<br>8-6</div>
            <div style="padding: 8px 4px; background: var(--cd-primary); color: white; border-radius: 6px; font-size: 12px;">Sat<br>9-4</div>
            <div style="padding: 8px 4px; background: var(--gray-200); border-radius: 6px; font-size: 12px;">Sun<br>Off</div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="justify-content: space-between;">
        <button class="btn btn-secondary" style="color: var(--error);" onclick="removeStaff()">Remove Staff</button>
        <div style="display: flex; gap: 12px;">
          <button class="btn btn-secondary" onclick="hideModal('modal-edit-staff')">Cancel</button>
          <button class="btn btn-primary" onclick="submitEditStaff()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Adjust Loyalty Points -->
  <div class="modal-overlay" id="modal-adjust-points">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title">Adjust Loyalty Points</h3>
        <button class="modal-close" onclick="hideModal('modal-adjust-points')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 48px; height: 48px; background: var(--cd-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px;" id="adjust-customer-avatar">SS</div>
            <div>
              <div style="font-weight: 600; font-size: 16px;" id="adjust-customer-name">Sarah Smith</div>
              <div style="font-size: 14px; color: var(--gray-500);">Current Balance: <span style="font-weight: 600; color: var(--cd-primary);" id="adjust-current-points">2,450 pts</span></div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Adjustment Type</label>
          <div style="display: flex; gap: 12px;">
            <label style="flex: 1; padding: 12px; border: 2px solid var(--cd-primary); border-radius: 8px; text-align: center; cursor: pointer; background: #dbeafe;" id="adjust-type-add-label" onclick="selectAdjustType('add')">
              <input type="radio" name="adjust-type" value="add" id="adjust-type-add" checked style="display: none;">
              <div style="font-weight: 500;">Add Points</div>
            </label>
            <label style="flex: 1; padding: 12px; border: 2px solid var(--gray-200); border-radius: 8px; text-align: center; cursor: pointer;" id="adjust-type-subtract-label" onclick="selectAdjustType('subtract')">
              <input type="radio" name="adjust-type" value="subtract" id="adjust-type-subtract" style="display: none;">
              <div style="font-weight: 500;">Subtract Points</div>
            </label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Points Amount</label>
          <input type="number" class="form-input" id="adjust-points-amount" placeholder="100" min="1">
        </div>
        <div class="form-group">
          <label class="form-label">Reason</label>
          <select class="form-select" id="adjust-points-reason">
            <option value="">Select reason...</option>
            <option value="bonus">Bonus/Promotion</option>
            <option value="referral">Referral Reward</option>
            <option value="correction">Correction</option>
            <option value="goodwill">Goodwill Gesture</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Notes (optional)</label>
          <input type="text" class="form-input" id="adjust-points-notes" placeholder="Internal note...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-adjust-points')">Cancel</button>
        <button class="btn btn-primary" onclick="submitAdjustPoints()">Apply Adjustment</button>
      </div>
    </div>
  </div>

  <!-- Modal: Individual Email -->
  <div class="modal-overlay" id="modal-individual-email">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Send Email</h3>
        <button class="modal-close" onclick="hideModal('modal-individual-email')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 20px;">
          <div style="font-size: 12px; color: var(--gray-500);">To:</div>
          <div style="font-weight: 500;" id="individual-email-to">Sarah Smith &lt;sarah@email.com&gt;</div>
        </div>
        <div class="form-group">
          <label class="form-label">Template (optional)</label>
          <select class="form-select" id="individual-email-template" onchange="loadEmailTemplate(this.value)">
            <option value="">Start from scratch...</option>
            <option value="followup">Follow-up after service</option>
            <option value="reminder">Appointment reminder</option>
            <option value="promo">Special offer</option>
            <option value="thankyou">Thank you</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Subject</label>
          <input type="text" class="form-input" id="individual-email-subject" placeholder="Your appointment details...">
        </div>
        <div class="form-group">
          <label class="form-label">Message</label>
          <textarea class="form-input" id="individual-email-message" rows="8" placeholder="Hi Sarah, ..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-individual-email')">Cancel</button>
        <button class="btn btn-primary" onclick="submitIndividualEmail()">Send Email</button>
      </div>
    </div>
  </div>

  <!-- Modal: Package Sale -->
  <div class="modal-overlay" id="modal-sell-package">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Sell Service Package</h3>
        <button class="modal-close" onclick="hideModal('modal-sell-package')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Customer</label>
          <select class="form-select" id="package-customer">
            <option value="">Select customer...</option>
            <option value="1">Sarah Smith</option>
            <option value="2">John Davis</option>
            <option value="3">Emily Chen</option>
            <option value="4">Robert Wilson</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Package</label>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <label style="padding: 16px; border: 2px solid var(--cd-primary); border-radius: 8px; cursor: pointer; background: #dbeafe;">
              <input type="radio" name="package-type" value="detail3" checked style="display: none;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">Full Detail Package (3 services)</div>
                  <div style="font-size: 13px; color: var(--gray-500);">Save $100</div>
                </div>
                <div style="font-size: 20px; font-weight: 700; color: var(--cd-primary);">$497</div>
              </div>
            </label>
            <label style="padding: 16px; border: 2px solid var(--gray-200); border-radius: 8px; cursor: pointer;">
              <input type="radio" name="package-type" value="wash5" style="display: none;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">Express Wash Bundle (5 washes)</div>
                  <div style="font-size: 13px; color: var(--gray-500);">Save $40</div>
                </div>
                <div style="font-size: 20px; font-weight: 700; color: var(--cd-primary);">$135</div>
              </div>
            </label>
            <label style="padding: 16px; border: 2px solid var(--gray-200); border-radius: 8px; cursor: pointer;">
              <input type="radio" name="package-type" value="wash10" style="display: none;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;">Express Wash Bundle (10 washes)</div>
                  <div style="font-size: 13px; color: var(--gray-500);">Save $100</div>
                </div>
                <div style="font-size: 20px; font-weight: 700; color: var(--cd-primary);">$250</div>
              </div>
            </label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Expiration</label>
          <select class="form-select" id="package-expiration">
            <option value="6">6 months</option>
            <option value="12" selected>12 months</option>
            <option value="0">Never expires</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-sell-package')">Cancel</button>
        <button class="btn btn-primary" onclick="submitSellPackage()">Process Sale</button>
      </div>
    </div>
  </div>

  <!-- Modal: Configure Loyalty Tiers -->
  <!-- Modal: Add/Edit Reward -->
  <div class="modal-overlay" id="modal-add-reward">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title" id="reward-modal-title">Add Reward</h3>
        <button class="modal-close" onclick="hideModal('modal-add-reward')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Reward Name</label>
          <input type="text" class="form-input" id="reward-name" placeholder="e.g., 10% Off Your Next Service">
        </div>
        <div class="form-group">
          <label class="form-label">Points Cost</label>
          <input type="number" class="form-input" id="reward-points-cost" placeholder="e.g., 200">
          <div style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">How many points customers need to redeem this reward</div>
        </div>
        <div class="form-group">
          <label class="form-label">Discount Type</label>
          <div style="display: flex; gap: 12px;">
            <label style="flex: 1; padding: 12px; border: 2px solid var(--cd-primary); border-radius: 8px; text-align: center; cursor: pointer; background: #dbeafe;" id="discount-type-percent-label">
              <input type="radio" name="discount-type" value="percent" id="discount-type-percent" checked style="display: none;" onchange="updateDiscountTypeUI()">
              <div style="font-weight: 500;">% Off</div>
            </label>
            <label style="flex: 1; padding: 12px; border: 2px solid var(--gray-200); border-radius: 8px; text-align: center; cursor: pointer;" id="discount-type-dollar-label">
              <input type="radio" name="discount-type" value="dollar" id="discount-type-dollar" style="display: none;" onchange="updateDiscountTypeUI()">
              <div style="font-weight: 500;">$ Off</div>
            </label>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" id="discount-value-label">Discount Percentage</label>
          <input type="number" class="form-input" id="reward-discount-value" placeholder="e.g., 10">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-add-reward')">Cancel</button>
        <button class="btn btn-primary" onclick="submitReward()">Save Reward</button>
      </div>
    </div>
  </div>

  <!-- Modal: Redeem Points for Customer -->
  <div class="modal-overlay" id="modal-redeem-for-customer">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">Redeem Points</h3>
        <button class="modal-close" onclick="hideModal('modal-redeem-for-customer')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 48px; height: 48px; background: var(--cd-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px;" id="redeem-customer-avatar">SS</div>
            <div>
              <div style="font-weight: 600; font-size: 16px;" id="redeem-customer-name">Sarah Smith</div>
              <div style="font-size: 14px; color: var(--gray-500);">Balance: <span style="font-weight: 600; color: var(--cd-primary);" id="redeem-customer-points">2,450 pts</span></div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Select Reward</label>
          <div style="display: flex; flex-direction: column; gap: 8px;" id="reward-options-container">
            <!-- Rewards populated by JS -->
          </div>
        </div>
        <div id="redeem-summary" style="display: none; margin-top: 20px; padding: 16px; background: #ecfdf5; border-radius: 8px; border: 1px solid #10b981;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span>Points Cost:</span>
            <span style="font-weight: 600;" id="redeem-cost">-200 pts</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span>New Balance:</span>
            <span style="font-weight: 600; color: var(--cd-primary);" id="redeem-new-balance">2,250 pts</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-redeem-for-customer')">Cancel</button>
        <button class="btn btn-primary" onclick="submitRedemption()" id="btn-submit-redemption" disabled>Redeem & Generate Coupon</button>
      </div>
    </div>
  </div>

  <!-- Modal: Customer Redemption History -->
  <div class="modal-overlay" id="modal-customer-redemptions">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h3 class="modal-title">Redemption History</h3>
        <button class="modal-close" onclick="hideModal('modal-customer-redemptions')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 48px; height: 48px; background: var(--cd-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px;" id="history-customer-avatar">SS</div>
            <div>
              <div style="font-weight: 600; font-size: 16px;" id="history-customer-name">Sarah Smith</div>
              <div style="font-size: 14px; color: var(--gray-500);">Current Balance: <span style="font-weight: 600; color: var(--cd-primary);" id="history-customer-points">2,450 pts</span></div>
            </div>
          </div>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Reward</th>
                <th>Coupon Code</th>
                <th>Points</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="customer-redemptions-body">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('modal-customer-redemptions')">Close</button>
      </div>
    </div>
  </div>

  <!-- Modal: Coupon Generated Success -->
  <div class="modal-overlay" id="modal-coupon-success">
    <div class="modal" style="max-width: 450px; text-align: center;">
      <div class="modal-header">
        <h3 class="modal-title">Coupon Generated!</h3>
        <button class="modal-close" onclick="hideModal('modal-coupon-success')">&times;</button>
      </div>
      <div class="modal-body">
        <div style="font-size: 64px; margin-bottom: 16px;">&#x1F389;</div>
        <div style="font-size: 14px; color: var(--gray-500); margin-bottom: 12px;">Coupon code for customer:</div>
        <div style="background: var(--gray-100); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
          <code style="font-size: 18px; font-weight: 600; letter-spacing: 1px;" id="generated-coupon-code">LOYAL-SS-10OFF-A7X2</code>
        </div>
        <div style="display: flex; gap: 8px; justify-content: center;">
          <button class="btn btn-secondary" onclick="copyCouponCode()">Copy Code</button>
          <button class="btn btn-secondary" onclick="emailCouponCode()">Email to Customer</button>
        </div>
        <div style="margin-top: 20px; padding: 16px; background: #fef3c7; border-radius: 8px; text-align: left;">
          <div style="font-weight: 600; margin-bottom: 8px;">Customer can use this code:</div>
          <ul style="margin: 0; padding-left: 20px; font-size: 14px; color: var(--gray-600);">
            <li>During online booking checkout</li>
            <li>When paying in-store</li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="hideModal('modal-coupon-success'); setLoyaltyTab('activity');">View Redemption Activity</button>
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // STATE MANAGEMENT
    // ===========================================
    let currentPortal = 'detailerstack';
    let currentPage = 'ds-dashboard';
    let currentClient = '';

    // ===========================================
    // DEMO DATA
    // ===========================================
    const demoClients = [
      { id: 'elite', name: 'Elite Auto Spa', owner: 'Mike Johnson', email: 'mike@eliteautospa.com', plan: 'Pro', status: 'active', bookings: 342, revenue: 28500, website: 'eliteautospa.com', loyaltyMembers: 156, activeCoupons: 12, redemptionRate: 31 },
      { id: 'pristine', name: 'Pristine Detail Co.', owner: 'Sarah Chen', email: 'sarah@pristinedetail.com', plan: 'Pro', status: 'active', bookings: 256, revenue: 21200, website: 'pristinedetail.com', loyaltyMembers: 89, activeCoupons: 7, redemptionRate: 24 },
      { id: 'mobile', name: 'Mobile Shine Pro', owner: 'James Wilson', email: 'james@mobileshinepro.com', plan: 'Pro', status: 'active', bookings: 128, revenue: 9800, website: 'mobileshinepro.com', loyaltyMembers: 45, activeCoupons: 3, redemptionRate: 18 },
      { id: 'luxury', name: 'Luxury Auto Care', owner: 'Amanda Roberts', email: 'amanda@luxuryautocare.com', plan: 'Pro', status: 'active', bookings: 512, revenue: 48900, website: 'luxuryautocare.com', loyaltyMembers: 234, activeCoupons: 18, redemptionRate: 28 },
      { id: 'quick', name: 'QuickClean Detailing', owner: 'Tom Harris', email: 'tom@quickclean.com', plan: 'Pro', status: 'pending', bookings: 0, revenue: 0, website: 'quickclean.com', loyaltyMembers: 0, activeCoupons: 0, redemptionRate: 0 }
    ];

    const demoUsers = [
      { id: 1, name: 'John Doe', email: 'john@detailerstack.com', role: 'Platform Admin', client: 'DetailerStack', status: 'active', lastLogin: '2 hours ago' },
      { id: 2, name: 'Jane Smith', email: 'jane@detailerstack.com', role: 'Support', client: 'DetailerStack', status: 'active', lastLogin: '1 day ago' },
      { id: 3, name: 'Mike Johnson', email: 'mike@eliteautospa.com', role: 'Owner', client: 'Elite Auto Spa', status: 'active', lastLogin: '3 hours ago' },
      { id: 4, name: 'Lisa Park', email: 'lisa@eliteautospa.com', role: 'Manager', client: 'Elite Auto Spa', status: 'active', lastLogin: '1 hour ago' },
      { id: 5, name: 'Sarah Chen', email: 'sarah@pristinedetail.com', role: 'Owner', client: 'Pristine Detail Co.', status: 'active', lastLogin: '5 hours ago' },
      { id: 6, name: 'James Wilson', email: 'james@mobileshinepro.com', role: 'Owner', client: 'Mobile Shine Pro', status: 'active', lastLogin: '2 days ago' }
    ];

    const demoActivity = [
      { type: 'booking', client: 'Elite Auto Spa', message: 'New booking: Full Detail for BMW X5', time: '5 min ago' },
      { type: 'payment', client: 'Pristine Detail Co.', message: 'Payment received: $285.00', time: '15 min ago' },
      { type: 'review', client: 'Elite Auto Spa', message: 'New 5-star review on Google', time: '1 hour ago' },
      { type: 'signup', client: 'QuickClean Detailing', message: 'New client signup - pending approval', time: '2 hours ago' },
      { type: 'booking', client: 'Mobile Shine Pro', message: 'New booking: Interior Clean for Tesla Model 3', time: '3 hours ago' },
      { type: 'payment', client: 'Luxury Auto Care', message: 'Payment received: $450.00', time: '4 hours ago' }
    ];

    const demoTemplates = [
      { id: 1, name: 'Website Template v1', description: 'Classic single-page layout', version: '1.0', usedBy: 18 },
      { id: 2, name: 'Website Template v2', description: 'Modern multi-section design', version: '2.0', usedBy: 22 },
      { id: 3, name: 'Website Template v3', description: 'Premium booking-focused layout', version: '3.0', usedBy: 15 },
      { id: 4, name: 'Website Template v4', description: 'Mobile-first responsive design', version: '4.0', usedBy: 8 }
    ];

    // Car Detailer Demo Data
    const demoServices = [
      { id: 1, name: 'Express Wash', description: 'Quick exterior wash and dry', price: 35, duration: 30, category: 'Wash', active: true },
      { id: 2, name: 'Full Detail', description: 'Complete interior and exterior detail', price: 199, duration: 180, category: 'Detail', active: true },
      { id: 3, name: 'Interior Clean', description: 'Deep clean of all interior surfaces', price: 89, duration: 60, category: 'Interior', active: true },
      { id: 4, name: 'Exterior Polish', description: 'Hand polish and wax application', price: 129, duration: 90, category: 'Exterior', active: true },
      { id: 5, name: 'Ceramic Coating', description: 'Professional ceramic coating application', price: 599, duration: 480, category: 'Protection', active: true },
      { id: 6, name: 'Paint Correction', description: 'Remove swirls and scratches', price: 349, duration: 300, category: 'Protection', active: true }
    ];

    const demoAppointments = [
      { id: 1, customer: 'Sarah Smith', vehicle: '2022 BMW X5 (Black)', service: 'Full Detail', date: 'Today', time: '9:00 AM', staff: 'Mike J.', status: 'confirmed', amount: 199 },
      { id: 2, customer: 'John Davis', vehicle: '2021 Tesla Model 3 (White)', service: 'Ceramic Coating', date: 'Today', time: '10:00 AM', staff: 'Lisa P.', status: 'in-progress', amount: 599 },
      { id: 3, customer: 'Emily Chen', vehicle: '2023 Mercedes GLE (Silver)', service: 'Interior Clean', date: 'Today', time: '1:00 PM', staff: 'Mike J.', status: 'confirmed', amount: 89 },
      { id: 4, customer: 'Robert Wilson', vehicle: '2020 Audi Q7 (Blue)', service: 'Full Detail', date: 'Today', time: '3:00 PM', staff: 'Tom H.', status: 'pending', amount: 199 },
      { id: 5, customer: 'Amanda Lee', vehicle: '2022 Porsche Cayenne (Red)', service: 'Express Wash', date: 'Tomorrow', time: '9:00 AM', staff: 'Mike J.', status: 'confirmed', amount: 35 },
      { id: 6, customer: 'Michael Brown', vehicle: '2021 Range Rover (Green)', service: 'Paint Correction', date: 'Tomorrow', time: '11:00 AM', staff: 'Lisa P.', status: 'confirmed', amount: 349 }
    ];

    const demoCustomers = [
      { id: 1, name: 'Sarah Smith', email: 'sarah@email.com', phone: '(555) 123-4567',
        vehicles: [{year: '2022', make: 'BMW', model: 'X5', color: 'Black'}, {year: '2020', make: 'Mini', model: 'Cooper', color: 'Red'}],
        visits: 12, spent: 2450, points: 2450, tier: 'Gold', notes: 'VIP customer, prefers Saturday mornings', tags: ['VIP', 'Referral Source'] },
      { id: 2, name: 'John Davis', email: 'john.d@email.com', phone: '(555) 234-5678',
        vehicles: [{year: '2021', make: 'Tesla', model: 'Model 3', color: 'White'}],
        visits: 8, spent: 1580, points: 1580, tier: 'Silver', notes: '', tags: ['Electric Vehicle'] },
      { id: 3, name: 'Emily Chen', email: 'emily.c@email.com', phone: '(555) 345-6789',
        vehicles: [{year: '2023', make: 'Mercedes', model: 'GLE', color: 'Silver'}],
        visits: 5, spent: 890, points: 890, tier: 'Bronze', notes: 'Allergic to strong fragrances', tags: [] },
      { id: 4, name: 'Robert Wilson', email: 'rwilson@email.com', phone: '(555) 456-7890',
        vehicles: [{year: '2020', make: 'Audi', model: 'Q7', color: 'Blue'}, {year: '2019', make: 'VW', model: 'Golf', color: 'Gray'}],
        visits: 15, spent: 3200, points: 3200, tier: 'Gold', notes: 'Business owner - interested in fleet services', tags: ['VIP', 'Fleet'] },
      { id: 5, name: 'Amanda Lee', email: 'amanda.lee@email.com', phone: '(555) 567-8901',
        vehicles: [{year: '2022', make: 'Porsche', model: 'Cayenne', color: 'Black'}],
        visits: 3, spent: 450, points: 450, tier: 'Bronze', notes: '', tags: ['New Customer'] }
    ];

    const demoStaff = [
      { id: 1, name: 'Mike Johnson', email: 'mike@eliteautospa.com', role: 'Owner', phone: '(555) 111-2222', services: 'All', status: 'active' },
      { id: 2, name: 'Lisa Park', email: 'lisa@eliteautospa.com', role: 'Manager', phone: '(555) 222-3333', services: 'All', status: 'active' },
      { id: 3, name: 'Tom Harris', email: 'tom@eliteautospa.com', role: 'Detailer', phone: '(555) 333-4444', services: 'Wash, Detail, Interior', status: 'active' },
      { id: 4, name: 'Jake Wilson', email: 'jake@eliteautospa.com', role: 'Detailer', phone: '(555) 444-5555', services: 'Wash, Detail', status: 'active' }
    ];

    const demoReviews = [
      { id: 1, customer: 'Sarah Smith', rating: 5, text: 'Amazing detail work! My BMW looks brand new.', platform: 'Google', date: '2 days ago', status: 'published' },
      { id: 2, customer: 'John Davis', rating: 5, text: 'Best ceramic coating in town. Highly recommend!', platform: 'Google', date: '5 days ago', status: 'published' },
      { id: 3, customer: 'Emily Chen', rating: 4, text: 'Great interior cleaning, very thorough.', platform: 'Yelp', date: '1 week ago', status: 'published' },
      { id: 4, customer: 'Robert Wilson', rating: 5, text: 'Professional service every time.', platform: 'Facebook', date: '2 weeks ago', status: 'published' }
    ];

    const demoTransactions = [
      { id: 1, customer: 'Sarah Smith', service: 'Full Detail', amount: 199, tip: 30, date: 'Today, 11:30 AM', status: 'completed', method: 'Card' },
      { id: 2, customer: 'John Davis', service: 'Ceramic Coating', amount: 599, tip: 50, date: 'Today, 10:00 AM', status: 'pending', method: 'Card' },
      { id: 3, customer: 'Emily Chen', service: 'Interior Clean', amount: 89, tip: 15, date: 'Yesterday', status: 'completed', method: 'Card' },
      { id: 4, customer: 'Robert Wilson', service: 'Full Detail', amount: 199, tip: 25, date: 'Yesterday', status: 'completed', method: 'Cash' }
    ];

    // Loyalty Rewards (redeemable with points)
    let demoRewards = [
      { id: 1, name: '5% Off Your Next Service', pointsCost: 100, discountType: 'percent', discountValue: 5, active: true },
      { id: 2, name: '10% Off Your Next Service', pointsCost: 200, discountType: 'percent', discountValue: 10, active: true },
      { id: 3, name: '15% Off Your Next Service', pointsCost: 300, discountType: 'percent', discountValue: 15, active: true }
    ];

    // Redemption history (when customers redeem points for coupons)
    let demoRedemptions = [
      { id: 1, customerId: 1, customerName: 'Sarah Smith', rewardId: 2, rewardName: '10% Off Your Next Service', pointsSpent: 200, couponCode: 'LOYAL-SS-10OFF-A7X2', status: 'active', redeemedAt: 'Dec 20, 2024', usedAt: null },
      { id: 2, customerId: 4, customerName: 'Robert Wilson', rewardId: 3, rewardName: '15% Off Your Next Service', pointsSpent: 300, couponCode: 'LOYAL-RW-15OFF-K9M3', status: 'used', redeemedAt: 'Dec 18, 2024', usedAt: 'Dec 19, 2024' },
      { id: 3, customerId: 2, customerName: 'John Davis', rewardId: 1, rewardName: '5% Off Your Next Service', pointsSpent: 100, couponCode: 'LOYAL-JD-5OFF-P4Q8', status: 'active', redeemedAt: 'Dec 15, 2024', usedAt: null }
    ];

    let nextRedemptionId = 4;

    // Generate unique coupon code
    function generateCouponCode(customerName, discountValue) {
      const initials = customerName.split(' ').map(w => w[0]).join('').toUpperCase();
      const randomPart = Math.random().toString(36).substring(2, 6).toUpperCase();
      return `LOYAL-${initials}-${discountValue}OFF-${randomPart}`;
    }

    // ===========================================
    // PORTAL SWITCHING
    // ===========================================
    function switchPortal(portal) {
      currentPortal = portal;
      document.body.setAttribute('data-portal', portal);

      // Update role buttons
      document.querySelectorAll('.role-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.role === portal);
      });

      // Update sidebar content
      updateSidebarForPortal(portal);

      // Show default page for portal
      const defaultPages = {
        'detailerstack': 'ds-dashboard',
        'detailer': 'cd-dashboard',
        'customer': 'cust-dashboard'
      };
      showPage(defaultPages[portal]);
    }

    function updateSidebarForPortal(portal) {
      const logoText = document.querySelector('.logo-text');
      const subtitle = document.querySelector('.portal-subtitle');
      const userName = document.querySelector('.user-display-name');
      const userRole = document.querySelector('.user-display-role');
      const userAvatar = document.querySelector('.user-avatar');

      const config = {
        'detailerstack': {
          logo: 'DetailerStack',
          subtitle: 'Platform Admin',
          user: 'John Doe',
          role: 'Platform Admin',
          avatar: 'JD'
        },
        'detailer': {
          logo: 'Elite Auto Spa',
          subtitle: 'Business Portal',
          user: 'Mike Johnson',
          role: 'Owner',
          avatar: 'MJ'
        },
        'customer': {
          logo: 'Elite Auto Spa',
          subtitle: 'Customer Portal',
          user: 'Sarah Smith',
          role: 'Gold Member',
          avatar: 'SS'
        }
      };

      const c = config[portal];
      logoText.textContent = c.logo;
      subtitle.textContent = c.subtitle;
      userName.textContent = c.user;
      userRole.textContent = c.role;
      userAvatar.textContent = c.avatar;
    }

    // ===========================================
    // PAGE NAVIGATION
    // ===========================================
    function showPage(pageId) {
      currentPage = pageId;

      // Update nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      event?.target?.closest('.nav-item')?.classList.add('active');

      // Render page content
      renderPage(pageId);
    }

    function renderPage(pageId) {
      const content = document.getElementById('page-content');

      // Page content templates - will be expanded in later stages
      const pages = {
        // DetailerStack Pages
        'ds-dashboard': renderDSDashboard,
        'ds-clients': renderDSClients,
        'ds-websites': renderDSWebsites,
        'ds-users': renderDSUsers,
        'ds-templates': renderDSTemplates,
        'ds-settings': renderDSSettings,

        // Car Detailer Pages
        'cd-dashboard': renderCDDashboard,
        'cd-calendar': renderCDCalendar,
        'cd-appointments': renderCDAppointments,
        'cd-services': renderCDServices,
        'cd-customers': renderCDCustomers,
        'cd-staff': renderCDStaff,
        'cd-loyalty': renderCDLoyalty,
        'cd-reviews': renderCDReviews,
        'cd-communications': renderCDCommunications,
        'cd-payments': renderCDPayments,
        'cd-reports': renderCDReports,
        'cd-settings': renderCDSettings,

        // Customer Pages
        'cust-dashboard': renderCustDashboard,
        'cust-book': renderCustBook,
        'cust-appointments': renderCustAppointments,
        'cust-packages': renderCustPackages,
        'cust-loyalty': renderCustLoyalty,
        'cust-vehicles': renderCustVehicles,
        'cust-profile': renderCustProfile
      };

      if (pages[pageId]) {
        content.innerHTML = pages[pageId]();
      } else {
        content.innerHTML = `<div class="card"><p>Page not found: ${pageId}</p></div>`;
      }
    }

    // ===========================================
    // CLIENT SWITCHING (DetailerStack)
    // ===========================================
    function switchClient(clientId) {
      currentClient = clientId;
      // Will update view based on selected client
      renderPage(currentPage);
    }

    function jumpToClient(clientId) {
      // Switch to detailer portal as if viewing their account
      const client = demoClients.find(c => c.id === clientId);
      if (client) {
        document.querySelector('.logo-text').textContent = client.name;
        document.querySelector('.portal-subtitle').textContent = 'Viewing as Admin';
        switchPortal('detailer');
      }
    }

    function showModal(modalId) {
      alert('Modal functionality will be added: ' + modalId);
    }

    // ===========================================
    // PAGE RENDERERS - Placeholders for Stage 1
    // ===========================================

    // DetailerStack Pages
    function renderDSDashboard() {
      const activityIcons = {
        booking: '<svg width="16" height="16" fill="none" stroke="#2563eb" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>',
        payment: '<svg width="16" height="16" fill="none" stroke="#10b981" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
        review: '<svg width="16" height="16" fill="none" stroke="#f59e0b" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>',
        signup: '<svg width="16" height="16" fill="none" stroke="#7c3aed" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>'
      };

      const activityHtml = demoActivity.map(a => `
        <div style="display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--gray-100);">
          <div style="width: 32px; height: 32px; background: var(--gray-100); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            ${activityIcons[a.type]}
          </div>
          <div style="flex: 1;">
            <div style="font-size: 14px; font-weight: 500;">${a.message}</div>
            <div style="font-size: 12px; color: var(--gray-500);">${a.client}</div>
          </div>
          <div style="font-size: 12px; color: var(--gray-400);">${a.time}</div>
        </div>
      `).join('');

      return `
        <div class="page-header">
          <h1 class="page-title">Platform Dashboard</h1>
          <p class="page-subtitle">Overview of all DetailerStack clients and platform metrics</p>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Active Clients</div>
            <div class="stat-value">24</div>
            <div class="stat-change positive">+3 this month</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Bookings (All Clients)</div>
            <div class="stat-value">1,847</div>
            <div class="stat-change positive">+12% vs last month</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Platform Revenue</div>
            <div class="stat-value">$4,280</div>
            <div class="stat-change positive">+8% vs last month</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Active Users</div>
            <div class="stat-value">156</div>
            <div class="stat-change positive">+18 this week</div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Recent Activity</h3>
              <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;">View All</button>
            </div>
            ${activityHtml}
          </div>
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Top Performing Clients</h3>
            </div>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Client</th>
                    <th>Bookings</th>
                    <th>Revenue</th>
                  </tr>
                </thead>
                <tbody>
                  ${demoClients.filter(c => c.status === 'active').sort((a,b) => b.revenue - a.revenue).slice(0,4).map(c => `
                    <tr>
                      <td><strong>${c.name}</strong></td>
                      <td>${c.bookings}</td>
                      <td>$${c.revenue.toLocaleString()}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }

    function renderDSClients() {
      const clientRows = demoClients.map(c => `
        <tr>
          <td>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 40px; height: 40px; background: var(--ds-primary); color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px;">
                ${c.name.split(' ').map(w => w[0]).join('').slice(0,2)}
              </div>
              <div>
                <div style="font-weight: 600;">${c.name}</div>
                <div style="font-size: 12px; color: var(--gray-500);">${c.website}</div>
              </div>
            </div>
          </td>
          <td>${c.owner}</td>
          <td><span class="status-badge status-${c.status}">${c.status}</span></td>
          <td>${c.bookings}</td>
          <td>$${c.revenue.toLocaleString()}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-weight: 500;">${c.loyaltyMembers}</span>
              <span style="font-size: 11px; color: var(--gray-400);">members</span>
            </div>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: 6px;">
              <span style="color: ${c.activeCoupons > 0 ? 'var(--success)' : 'var(--gray-400)'}; font-weight: 500;">${c.activeCoupons}</span>
              ${c.redemptionRate > 0 ? `<span style="font-size: 11px; color: var(--gray-400);">(${c.redemptionRate}%)</span>` : ''}
            </div>
          </td>
          <td>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" onclick="jumpToClient('${c.id}')">Enter Portal</button>
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;">Edit</button>
            </div>
          </td>
        </tr>
      `).join('');

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Clients</h1>
            <p class="page-subtitle">Manage car detailing businesses on the platform</p>
          </div>
          <button class="btn btn-primary" onclick="showModal('modal-add-client')">+ Add Client</button>
        </div>
        <div class="card">
          <div class="card-header">
            <div style="display: flex; gap: 12px;">
              <input type="text" placeholder="Search clients..." style="padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px; width: 250px;">
              <select style="padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px;">
                <option>All Status</option>
                <option>Active</option>
                <option>Pending</option>
                <option>Inactive</option>
              </select>
            </div>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Business</th>
                  <th>Owner</th>
                  <th>Status</th>
                  <th>Bookings</th>
                  <th>Revenue</th>
                  <th>Loyalty Members</th>
                  <th>Active Coupons</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${clientRows}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    function renderDSWebsites() {
      const websiteCards = demoClients.filter(c => c.status === 'active').map(c => `
        <div class="card" style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="display: flex; gap: 16px; align-items: start;">
              <div style="width: 120px; height: 80px; background: var(--gray-200); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--gray-400); font-size: 12px;">Preview</div>
              <div>
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">${c.name}</h3>
                <a href="#" style="color: var(--ds-primary); font-size: 14px; text-decoration: none;">${c.website}</a>
                <div style="margin-top: 8px; display: flex; gap: 16px; font-size: 13px; color: var(--gray-500);">
                  <span>Version: 2.1.0</span>
                  <span>Last updated: 3 days ago</span>
                  <span class="status-badge status-active">Live</span>
                </div>
              </div>
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 13px;">Preview</button>
              <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 13px;">Edit Funnel</button>
              <button class="btn btn-primary" style="padding: 8px 12px; font-size: 13px;">Upload New Version</button>
            </div>
          </div>
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--gray-200);">
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 8px;">Booking Funnel Fields</div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Name</span>
              <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Email</span>
              <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Phone</span>
              <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Vehicle Make/Model</span>
              ${c.id === 'mobile' ? '<span style="background: #dbeafe; padding: 4px 10px; border-radius: 4px; font-size: 12px; color: #1d4ed8;">Service Address</span>' : '<span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Location Selection</span>'}
              <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Service Selection</span>
              <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Date/Time</span>
            </div>
          </div>
        </div>
      `).join('');

      return `
        <div class="page-header">
          <h1 class="page-title">Websites</h1>
          <p class="page-subtitle">Manage client websites and booking funnels</p>
        </div>
        ${websiteCards}
      `;
    }

    function renderDSUsers() {
      const userRows = demoUsers.map(u => `
        <tr>
          <td>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; background: var(--gray-300); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 13px;">
                ${u.name.split(' ').map(w => w[0]).join('')}
              </div>
              <div>
                <div style="font-weight: 500;">${u.name}</div>
                <div style="font-size: 12px; color: var(--gray-500);">${u.email}</div>
              </div>
            </div>
          </td>
          <td><span class="status-badge ${u.role === 'Platform Admin' ? 'status-active' : u.role === 'Owner' ? 'status-pending' : 'status-inactive'}">${u.role}</span></td>
          <td>${u.client}</td>
          <td><span class="status-badge status-${u.status}">${u.status}</span></td>
          <td style="color: var(--gray-500);">${u.lastLogin}</td>
          <td>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;">Edit</button>
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px; color: var(--error);">Disable</button>
            </div>
          </td>
        </tr>
      `).join('');

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Users</h1>
            <p class="page-subtitle">Manage platform and client users</p>
          </div>
          <button class="btn btn-primary" onclick="showToast('User invitation form coming soon!', 'info')">+ Add User</button>
        </div>
        <div class="card">
          <div class="card-header">
            <div style="display: flex; gap: 12px;">
              <input type="text" placeholder="Search users..." style="padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px; width: 250px;">
              <select style="padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px;">
                <option>All Clients</option>
                <option>DetailerStack</option>
                ${demoClients.map(c => `<option>${c.name}</option>`).join('')}
              </select>
              <select style="padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px;">
                <option>All Roles</option>
                <option>Platform Admin</option>
                <option>Support</option>
                <option>Owner</option>
                <option>Manager</option>
                <option>Staff</option>
              </select>
            </div>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>User</th>
                  <th>Role</th>
                  <th>Client</th>
                  <th>Status</th>
                  <th>Last Login</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${userRows}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    function renderDSTemplates() {
      const templateCards = demoTemplates.map(t => `
        <div class="card" style="margin-bottom: 12px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 16px; align-items: center;">
              <div style="width: 80px; height: 60px; background: linear-gradient(135deg, var(--ds-primary-light) 0%, var(--ds-primary) 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 14px;">v${t.version}</div>
              <div>
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">${t.name}</h3>
                <div style="display: flex; gap: 16px; font-size: 13px; color: var(--gray-500);">
                  <span>${t.description}</span>
                  <span></span>
                  <span>Used by ${t.usedBy} clients</span>
                </div>
              </div>
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 13px;">Preview</button>
              <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 13px;">Edit</button>
            </div>
          </div>
        </div>
      `).join('');

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Website Templates</h1>
            <p class="page-subtitle">Pre-built website designs for client booking pages</p>
          </div>
          <button class="btn btn-primary" onclick="showToast('Template editor coming soon!', 'info')">+ Create Template</button>
        </div>
        ${templateCards}
      `;
    }

    function renderDSSettings() {
      return `
        <div class="page-header">
          <h1 class="page-title">Platform Settings</h1>
          <p class="page-subtitle">Configure integrations and platform options</p>
        </div>

        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Payment Integration</h3>
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 48px; height: 48px; background: #635bff; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">S</div>
              <div>
                <div style="font-weight: 600;">Stripe Connect</div>
                <div style="font-size: 13px; color: var(--gray-500);">Process payments and manage payouts</div>
              </div>
            </div>
            <span class="status-badge status-active">Connected</span>
          </div>
          <div style="font-size: 13px; color: var(--gray-500);">
            Platform fee: 2.5% per transaction | Payout schedule: Daily
          </div>
        </div>

        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">SMS Notifications</h3>
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 48px; height: 48px; background: #f22f46; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">T</div>
              <div>
                <div style="font-weight: 600;">Twilio</div>
                <div style="font-size: 13px; color: var(--gray-500);">SMS appointment reminders and notifications</div>
              </div>
            </div>
            <span class="status-badge status-active">Connected</span>
          </div>
          <div style="font-size: 13px; color: var(--gray-500);">
            Messages sent this month: 2,847 | Account balance: $156.23
          </div>
        </div>

        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Review Platforms</h3>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; text-align: center;">
              <div style="font-weight: 600; margin-bottom: 4px;">Google Business</div>
              <span class="status-badge status-active">Active</span>
            </div>
            <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; text-align: center;">
              <div style="font-weight: 600; margin-bottom: 4px;">Facebook</div>
              <span class="status-badge status-active">Active</span>
            </div>
            <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; text-align: center;">
              <div style="font-weight: 600; margin-bottom: 4px;">Yelp</div>
              <span class="status-badge status-active">Active</span>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Calendar Integration</h3>
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--gray-50); border-radius: 8px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 48px; height: 48px; background: #4285f4; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">G</div>
              <div>
                <div style="font-weight: 600;">Google Calendar</div>
                <div style="font-size: 13px; color: var(--gray-500);">Two-way sync for appointments</div>
              </div>
            </div>
            <span class="status-badge status-active">Enabled</span>
          </div>
        </div>
      `;
    }

    // Car Detailer Pages
    function renderCDDashboard() {
      const todayAppts = demoAppointments.filter(a => a.date === 'Today');
      const scheduleHtml = todayAppts.map(a => `
        <div style="display: flex; align-items: center; gap: 16px; padding: 12px 0; border-bottom: 1px solid var(--gray-100); cursor: pointer;" onclick="openAppointmentDetail('${a.id}')">
          <div style="width: 60px; text-align: center;">
            <div style="font-weight: 600; color: var(--cd-primary);">${a.time}</div>
          </div>
          <div style="flex: 1;">
            <div style="font-weight: 500;">${a.customer}</div>
            <div style="font-size: 13px; color: var(--gray-500);">${a.vehicle}</div>
          </div>
          <div style="text-align: right;">
            <div style="font-weight: 500;">${a.service}</div>
            <div style="font-size: 13px; color: var(--gray-500);">${a.staff}</div>
          </div>
          <span class="status-badge status-${a.status === 'confirmed' ? 'active' : a.status === 'in-progress' ? 'pending' : 'inactive'}">${a.status}</span>
          <div style="display: flex; gap: 6px;" onclick="event.stopPropagation()">
            <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 11px;" onclick="openEditAppointment('${a.id}')">Edit</button>
            <button class="btn btn-primary" style="padding: 4px 8px; font-size: 11px;" onclick="openPaymentModal('${a.id}')">${a.status === 'completed' ? 'Paid' : 'Complete'}</button>
          </div>
        </div>
      `).join('');

      return `
        <div class="page-header">
          <h1 class="page-title">Dashboard</h1>
          <p class="page-subtitle">Welcome back, Mike! Here's your business overview.</p>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Today's Appointments</div>
            <div class="stat-value">${todayAppts.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">This Week's Revenue</div>
            <div class="stat-value">$2,340</div>
            <div class="stat-change positive">+15% vs last week</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending Reviews</div>
            <div class="stat-value">8</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Loyalty Members</div>
            <div class="stat-value">${demoCustomers.length}</div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Today's Schedule</h3>
            <button class="btn btn-primary" onclick="showModal('modal-new-booking')">+ New Booking</button>
          </div>
          ${scheduleHtml}
        </div>
      `;
    }

    function renderCDCalendar() {
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const dates = ['22', '23', '24', '25', '26', '27', '28'];
      const hours = ['8 AM', '9 AM', '10 AM', '11 AM', '12 PM', '1 PM', '2 PM', '3 PM', '4 PM', '5 PM'];

      // Map appointments to calendar slots
      const calendarSlots = {};
      demoAppointments.forEach(a => {
        // Parse time to get hour
        const hour = a.time.match(/(\d+):/)?.[1];
        const isPM = a.time.includes('PM');
        let hourKey = parseInt(hour);
        if (isPM && hourKey !== 12) hourKey += 12;
        if (!isPM && hourKey === 12) hourKey = 0;

        // Map date to day column (Today = Sun for demo)
        let dayIndex = a.date === 'Today' ? 0 : a.date === 'Tomorrow' ? 1 : 2;

        const key = `${hourKey}-${dayIndex}`;
        if (!calendarSlots[key]) calendarSlots[key] = [];
        calendarSlots[key].push(a);
      });

      const getSlotAppointments = (hourStr, dayIndex) => {
        let hourKey = parseInt(hourStr);
        if (hourStr.includes('PM') && hourKey !== 12) hourKey += 12;
        if (hourStr.includes('AM') && hourKey === 12) hourKey = 0;
        const key = `${hourKey}-${dayIndex}`;
        return calendarSlots[key] || [];
      };

      const statusColors = {
        'confirmed': { bg: '#dbeafe', color: '#1d4ed8' },
        'in-progress': { bg: '#fef3c7', color: '#92400e' },
        'completed': { bg: '#d1fae5', color: '#065f46' }
      };

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Calendar</h1>
            <p class="page-subtitle">View and manage your booking calendar</p>
          </div>
          <div style="display: flex; gap: 8px; align-items: center;">
            <button class="btn btn-primary" onclick="showModal('modal-new-booking')">+ New Booking</button>
            <button class="btn btn-secondary" onclick="showToast('Showing today', 'info')">Today</button>
            <button class="btn btn-secondary">&lt;</button>
            <button class="btn btn-secondary">&gt;</button>
            <span style="padding: 10px 16px; font-weight: 600;">December 22 - 28, 2024</span>
          </div>
        </div>
        <div class="card" style="margin-bottom: 16px;">
          <div style="display: flex; gap: 16px; align-items: center;">
            <span style="font-size: 13px; color: var(--gray-500);">Filter by staff:</span>
            <select style="padding: 6px 12px; border: 1px solid var(--gray-300); border-radius: 6px;" onchange="showToast('Staff filter: ' + this.value, 'info')">
              <option value="all">All Staff</option>
              ${demoStaff.map(s => `<option value="${s.id}">${s.name}</option>`).join('')}
            </select>
            <div style="display: flex; gap: 12px; margin-left: auto;">
              <span style="display: flex; align-items: center; gap: 4px;"><span style="width: 12px; height: 12px; background: #dbeafe; border-radius: 3px;"></span> Confirmed</span>
              <span style="display: flex; align-items: center; gap: 4px;"><span style="width: 12px; height: 12px; background: #fef3c7; border-radius: 3px;"></span> In Progress</span>
              <span style="display: flex; align-items: center; gap: 4px;"><span style="width: 12px; height: 12px; background: #d1fae5; border-radius: 3px;"></span> Completed</span>
            </div>
          </div>
        </div>
        <div class="card" style="overflow-x: auto;">
          <div style="display: grid; grid-template-columns: 60px repeat(7, 1fr); min-width: 800px;">
            <div style="padding: 12px; border-bottom: 1px solid var(--gray-200);"></div>
            ${days.map((d, i) => `<div style="padding: 12px; text-align: center; border-bottom: 1px solid var(--gray-200); border-left: 1px solid var(--gray-200); ${i === 0 ? 'background: #dbeafe;' : ''}">
              <div style="font-weight: 600;">${d}</div>
              <div style="font-size: 20px; font-weight: 700; color: ${i === 0 ? 'var(--cd-primary)' : 'var(--gray-600)'};">${dates[i]}</div>
            </div>`).join('')}
            ${hours.map(h => `
              <div style="padding: 8px; font-size: 12px; color: var(--gray-500); border-bottom: 1px solid var(--gray-100);">${h}</div>
              ${days.map((d, i) => {
                const appts = getSlotAppointments(h, i);
                return `<div class="calendar-slot" data-day="${i}" data-hour="${h}" style="padding: 4px; min-height: 60px; border-bottom: 1px solid var(--gray-100); border-left: 1px solid var(--gray-100); cursor: pointer; ${i === 0 ? 'background: rgba(37, 99, 235, 0.05);' : ''} transition: background 0.2s;" onclick="openBookingWithTime(${i}, '${h}')" ondragover="handleDragOver(event)" ondrop="handleDrop(event, ${i}, '${h}')" ondragleave="handleDragLeave(event)">
                  ${appts.map(a => {
                    const colors = statusColors[a.status] || statusColors['confirmed'];
                    return `<div class="calendar-appt" draggable="true" data-appt-id="${a.id}" style="background: ${colors.bg}; color: ${colors.color}; padding: 4px 6px; border-radius: 4px; font-size: 11px; margin-bottom: 2px; cursor: grab; transition: transform 0.1s, opacity 0.2s, box-shadow 0.2s;" onclick="event.stopPropagation(); openAppointmentDetail('${a.id}')" ondragstart="handleDragStart(event, '${a.id}')" ondragend="handleDragEnd(event)">
                      <div style="font-weight: 600;">${a.service.split(' ')[0]}</div>
                      <div>${a.customer.split(' ')[0]} - ${a.staff}</div>
                    </div>`;
                  }).join('')}
                </div>`;
              }).join('')}
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderCDAppointments() {
      // Filter appointments based on current filter
      let filteredAppts = demoAppointments;
      if (currentAppointmentFilter === 'today') {
        filteredAppts = demoAppointments.filter(a => a.date === 'Today');
      } else if (currentAppointmentFilter === 'upcoming') {
        filteredAppts = demoAppointments.filter(a => a.date !== 'Today' && a.status !== 'completed');
      } else if (currentAppointmentFilter === 'completed') {
        filteredAppts = demoAppointments.filter(a => a.status === 'completed');
      }

      const apptRows = filteredAppts.map(a => `
        <tr onclick="openAppointmentDetail('${a.id}')" style="cursor: pointer;">
          <td>
            <div style="font-weight: 500;">${a.customer}</div>
            <div style="font-size: 12px; color: var(--gray-500);">${a.vehicle}</div>
          </td>
          <td>${a.service}</td>
          <td>${a.date}</td>
          <td>${a.time}</td>
          <td>${a.staff}</td>
          <td>$${a.amount}</td>
          <td><span class="status-badge status-${a.status === 'confirmed' ? 'active' : a.status === 'in-progress' ? 'pending' : 'inactive'}">${a.status}</span></td>
          <td>
            <div style="display: flex; gap: 8px;" onclick="event.stopPropagation()">
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" onclick="openEditAppointment('${a.id}')">Edit</button>
              <button class="btn btn-primary" style="padding: 6px 10px; font-size: 12px;" onclick="openPaymentModal('${a.id}')">${a.status === 'completed' ? 'View' : 'Complete'}</button>
            </div>
          </td>
        </tr>
      `).join('');

      const filterBtn = (filter, label) => `
        <button class="btn ${currentAppointmentFilter === filter ? 'btn-primary' : 'btn-secondary'}"
                style="padding: 8px 16px;" onclick="filterAppointments('${filter}')">${label}</button>
      `;

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Appointments</h1>
            <p class="page-subtitle">Manage all appointments (${filteredAppts.length} shown)</p>
          </div>
          <button class="btn btn-primary" onclick="showModal('modal-new-booking')">+ New Appointment</button>
        </div>
        <div class="card">
          <div class="card-header">
            <div style="display: flex; gap: 8px;">
              ${filterBtn('all', 'All')}
              ${filterBtn('today', 'Today')}
              ${filterBtn('upcoming', 'Upcoming')}
              ${filterBtn('completed', 'Completed')}
            </div>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr><th>Customer</th><th>Service</th><th>Date</th><th>Time</th><th>Staff</th><th>Amount</th><th>Status</th><th>Actions</th></tr>
              </thead>
              <tbody>${apptRows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    function renderCDServices() {
      const serviceCards = demoServices.map(s => `
        <div class="card" style="margin-bottom: 12px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 16px; align-items: center;">
              <div style="width: 48px; height: 48px; background: ${s.active ? '#dbeafe' : '#fef2f2'}; color: ${s.active ? '#1d4ed8' : '#dc2626'}; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 600;">${s.duration}m</div>
              <div>
                <div style="font-weight: 600; font-size: 16px;">${s.name} ${!s.active ? '<span style="color: var(--error); font-size: 12px;">(Inactive)</span>' : ''}</div>
                <div style="font-size: 13px; color: var(--gray-500);">${s.description}</div>
                <div style="font-size: 12px; color: var(--gray-400); margin-top: 4px;">Category: ${s.category}</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 24px;">
              <div style="text-align: right;">
                <div style="font-size: 24px; font-weight: 700; color: var(--cd-primary);">$${s.price}</div>
                <div style="font-size: 12px; color: var(--gray-500);">${s.duration} minutes</div>
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 13px;" onclick="openEditServiceModal('${s.id}')">Edit</button>
              </div>
            </div>
          </div>
        </div>
      `).join('');

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Services</h1>
            <p class="page-subtitle">Manage your service menu (${demoServices.length} services)</p>
          </div>
          <button class="btn btn-primary" onclick="showModal('modal-add-service')">+ Add Service</button>
        </div>
        ${serviceCards}
      `;
    }

    function renderCDCustomers() {
      // Filter customers based on search
      let filteredCustomers = demoCustomers;
      if (customerSearchQuery) {
        filteredCustomers = demoCustomers.filter(c =>
          c.name.toLowerCase().includes(customerSearchQuery) ||
          c.email.toLowerCase().includes(customerSearchQuery) ||
          c.phone.includes(customerSearchQuery)
        );
      }

      const customerRows = filteredCustomers.map(c => `
        <tr onclick="openCustomerDetail(${c.id})" style="cursor: pointer;">
          <td>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 40px; height: 40px; background: var(--cd-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                ${c.name.split(' ').map(w => w[0]).join('')}
              </div>
              <div>
                <div style="font-weight: 500;">${c.name}</div>
                <div style="font-size: 12px; color: var(--gray-500);">${c.email}</div>
              </div>
            </div>
          </td>
          <td>${c.phone}</td>
          <td>${c.vehicles.map(v => v.year + ' ' + v.make + ' ' + v.model).join(', ')}</td>
          <td>${c.visits}</td>
          <td>$${c.spent.toLocaleString()}</td>
          <td><span style="font-weight: 600; color: var(--cd-primary);">${c.points.toLocaleString()} pts</span></td>
          <td onclick="event.stopPropagation()">
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" onclick="openEditCustomerModal(${c.id})">Edit</button>
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" onclick="openIndividualEmail(${c.id})">Email</button>
              <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 12px;" onclick="showAdjustPointsModal(${c.id})">Points</button>
            </div>
          </td>
        </tr>
      `).join('');

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Customers</h1>
            <p class="page-subtitle">Manage your customer database (${filteredCustomers.length} customers)</p>
          </div>
          <button class="btn btn-primary" onclick="showModal('modal-add-customer')">+ Add Customer</button>
        </div>
        <div class="card">
          <div class="card-header">
            <input type="text" placeholder="Search customers..." value="${customerSearchQuery}"
                   oninput="searchCustomers(this.value)"
                   style="padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px; width: 300px;">
          </div>
          <div class="table-container">
            <table>
              <thead><tr><th>Customer</th><th>Phone</th><th>Vehicles</th><th>Visits</th><th>Total Spent</th><th>Loyalty</th><th>Actions</th></tr></thead>
              <tbody>${customerRows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    let staffViewTab = 'team'; // 'team' or 'performance'
    let staffPeriod = '30days'; // '7days', '30days', '90days', 'year', 'all'

    function setStaffTab(tab) {
      staffViewTab = tab;
      renderPage('cd-staff');
    }

    function setStaffPeriod(period) {
      staffPeriod = period;
      renderPage('cd-staff');
    }

    // Demo performance data generator based on period
    function getStaffPerformanceData(period) {
      const multipliers = {
        '7days': 0.25,
        '30days': 1,
        '90days': 3,
        'year': 12,
        'all': 24
      };
      const mult = multipliers[period] || 1;

      return demoStaff.map(s => ({
        ...s,
        hoursWorked: Math.round((s.role === 'Owner' ? 45 : s.role === 'Manager' ? 40 : 35) * mult),
        servicesCompleted: Math.round((s.role === 'Owner' ? 28 : s.role === 'Manager' ? 32 : 25) * mult),
        avgRating: (4.5 + Math.random() * 0.5).toFixed(1),
        revenue: Math.round((s.role === 'Owner' ? 4500 : s.role === 'Manager' ? 3800 : 2900) * mult),
        tipsEarned: Math.round((s.role === 'Owner' ? 320 : s.role === 'Manager' ? 280 : 220) * mult)
      }));
    }

    function renderCDStaff() {
      const staffCards = demoStaff.map(s => `
        <div class="card" style="margin-bottom: 12px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 16px; align-items: center;">
              <div style="width: 56px; height: 56px; background: ${s.role === 'Owner' ? '#dbeafe' : s.role === 'Manager' ? '#fef3c7' : '#e5e7eb'}; color: ${s.role === 'Owner' ? '#1d4ed8' : s.role === 'Manager' ? '#d97706' : '#374151'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 18px;">
                ${s.name.split(' ').map(w => w[0]).join('')}
              </div>
              <div>
                <div style="font-weight: 600; font-size: 16px;">${s.name}</div>
                <div style="font-size: 13px; color: var(--gray-500);">${s.email} | ${s.phone}</div>
                <div style="font-size: 12px; color: var(--gray-400); margin-top: 4px;">Services: ${s.services}</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
              <span class="status-badge status-${s.role === 'Owner' ? 'active' : s.role === 'Manager' ? 'pending' : 'inactive'}">${s.role}</span>
              <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 13px;" onclick="openEditStaffModal(${s.id})">Edit</button>
              <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 13px;" onclick="showToast('Schedule view coming soon!', 'info')">Schedule</button>
            </div>
          </div>
        </div>
      `).join('');

      // Performance view
      const performanceData = getStaffPerformanceData(staffPeriod);
      const periodLabels = {
        '7days': 'Last 7 Days',
        '30days': 'Last 30 Days',
        '90days': 'Last 90 Days',
        'year': 'Last Year',
        'all': 'All Time'
      };

      const performanceRows = performanceData.map(s => `
        <tr>
          <td>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 40px; height: 40px; background: ${s.role === 'Owner' ? '#dbeafe' : s.role === 'Manager' ? '#fef3c7' : '#e5e7eb'}; color: ${s.role === 'Owner' ? '#1d4ed8' : s.role === 'Manager' ? '#d97706' : '#374151'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                ${s.name.split(' ').map(w => w[0]).join('')}
              </div>
              <div>
                <div style="font-weight: 600;">${s.name}</div>
                <div style="font-size: 12px; color: var(--gray-500);">${s.role}</div>
              </div>
            </div>
          </td>
          <td style="font-weight: 500;">${s.hoursWorked} hrs</td>
          <td style="font-weight: 500;">${s.servicesCompleted}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 4px;">
              <span style="color: #f59e0b;"></span>
              <span style="font-weight: 600;">${s.avgRating}</span>
            </div>
          </td>
          <td style="font-weight: 600; color: var(--cd-primary);">$${s.revenue.toLocaleString()}</td>
          <td style="color: var(--success);">$${s.tipsEarned.toLocaleString()}</td>
        </tr>
      `).join('');

      const totalHours = performanceData.reduce((sum, s) => sum + s.hoursWorked, 0);
      const totalServices = performanceData.reduce((sum, s) => sum + s.servicesCompleted, 0);
      const totalRevenue = performanceData.reduce((sum, s) => sum + s.revenue, 0);
      const totalTips = performanceData.reduce((sum, s) => sum + s.tipsEarned, 0);
      const avgRating = (performanceData.reduce((sum, s) => sum + parseFloat(s.avgRating), 0) / performanceData.length).toFixed(1);

      const periodBtn = (period, label) => `
        <button class="btn ${staffPeriod === period ? 'btn-primary' : 'btn-secondary'}"
                style="padding: 6px 12px; font-size: 13px;"
                onclick="setStaffPeriod('${period}')">${label}</button>
      `;

      const performanceView = `
        <div class="card" style="margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div>
              <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Performance Period</h3>
              <p style="font-size: 13px; color: var(--gray-500);">Showing data for: ${periodLabels[staffPeriod]}</p>
            </div>
            <div style="display: flex; gap: 8px;">
              ${periodBtn('7days', '7 Days')}
              ${periodBtn('30days', '30 Days')}
              ${periodBtn('90days', '90 Days')}
              ${periodBtn('year', 'Year')}
              ${periodBtn('all', 'All Time')}
            </div>
          </div>
          <div style="display: flex; gap: 8px; align-items: center;">
            <span style="font-size: 13px; color: var(--gray-500);">Custom Range:</span>
            <input type="date" style="padding: 6px 10px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 13px;" value="2024-12-01">
            <span style="color: var(--gray-400);">to</span>
            <input type="date" style="padding: 6px 10px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 13px;" value="2024-12-22">
            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;" onclick="showToast('Custom range applied', 'info')">Apply</button>
          </div>
        </div>

        <div class="stats-grid" style="margin-bottom: 20px;">
          <div class="stat-card">
            <div class="stat-label">Total Hours Worked</div>
            <div class="stat-value">${totalHours}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Services Completed</div>
            <div class="stat-value">${totalServices}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Team Avg Rating</div>
            <div class="stat-value">${avgRating} </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Revenue</div>
            <div class="stat-value">$${totalRevenue.toLocaleString()}</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Staff Performance</h3>
            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;" onclick="exportToCSV('staff-performance')">Export CSV</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Staff Member</th>
                  <th>Hours Worked</th>
                  <th>Services</th>
                  <th>Avg Rating</th>
                  <th>Revenue</th>
                  <th>Tips Earned</th>
                </tr>
              </thead>
              <tbody>
                ${performanceRows}
              </tbody>
              <tfoot style="background: var(--gray-50); font-weight: 600;">
                <tr>
                  <td>Totals</td>
                  <td>${totalHours} hrs</td>
                  <td>${totalServices}</td>
                  <td>${avgRating} </td>
                  <td style="color: var(--cd-primary);">$${totalRevenue.toLocaleString()}</td>
                  <td style="color: var(--success);">$${totalTips.toLocaleString()}</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      `;

      const tabBtn = (tab, label) => `
        <button class="btn ${staffViewTab === tab ? 'btn-primary' : 'btn-secondary'}"
                style="padding: 10px 20px;"
                onclick="setStaffTab('${tab}')">${label}</button>
      `;

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Staff</h1>
            <p class="page-subtitle">Manage team members and track performance (${demoStaff.length} members)</p>
          </div>
          <button class="btn btn-primary" onclick="showModal('modal-add-staff')">+ Add Staff</button>
        </div>

        <div style="display: flex; gap: 8px; margin-bottom: 20px;">
          ${tabBtn('team', 'Team Members')}
          ${tabBtn('performance', 'Performance')}
        </div>

        ${staffViewTab === 'team' ? staffCards : performanceView}
      `;
    }

    let loyaltyTab = 'rewards'; // 'rewards', 'activity', 'members'

    function setLoyaltyTab(tab) {
      loyaltyTab = tab;
      renderPage('cd-loyalty');
    }

    function renderCDLoyalty() {
      const totalPointsIssued = demoCustomers.reduce((sum, c) => sum + c.points, 0);
      const totalPointsRedeemed = demoRedemptions.reduce((sum, r) => sum + r.pointsSpent, 0);
      const activeCoupons = demoRedemptions.filter(r => r.status === 'active').length;

      const tabBtn = (tab, label) => `
        <button class="btn ${loyaltyTab === tab ? 'btn-primary' : 'btn-secondary'}"
                onclick="setLoyaltyTab('${tab}')" style="padding: 8px 16px;">
          ${label}
        </button>
      `;

      // Rewards cards
      const rewardsView = `
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Available Rewards</h3>
            <button class="btn btn-primary" onclick="openAddRewardModal()">+ Add Reward</button>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-top: 16px;">
            ${demoRewards.filter(r => r.active).map(reward => `
              <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                  <div style="font-size: 32px;">&#127873;</div>
                  <div style="display: flex; gap: 4px;">
                    <button class="btn" style="padding: 4px 8px; font-size: 11px; background: rgba(255,255,255,0.2); color: white; border: none;" onclick="openEditRewardModal(${reward.id})">Edit</button>
                    <button class="btn" style="padding: 4px 8px; font-size: 11px; background: rgba(255,255,255,0.2); color: white; border: none;" onclick="deleteReward(${reward.id})">Delete</button>
                  </div>
                </div>
                <div style="font-weight: 600; font-size: 18px; margin-bottom: 8px;">${reward.name}</div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div style="font-size: 14px; opacity: 0.9;">
                    ${reward.discountType === 'percent' ? reward.discountValue + '% off' : '$' + reward.discountValue + ' off'}
                  </div>
                  <div style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-weight: 600;">
                    ${reward.pointsCost} pts
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Points Settings</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <div style="padding: 16px; background: var(--gray-50); border-radius: 8px;">
              <div style="font-weight: 600;">Points per $1 spent</div>
              <div style="font-size: 24px; color: var(--cd-primary); margin-top: 8px;">1 point</div>
            </div>
            <div style="padding: 16px; background: var(--gray-50); border-radius: 8px;">
              <div style="font-weight: 600;">Signup Bonus</div>
              <div style="font-size: 24px; color: var(--cd-primary); margin-top: 8px;">50 points</div>
            </div>
          </div>
        </div>
      `;

      // Redemption Activity view
      const activityRows = demoRedemptions.map(r => `
        <tr>
          <td>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 32px; height: 32px; background: var(--cd-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px;">
                ${r.customerName.split(' ').map(w => w[0]).join('')}
              </div>
              ${r.customerName}
            </div>
          </td>
          <td>${r.rewardName}</td>
          <td><code style="background: var(--gray-100); padding: 4px 8px; border-radius: 4px; font-size: 12px;">${r.couponCode}</code></td>
          <td>${r.pointsSpent}</td>
          <td>${r.redeemedAt}</td>
          <td>
            <span class="status-badge status-${r.status === 'active' ? 'active' : r.status === 'used' ? 'pending' : 'inactive'}">
              ${r.status === 'active' ? 'Active' : r.status === 'used' ? 'Used' : 'Cancelled'}
            </span>
          </td>
          <td>
            ${r.status === 'active' ? `
              <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="cancelRedemption(${r.id})">Cancel</button>
            ` : r.status === 'used' ? `<span style="color: var(--gray-400); font-size: 12px;">Used ${r.usedAt}</span>` : ''}
          </td>
        </tr>
      `).join('');

      const activityView = `
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Redemption Activity</h3>
            <button class="btn btn-secondary" onclick="exportRedemptions()">Export CSV</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Customer</th>
                  <th>Reward</th>
                  <th>Coupon Code</th>
                  <th>Points</th>
                  <th>Redeemed</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>${activityRows.length > 0 ? activityRows : '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--gray-400);">No redemptions yet</td></tr>'}</tbody>
            </table>
          </div>
        </div>
      `;

      // Members view with points and redeem button
      const memberRows = demoCustomers.map(c => {
        const customerRedemptions = demoRedemptions.filter(r => r.customerId === c.id);
        const activeRedemptions = customerRedemptions.filter(r => r.status === 'active').length;
        return `
          <tr>
            <td>
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 32px; height: 32px; background: var(--cd-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px;">
                  ${c.name.split(' ').map(w => w[0]).join('')}
                </div>
                <div>
                  <div>${c.name}</div>
                  <div style="font-size: 12px; color: var(--gray-500);">${c.email}</div>
                </div>
              </div>
            </td>
            <td style="font-weight: 600; color: var(--cd-primary);">${c.points.toLocaleString()}</td>
            <td>$${c.spent.toLocaleString()}</td>
            <td>${activeRedemptions > 0 ? `<span class="status-badge status-active">${activeRedemptions} active coupon${activeRedemptions > 1 ? 's' : ''}</span>` : '<span style="color: var(--gray-400);">None</span>'}</td>
            <td>
              <div style="display: flex; gap: 4px;">
                <button class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;" onclick="openRedeemPointsModal(${c.id})">Redeem</button>
                <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="showAdjustPointsModal(${c.id})">Adjust</button>
                <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewCustomerRedemptions(${c.id})">History</button>
              </div>
            </td>
          </tr>
        `;
      }).join('');

      const membersView = `
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Members</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Member</th>
                  <th>Points Balance</th>
                  <th>Total Spent</th>
                  <th>Active Coupons</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>${memberRows}</tbody>
            </table>
          </div>
        </div>
      `;

      const currentView = loyaltyTab === 'rewards' ? rewardsView : loyaltyTab === 'activity' ? activityView : membersView;

      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Loyalty Program</h1>
            <p class="page-subtitle">Create rewards and track customer redemptions</p>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total Members</div>
            <div class="stat-value">${demoCustomers.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Points Balance</div>
            <div class="stat-value">${totalPointsIssued.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Points Redeemed</div>
            <div class="stat-value">${totalPointsRedeemed.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Active Coupons</div>
            <div class="stat-value">${activeCoupons}</div>
          </div>
        </div>

        <div style="display: flex; gap: 8px; margin-bottom: 20px;">
          ${tabBtn('rewards', 'Rewards')}
          ${tabBtn('activity', 'Redemption Activity')}
          ${tabBtn('members', 'Members')}
        </div>

        ${currentView}
      `;
    }

    function renderCDReviews() {
      const reviewCards = demoReviews.map(r => `
        <div class="card" style="margin-bottom: 12px;">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="color: #f59e0b;">${'&#9733;'.repeat(r.rating)}${'&#9734;'.repeat(5-r.rating)}</span>
                <span style="font-weight: 600;">${r.customer}</span>
                <span style="color: var(--gray-400);">on ${r.platform}</span>
              </div>
              <p style="color: var(--gray-600);">"${r.text}"</p>
              <div style="font-size: 12px; color: var(--gray-400); margin-top: 8px;">${r.date}</div>
            </div>
            <span class="status-badge status-active">${r.status}</span>
          </div>
        </div>
      `).join('');

      return `
        <div class="page-header">
          <h1 class="page-title">Reviews</h1>
          <p class="page-subtitle">Manage review requests and responses</p>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Average Rating</div>
            <div class="stat-value">4.8 &#9733;</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Reviews</div>
            <div class="stat-value">${demoReviews.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending Requests</div>
            <div class="stat-value">8</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Response Rate</div>
            <div class="stat-value">95%</div>
          </div>
        </div>

        <div class="card" style="margin-bottom: 20px;">
          <div class="card-header">
            <h3 class="card-title">Automated Review Request Flow</h3>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 13px; color: var(--gray-500);">Automation</span>
              <label style="position: relative; display: inline-block; width: 44px; height: 24px;">
                <input type="checkbox" id="review-automation-toggle" checked style="opacity: 0; width: 0; height: 0;">
                <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--success); border-radius: 24px; transition: 0.3s;" onclick="this.previousElementSibling.checked = !this.previousElementSibling.checked; this.style.backgroundColor = this.previousElementSibling.checked ? 'var(--success)' : 'var(--gray-300)';">
                  <span style="position: absolute; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: 0.3s; transform: translateX(20px);"></span>
                </span>
              </label>
            </div>
          </div>

          <div style="background: var(--gray-50); border-radius: 12px; padding: 24px; margin-bottom: 20px;">
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
              <!-- Step 1: Trigger -->
              <div style="background: white; border: 2px solid var(--cd-primary); border-radius: 8px; padding: 16px; min-width: 180px; text-align: center;">
                <div style="font-size: 11px; color: var(--cd-primary); font-weight: 600; margin-bottom: 4px;">STEP 1</div>
                <div style="font-weight: 600; margin-bottom: 8px;">Service Completed</div>
                <div style="font-size: 12px; color: var(--gray-500);">Triggers when appointment is marked complete</div>
              </div>

              <svg width="24" height="24" fill="none" stroke="var(--gray-400)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>

              <!-- Step 2: Wait -->
              <div style="background: white; border: 2px solid var(--gray-300); border-radius: 8px; padding: 16px; min-width: 180px; text-align: center;">
                <div style="font-size: 11px; color: var(--gray-500); font-weight: 600; margin-bottom: 4px;">STEP 2</div>
                <div style="font-weight: 600; margin-bottom: 8px;">Wait Period</div>
                <select id="review-delay" style="width: 100%; padding: 6px; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 13px;">
                  <option value="1">1 hour after</option>
                  <option value="24" selected>24 hours after</option>
                  <option value="48">48 hours after</option>
                  <option value="72">3 days after</option>
                </select>
              </div>

              <svg width="24" height="24" fill="none" stroke="var(--gray-400)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>

              <!-- Step 3: Satisfaction Check -->
              <div style="background: white; border: 2px solid var(--warning); border-radius: 8px; padding: 16px; min-width: 200px; text-align: center;">
                <div style="font-size: 11px; color: var(--warning); font-weight: 600; margin-bottom: 4px;">STEP 3</div>
                <div style="font-weight: 600; margin-bottom: 8px;">Satisfaction Check</div>
                <label style="display: flex; align-items: center; gap: 6px; font-size: 13px; justify-content: center;">
                  <input type="checkbox" id="satisfaction-check-enabled" checked>
                  Send internal survey first
                </label>
              </div>

              <svg width="24" height="24" fill="none" stroke="var(--gray-400)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>

              <!-- Step 4: Condition -->
              <div style="background: white; border: 2px solid var(--success); border-radius: 8px; padding: 16px; min-width: 200px; text-align: center;">
                <div style="font-size: 11px; color: var(--success); font-weight: 600; margin-bottom: 4px;">STEP 4</div>
                <div style="font-weight: 600; margin-bottom: 8px;">Rating Threshold</div>
                <select id="rating-threshold" style="width: 100%; padding: 6px; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 13px;">
                  <option value="3">Only if 3+ stars</option>
                  <option value="4" selected>Only if 4+ stars</option>
                  <option value="5">Only if 5 stars</option>
                  <option value="0">Send to all</option>
                </select>
              </div>

              <svg width="24" height="24" fill="none" stroke="var(--gray-400)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>

              <!-- Step 5: Send Request -->
              <div style="background: white; border: 2px solid var(--cd-primary); border-radius: 8px; padding: 16px; min-width: 180px; text-align: center;">
                <div style="font-size: 11px; color: var(--cd-primary); font-weight: 600; margin-bottom: 4px;">STEP 5</div>
                <div style="font-weight: 600; margin-bottom: 8px;">Send Review Request</div>
                <div style="font-size: 12px; color: var(--gray-500);">Links to Google & Yelp</div>
              </div>
            </div>
          </div>

          <!-- Platform Settings -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div style="background: var(--gray-50); border-radius: 8px; padding: 16px;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="width: 40px; height: 40px; background: #4285f4; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                </div>
                <div>
                  <div style="font-weight: 600;">Google Business</div>
                  <div style="font-size: 12px; color: var(--gray-500);">Request reviews on Google Maps</div>
                </div>
                <label style="margin-left: auto; display: flex; align-items: center; gap: 6px;">
                  <input type="checkbox" id="google-review-enabled" checked>
                  <span style="font-size: 13px;">Enabled</span>
                </label>
              </div>
              <input type="text" placeholder="Your Google Business Profile URL" value="https://g.page/r/your-business/review" style="width: 100%; padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 13px;">
            </div>

            <div style="background: var(--gray-50); border-radius: 8px; padding: 16px;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="width: 40px; height: 40px; background: #d32323; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M20.16 12.594l-7.387 7.387a6.777 6.777 0 01-9.586-9.586l7.387-7.387a4.518 4.518 0 116.39 6.39l-7.38 7.387a2.259 2.259 0 01-3.195-3.195l6.118-6.118"/></svg>
                </div>
                <div>
                  <div style="font-weight: 600;">Yelp</div>
                  <div style="font-size: 12px; color: var(--gray-500);">Request reviews on Yelp</div>
                </div>
                <label style="margin-left: auto; display: flex; align-items: center; gap: 6px;">
                  <input type="checkbox" id="yelp-review-enabled" checked>
                  <span style="font-size: 13px;">Enabled</span>
                </label>
              </div>
              <input type="text" placeholder="Your Yelp Business Page URL" value="https://yelp.com/biz/your-business" style="width: 100%; padding: 8px 12px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 13px;">
            </div>
          </div>

          <!-- Communication Method -->
          <div style="background: var(--gray-50); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 12px;">Request Communication Method</div>
            <div style="display: flex; gap: 24px;">
              <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" checked> Email
              </label>
              <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" checked> SMS
              </label>
            </div>
          </div>

          <!-- Review Incentive -->
          <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #f59e0b; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
              <div>
                <div style="font-weight: 600; color: #92400e; display: flex; align-items: center; gap: 8px;">
                  <svg width="20" height="20" fill="none" stroke="#92400e" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path></svg>
                  Review Incentive
                </div>
                <div style="font-size: 13px; color: #a16207; margin-top: 4px;">Reward customers for leaving a review</div>
              </div>
              <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="review-incentive-enabled" checked onchange="document.getElementById('incentive-options').style.display = this.checked ? 'block' : 'none';">
                <span style="font-size: 13px; font-weight: 500; color: #92400e;">Enabled</span>
              </label>
            </div>
            <div id="incentive-options">
              <div style="background: white; border-radius: 6px; padding: 12px;">
                <div style="font-size: 12px; font-weight: 600; color: var(--gray-600); margin-bottom: 10px;">Choose incentive type:</div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                  <label style="display: flex; align-items: start; gap: 10px; padding: 10px; background: var(--gray-50); border-radius: 6px; cursor: pointer;">
                    <input type="radio" name="incentive-type" value="points" checked style="margin-top: 2px;">
                    <div>
                      <div style="font-weight: 500;">Bonus Loyalty Points</div>
                      <div style="font-size: 12px; color: var(--gray-500);">Award <input type="number" value="50" style="width: 50px; padding: 2px 6px; border: 1px solid var(--gray-300); border-radius: 4px; text-align: center;" onclick="event.stopPropagation();"> bonus points when they leave a review</div>
                    </div>
                  </label>
                  <label style="display: flex; align-items: start; gap: 10px; padding: 10px; background: var(--gray-50); border-radius: 6px; cursor: pointer;">
                    <input type="radio" name="incentive-type" value="discount" style="margin-top: 2px;">
                    <div>
                      <div style="font-weight: 500;">10% Discount Code</div>
                      <div style="font-size: 12px; color: var(--gray-500);">Send a unique 10% off code for their next detailing service</div>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Email Template -->
          <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-weight: 600;">Email Template</div>
              <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 12px;" onclick="document.getElementById('email-template-subject').value='Thank you for choosing {{business_name}}!'; document.getElementById('email-template-body').value='Hi {{customer_name}},\\n\\nThank you for visiting {{business_name}}! We hope you loved your {{service_name}}.\\n\\nWe\\'d be grateful if you could take a moment to share your experience. Your feedback helps us improve and helps other customers find us!\\n\\n Leave a review on Google:\\n{{google_review_link}}\\n\\n Leave a review on Yelp:\\n{{yelp_review_link}}\\n\\nThank you for your support!\\n\\nBest regards,\\n{{business_name}} Team';">Reset to Default</button>
            </div>
            <div style="background: white; border: 1px solid var(--gray-300); border-radius: 8px; overflow: hidden;">
              <div style="background: var(--gray-50); padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                  <span style="font-size: 12px; color: var(--gray-500); width: 60px;">Subject:</span>
                  <input type="text" id="email-template-subject" value="Thank you for choosing {{business_name}}!" style="flex: 1; padding: 6px 10px; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 13px;">
                </div>
                <div style="font-size: 11px; color: var(--gray-400);">Variables: {{customer_name}}, {{business_name}}, {{service_name}}</div>
              </div>
              <div style="padding: 16px;">
                <textarea id="email-template-body" style="width: 100%; height: 240px; padding: 12px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 13px; font-family: inherit; resize: vertical; line-height: 1.5;">Hi {{customer_name}},

Thank you for visiting {{business_name}}! We hope you loved your {{service_name}}.

We'd be grateful if you could take a moment to share your experience. Your feedback helps us improve and helps other customers find us!

 Leave a review on Google:
{{google_review_link}}

 Leave a review on Yelp:
{{yelp_review_link}}

{{review_incentive}}

Thank you for your support!

Best regards,
{{business_name}} Team</textarea>
                <div style="margin-top: 12px; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                  <div style="font-size: 12px; font-weight: 600; color: var(--gray-600); margin-bottom: 8px;">Available Variables:</div>
                  <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <code style="background: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; border: 1px solid var(--gray-200);">{{customer_name}}</code>
                    <code style="background: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; border: 1px solid var(--gray-200);">{{business_name}}</code>
                    <code style="background: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; border: 1px solid var(--gray-200);">{{service_name}}</code>
                    <code style="background: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; border: 1px solid var(--gray-200);">{{service_date}}</code>
                    <code style="background: #dbeafe; padding: 2px 8px; border-radius: 4px; font-size: 11px; border: 1px solid #93c5fd; color: #1d4ed8;">{{google_review_link}}</code>
                    <code style="background: #fee2e2; padding: 2px 8px; border-radius: 4px; font-size: 11px; border: 1px solid #fca5a5; color: #dc2626;">{{yelp_review_link}}</code>
                    <code style="background: #fef3c7; padding: 2px 8px; border-radius: 4px; font-size: 11px; border: 1px solid #fcd34d; color: #92400e;">{{review_incentive}}</code>
                  </div>
                </div>
                <div style="margin-top: 12px; padding: 12px; background: #fefce8; border: 1px solid #fef08a; border-radius: 6px;">
                  <div style="font-size: 12px; font-weight: 600; color: #a16207; margin-bottom: 6px;"> Incentive Preview (when enabled):</div>
                  <div style="font-size: 13px; color: #854d0e;">
                    <div style="margin-bottom: 4px;"><strong>Points:</strong> "As a thank you, you'll receive 50 bonus loyalty points!"</div>
                    <div><strong>Discount:</strong> "As a thank you, here's 10% off your next visit! Code: REVIEW10-XXXX"</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div style="display: flex; justify-content: flex-end; gap: 12px;">
            <button class="btn btn-secondary" onclick="showToast('Preview sent to your email!', 'success')">Send Test Email</button>
            <button class="btn btn-primary" onclick="showToast('Automation flow saved!', 'success')">Save Flow</button>
          </div>
        </div>

        <div class="card" style="margin-bottom: 20px;">
          <div class="card-header">
            <h3 class="card-title">Low Rating Response Flow</h3>
          </div>
          <div style="background: #fef2f2; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
              <svg width="24" height="24" fill="none" stroke="#dc2626" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
              <div style="font-weight: 600; color: #991b1b;">When customer rates below threshold</div>
            </div>
            <p style="font-size: 13px; color: #7f1d1d; margin-bottom: 12px;">Instead of requesting a public review, take action to resolve their concerns first.</p>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                <input type="checkbox" checked>
                Send apology email with contact info
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                <input type="checkbox" checked>
                Notify business owner immediately
              </label>
              <label style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                <input type="checkbox">
                Offer discount on next service
              </label>
            </div>
          </div>
        </div>

        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">Recent Reviews</h3>
        ${reviewCards}
      `;
    }

    function renderCDCommunications() {
      return `
        <div class="page-header">
          <h1 class="page-title">Communications</h1>
          <p class="page-subtitle">Email and SMS settings</p>
        </div>
        <div class="card" style="margin-bottom: 20px;">
          <h3 class="card-title" style="margin-bottom: 16px;">Send Email</h3>
          <div style="display: flex; gap: 12px; margin-bottom: 16px;">
            <button class="btn btn-primary" onclick="showModal('modal-send-email')">All Customers</button>
            <button class="btn btn-secondary" onclick="showModal('modal-send-email')">Inactive (30+ days)</button>
            <button class="btn btn-secondary" onclick="showToast('Individual email selector coming soon!', 'info')">Select Individual</button>
          </div>
          <textarea id="quick-email-message" placeholder="Write your message..." style="width: 100%; height: 120px; padding: 12px; border: 1px solid var(--gray-300); border-radius: 8px; resize: none;"></textarea>
          <div style="margin-top: 12px; display: flex; justify-content: flex-end;">
            <button class="btn btn-primary" onclick="showModal('modal-send-email')">Send Email</button>
          </div>
        </div>
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Automated Notifications</h3>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 8px;">
              <div>
                <div style="font-weight: 500;">Booking Confirmation</div>
                <div style="font-size: 13px; color: var(--gray-500);">Sent immediately after booking</div>
              </div>
              <div style="display: flex; gap: 12px;">
                <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Email</label>
                <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> SMS</label>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 8px;">
              <div>
                <div style="font-weight: 500;">24-Hour Reminder</div>
                <div style="font-size: 13px; color: var(--gray-500);">Sent 24 hours before appointment</div>
              </div>
              <div style="display: flex; gap: 12px;">
                <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Email</label>
                <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> SMS</label>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 8px;">
              <div>
                <div style="font-weight: 500;">Service Complete</div>
                <div style="font-size: 13px; color: var(--gray-500);">Sent after service is marked complete</div>
              </div>
              <div style="display: flex; gap: 12px;">
                <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox" checked> Email</label>
                <label style="display: flex; align-items: center; gap: 6px;"><input type="checkbox"> SMS</label>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderCDPayments() {
      const txRows = demoTransactions.map(t => `
        <tr>
          <td>${t.customer}</td>
          <td>${t.service}</td>
          <td>$${t.amount}</td>
          <td>$${t.tip}</td>
          <td style="font-weight: 600;">$${t.amount + t.tip}</td>
          <td>${t.date}</td>
          <td>${t.method}</td>
          <td><span class="status-badge status-${t.status === 'completed' ? 'active' : 'pending'}">${t.status}</span></td>
          <td>
            ${t.status === 'completed' ? `<button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="showConfirm('Process Refund', 'Refund $${t.amount + t.tip} to ${t.customer}?', 'Refund', () => showToast('Refund processed!', 'success'))">Refund</button>` : ''}
          </td>
        </tr>
      `).join('');

      const totalRevenue = demoTransactions.reduce((sum, t) => sum + t.amount, 0);
      const totalTips = demoTransactions.reduce((sum, t) => sum + t.tip, 0);

      return `
        <div class="page-header">
          <h1 class="page-title">Payments</h1>
          <p class="page-subtitle">View transactions and manage payouts</p>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Today's Revenue</div>
            <div class="stat-value">$${totalRevenue.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Today's Tips</div>
            <div class="stat-value">$${totalTips}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending Payouts</div>
            <div class="stat-value">$2,340</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Next Payout</div>
            <div class="stat-value">Tomorrow</div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Recent Transactions</h3>
            <button class="btn btn-secondary" onclick="exportToCSV('transactions')">Export CSV</button>
          </div>
          <div class="table-container">
            <table>
              <thead><tr><th>Customer</th><th>Service</th><th>Amount</th><th>Tip</th><th>Total</th><th>Date</th><th>Method</th><th>Status</th><th>Actions</th></tr></thead>
              <tbody>${txRows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    function renderCDReports() {
      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">Reports</h1>
            <p class="page-subtitle">Business analytics and insights</p>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary" onclick="exportToCSV('revenue-report')">Export Revenue CSV</button>
            <button class="btn btn-secondary" onclick="exportToCSV('bookings-report')">Export Bookings CSV</button>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Monthly Revenue</div>
            <div class="stat-value">$12,450</div>
            <div class="stat-change positive">+18% vs last month</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Bookings</div>
            <div class="stat-value">89</div>
            <div class="stat-change positive">+12% vs last month</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Avg. Ticket</div>
            <div class="stat-value">$139</div>
            <div class="stat-change positive">+5%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">No-Show Rate</div>
            <div class="stat-value">3.2%</div>
            <div class="stat-change positive">-1.1%</div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div class="card">
            <h3 class="card-title" style="margin-bottom: 16px;">Popular Services</h3>
            ${demoServices.slice(0, 4).map((s, i) => `
              <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-100);">
                <span>${i + 1}. ${s.name}</span>
                <span style="color: var(--gray-500);">${20 - i * 3} bookings</span>
              </div>
            `).join('')}
          </div>
          <div class="card">
            <h3 class="card-title" style="margin-bottom: 16px;">Staff Performance</h3>
            ${demoStaff.slice(0, 3).map(s => `
              <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-100);">
                <span>${s.name}</span>
                <span style="color: var(--gray-500);">$${(3000 + Math.random() * 2000).toFixed(0)} revenue</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderCDSettings() {
      return `
        <div class="page-header">
          <h1 class="page-title">Settings</h1>
          <p class="page-subtitle">Business configuration</p>
        </div>
        <div class="card" style="margin-bottom: 20px;">
          <h3 class="card-title" style="margin-bottom: 16px;">Business Information</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div>
              <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">Business Name</label>
              <input type="text" value="Elite Auto Spa" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
            <div>
              <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">Phone</label>
              <input type="text" value="(555) 123-4567" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
            <div style="grid-column: span 2;">
              <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">Address</label>
              <input type="text" value="123 Main Street, Los Angeles, CA 90001" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
          </div>
        </div>
        <div class="card" style="margin-bottom: 20px;">
          <h3 class="card-title" style="margin-bottom: 16px;">Working Hours</h3>
          <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; text-align: center;">
            ${['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(d => `
              <div style="padding: 12px; background: var(--gray-50); border-radius: 8px;">
                <div style="font-weight: 500; margin-bottom: 4px;">${d}</div>
                <div style="font-size: 12px; color: var(--gray-500);">${d === 'Sun' ? 'Closed' : '8AM - 6PM'}</div>
              </div>
            `).join('')}
          </div>
        </div>
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Booking Policies</h3>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span>Require deposit for bookings over $100</span>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" checked> Enabled</label>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span>Deposit amount</span>
              <select style="padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;"><option>25%</option><option>50%</option><option>$50 flat</option></select>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span>Cancellation window</span>
              <select style="padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;"><option>24 hours</option><option>48 hours</option><option>No refunds</option></select>
            </div>
          </div>
        </div>
      `;
    }

    // Customer Pages
    const customerData = {
      name: 'Sarah Smith',
      email: 'sarah@email.com',
      phone: '(555) 123-4567',
      points: 2450,
      totalSpent: 2450,
      vehicles: [
        { id: 1, make: 'BMW', model: 'X5', year: 2022, color: 'Black', plate: 'ABC1234' },
        { id: 2, make: 'Mini', model: 'Cooper', year: 2020, color: 'Red', plate: 'XYZ5678' }
      ],
      packages: [
        { id: 1, name: 'Full Detail Package', remaining: 2, total: 3, expires: 'Mar 15, 2025' },
        { id: 2, name: 'Express Wash Bundle', remaining: 4, total: 5, expires: 'Feb 28, 2025' }
      ],
      appointments: [
        { id: 1, service: 'Full Detail', vehicle: '2022 BMW X5', date: 'Dec 28, 2024', time: '10:00 AM', status: 'upcoming' },
        { id: 2, service: 'Interior Clean', vehicle: '2020 Mini Cooper', date: 'Dec 15, 2024', time: '2:00 PM', status: 'completed' },
        { id: 3, service: 'Express Wash', vehicle: '2022 BMW X5', date: 'Dec 1, 2024', time: '9:00 AM', status: 'completed' }
      ],
      // Customer's redeemed coupons (linked to demoRedemptions for customer ID 1 - Sarah Smith)
      myCoupons: []  // Will be populated from demoRedemptions
    };

    // Get customer's active coupons from redemptions
    function getCustomerCoupons() {
      return demoRedemptions.filter(r => r.customerId === 1); // Sarah Smith's ID
    }

    function renderCustDashboard() {
      const upcomingAppt = customerData.appointments.find(a => a.status === 'upcoming');
      const activeCoupons = getCustomerCoupons().filter(c => c.status === 'active');

      return `
        <div class="page-header">
          <h1 class="page-title">Welcome back, ${customerData.name.split(' ')[0]}!</h1>
          <p class="page-subtitle">Manage your appointments and rewards</p>
        </div>
        <div class="stats-grid">
          <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div style="display: flex; justify-content: space-between; align-items: start;">
              <div>
                <div class="stat-label" style="color: rgba(255,255,255,0.8);">Loyalty Points</div>
                <div class="stat-value" style="color: white;">${customerData.points.toLocaleString()}</div>
                <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-top: 4px;">${activeCoupons.length} active coupon${activeCoupons.length !== 1 ? 's' : ''}</div>
              </div>
              <div style="font-size: 36px;">&#127873;</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Upcoming Appointments</div>
            <div class="stat-value">${customerData.appointments.filter(a => a.status === 'upcoming').length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Prepaid Services</div>
            <div class="stat-value">${customerData.packages.reduce((sum, p) => sum + p.remaining, 0)}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Visits</div>
            <div class="stat-value">${customerData.appointments.filter(a => a.status === 'completed').length + 10}</div>
          </div>
        </div>
        ${upcomingAppt ? `
        <div class="card" style="border-left: 4px solid var(--cust-primary);">
          <div class="card-header">
            <h3 class="card-title">Next Appointment</h3>
            <span class="status-badge status-active">Confirmed</span>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-size: 18px; font-weight: 600;">${upcomingAppt.service}</div>
              <div style="color: var(--gray-500); margin-top: 4px;">${upcomingAppt.vehicle}</div>
              <div style="color: var(--gray-500);">${upcomingAppt.date} at ${upcomingAppt.time}</div>
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary">Reschedule</button>
              <button class="btn btn-secondary" style="color: var(--error);">Cancel</button>
            </div>
          </div>
        </div>
        ` : ''}
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Quick Actions</h3>
          </div>
          <div style="display: flex; gap: 12px;">
            <button class="btn btn-primary" onclick="showPage('cust-book')">Book New Service</button>
            <button class="btn btn-secondary" onclick="showPage('cust-packages')">Use Prepaid Service</button>
            <button class="btn btn-secondary" onclick="showPage('cust-loyalty')">View Rewards</button>
          </div>
        </div>
      `;
    }

    function renderCustBook() {
      return `
        <div class="page-header">
          <h1 class="page-title">Book a Service</h1>
          <p class="page-subtitle">Choose from our available services</p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
          ${demoServices.map(s => `
            <div class="card" style="cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--cust-primary)'" onmouseout="this.style.borderColor='var(--gray-200)'">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 18px; font-weight: 600;">${s.name}</div>
                  <div style="font-size: 13px; color: var(--gray-500); margin-top: 4px;">${s.description}</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 24px; font-weight: 700; color: var(--cust-primary);">$${s.price}</div>
                  <div style="font-size: 12px; color: var(--gray-500);">${s.duration} min</div>
                </div>
              </div>
              <button class="btn btn-primary" style="width: 100%;" onclick="openBookingModal(${s.id}, '${s.name}', ${s.price})">Select</button>
            </div>
          `).join('')}
        </div>
        <div class="card" style="margin-top: 24px; background: var(--gray-50);">
          <h3 class="card-title" style="margin-bottom: 12px;">Service Packages (Save More!)</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <div style="padding: 16px; background: white; border-radius: 8px; border: 2px solid var(--cust-primary);">
              <div style="font-weight: 600;">Full Detail Package (3 services)</div>
              <div style="font-size: 13px; color: var(--gray-500); margin: 8px 0;">Save $100 when you buy 3</div>
              <div style="font-size: 20px; font-weight: 700; color: var(--cust-primary);">$497 <span style="font-size: 14px; color: var(--gray-400); text-decoration: line-through;">$597</span></div>
            </div>
            <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid var(--gray-200);">
              <div style="font-weight: 600;">Express Wash Bundle (5 washes)</div>
              <div style="font-size: 13px; color: var(--gray-500); margin: 8px 0;">Save $40 on 5 washes</div>
              <div style="font-size: 20px; font-weight: 700; color: var(--cust-primary);">$135 <span style="font-size: 14px; color: var(--gray-400); text-decoration: line-through;">$175</span></div>
            </div>
          </div>
        </div>
      `;
    }

    function renderCustAppointments() {
      const upcoming = customerData.appointments.filter(a => a.status === 'upcoming');
      const past = customerData.appointments.filter(a => a.status === 'completed');

      return `
        <div class="page-header">
          <h1 class="page-title">My Appointments</h1>
          <p class="page-subtitle">View upcoming and past appointments</p>
        </div>
        <div class="card" style="margin-bottom: 24px;">
          <h3 class="card-title" style="margin-bottom: 16px;">Upcoming Appointments</h3>
          ${upcoming.length > 0 ? upcoming.map(a => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
              <div style="display: flex; gap: 16px; align-items: center;">
                <div style="width: 48px; height: 48px; background: var(--cust-primary); color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                  ${a.date.split(' ')[1].replace(',', '')}
                </div>
                <div>
                  <div style="font-weight: 600;">${a.service}</div>
                  <div style="font-size: 13px; color: var(--gray-500);">${a.vehicle} | ${a.date} at ${a.time}</div>
                </div>
              </div>
              <div style="display: flex; gap: 8px; align-items: center;">
                <span class="status-badge status-active">Confirmed</span>
                <button class="btn btn-secondary" style="padding: 6px 12px;">Reschedule</button>
                <button class="btn btn-secondary" style="padding: 6px 12px; color: var(--error);">Cancel</button>
              </div>
            </div>
          `).join('') : '<p style="color: var(--gray-500);">No upcoming appointments</p>'}
        </div>
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Past Appointments</h3>
          ${past.map(a => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--gray-100);">
              <div>
                <div style="font-weight: 500;">${a.service}</div>
                <div style="font-size: 13px; color: var(--gray-500);">${a.vehicle} | ${a.date}</div>
              </div>
              <div style="display: flex; gap: 8px; align-items: center;">
                <span class="status-badge status-inactive">Completed</span>
                <button class="btn btn-secondary" style="padding: 6px 12px;">Book Again</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderCustPackages() {
      return `
        <div class="page-header">
          <h1 class="page-title">My Packages</h1>
          <p class="page-subtitle">View and redeem prepaid services</p>
        </div>
        ${customerData.packages.map(p => `
          <div class="card" style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-size: 18px; font-weight: 600;">${p.name}</div>
                <div style="font-size: 13px; color: var(--gray-500); margin-top: 4px;">Expires: ${p.expires}</div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 32px; font-weight: 700; color: var(--cust-primary);">${p.remaining}</div>
                <div style="font-size: 13px; color: var(--gray-500);">of ${p.total} remaining</div>
              </div>
            </div>
            <div style="margin-top: 16px; background: var(--gray-100); border-radius: 8px; height: 8px; overflow: hidden;">
              <div style="background: var(--cust-primary); height: 100%; width: ${(p.remaining / p.total) * 100}%;"></div>
            </div>
            <div style="margin-top: 16px; display: flex; gap: 8px;">
              <button class="btn btn-primary" onclick="showToast('Booking with package - select your preferred date on the next screen!', 'info'); showPage('cust-book')">Use Now</button>
              <button class="btn btn-secondary" onclick="showToast('Package details coming soon!', 'info')">View Details</button>
            </div>
          </div>
        `).join('')}
        <div class="card" style="background: var(--gray-50); border-style: dashed;">
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Want to save more?</div>
            <p style="color: var(--gray-500); margin-bottom: 16px;">Purchase a service package and save up to 20%</p>
            <button class="btn btn-primary" onclick="showPage('cust-book')">Browse Packages</button>
          </div>
        </div>
      `;
    }

    let custLoyaltyTab = 'rewards'; // 'rewards' or 'coupons'

    function setCustLoyaltyTab(tab) {
      custLoyaltyTab = tab;
      renderPage('cust-loyalty');
    }

    function renderCustLoyalty() {
      const myCoupons = getCustomerCoupons();
      const activeCoupons = myCoupons.filter(c => c.status === 'active');
      const usedCoupons = myCoupons.filter(c => c.status === 'used');

      const tabBtn = (tab, label, count) => `
        <button class="btn ${custLoyaltyTab === tab ? 'btn-primary' : 'btn-secondary'}"
                onclick="setCustLoyaltyTab('${tab}')" style="padding: 8px 16px;">
          ${label}${count !== undefined ? ` (${count})` : ''}
        </button>
      `;

      // Rewards view - show available rewards from detailer
      const rewardsView = `
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Available Rewards</h3>
          <p style="color: var(--gray-500); font-size: 14px; margin-bottom: 20px;">Redeem your points for discounts on your next service!</p>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
            ${demoRewards.filter(r => r.active).map(reward => {
              const canAfford = customerData.points >= reward.pointsCost;
              return `
                <div style="padding: 20px; background: ${canAfford ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'var(--gray-100)'}; border-radius: 12px; color: ${canAfford ? 'white' : 'var(--gray-500)'};">
                  <div style="font-size: 32px; margin-bottom: 12px;">${canAfford ? '&#127873;' : '&#128274;'}</div>
                  <div style="font-weight: 600; font-size: 18px; margin-bottom: 8px;">${reward.name}</div>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                    <div style="font-size: 14px; opacity: 0.9;">
                      ${reward.discountType === 'percent' ? reward.discountValue + '% off' : '$' + reward.discountValue + ' off'}
                    </div>
                    <button class="btn" style="padding: 8px 16px; background: ${canAfford ? 'rgba(255,255,255,0.2)' : 'var(--gray-300)'}; color: ${canAfford ? 'white' : 'var(--gray-500)'}; border: none; font-weight: 600;"
                            onclick="${canAfford ? `customerRedeemReward(${reward.id})` : ''}" ${!canAfford ? 'disabled' : ''}>
                      ${reward.pointsCost} pts
                    </button>
                  </div>
                  ${!canAfford ? `<div style="font-size: 12px; margin-top: 8px;">Need ${reward.pointsCost - customerData.points} more points</div>` : ''}
                </div>
              `;
            }).join('')}
          </div>
        </div>
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">How Points Work</h3>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
            <div style="text-align: center; padding: 16px;">
              <div style="font-size: 32px; margin-bottom: 8px;">&#128176;</div>
              <div style="font-weight: 600;">Earn Points</div>
              <div style="font-size: 13px; color: var(--gray-500); margin-top: 4px;">1 point per $1 spent</div>
            </div>
            <div style="text-align: center; padding: 16px;">
              <div style="font-size: 32px; margin-bottom: 8px;">&#127873;</div>
              <div style="font-weight: 600;">Redeem Rewards</div>
              <div style="font-size: 13px; color: var(--gray-500); margin-top: 4px;">Exchange points for coupons</div>
            </div>
            <div style="text-align: center; padding: 16px;">
              <div style="font-size: 32px; margin-bottom: 8px;">&#127881;</div>
              <div style="font-weight: 600;">Save Money</div>
              <div style="font-size: 13px; color: var(--gray-500); margin-top: 4px;">Use coupons at checkout</div>
            </div>
          </div>
        </div>
      `;

      // My Coupons view - show active and used coupons
      const couponsView = `
        ${activeCoupons.length > 0 ? `
        <div class="card" style="margin-bottom: 20px;">
          <h3 class="card-title" style="margin-bottom: 16px; color: var(--cust-primary);">&#x2705; Active Coupons</h3>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            ${activeCoupons.map(c => `
              <div style="padding: 16px; border: 2px solid var(--cust-primary); border-radius: 8px; background: #ecfdf5;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-weight: 600; font-size: 16px;">${c.rewardName}</div>
                    <div style="font-size: 13px; color: var(--gray-500); margin-top: 4px;">Redeemed ${c.redeemedAt}</div>
                  </div>
                  <div style="text-align: right;">
                    <code style="background: var(--cust-primary); color: white; padding: 8px 12px; border-radius: 6px; font-size: 14px; font-weight: 600;">${c.couponCode}</code>
                    <button class="btn btn-secondary" style="margin-left: 8px; padding: 6px 12px; font-size: 12px;" onclick="copyCouponToClipboard('${c.couponCode}')">Copy</button>
                  </div>
                </div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px dashed var(--gray-300); font-size: 13px; color: var(--gray-600);">
                  Use this code during checkout to apply your discount
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        ` : `
        <div class="card" style="margin-bottom: 20px; text-align: center; padding: 40px;">
          <div style="font-size: 48px; margin-bottom: 16px;">&#127873;</div>
          <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No Active Coupons</div>
          <div style="color: var(--gray-500); margin-bottom: 20px;">Redeem your points to get discount coupons!</div>
          <button class="btn btn-primary" onclick="setCustLoyaltyTab('rewards')">Browse Rewards</button>
        </div>
        `}
        ${usedCoupons.length > 0 ? `
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px; color: var(--gray-500);">Used Coupons</h3>
          <div style="display: flex; flex-direction: column; gap: 8px;">
            ${usedCoupons.map(c => `
              <div style="padding: 12px 16px; border: 1px solid var(--gray-200); border-radius: 8px; display: flex; justify-content: space-between; align-items: center; opacity: 0.6;">
                <div>
                  <div style="font-weight: 500;">${c.rewardName}</div>
                  <div style="font-size: 12px; color: var(--gray-400);">${c.couponCode}</div>
                </div>
                <div style="text-align: right;">
                  <span class="status-badge status-pending">Used</span>
                  <div style="font-size: 11px; color: var(--gray-400); margin-top: 4px;">${c.usedAt}</div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        ` : ''}
      `;

      return `
        <div class="page-header">
          <h1 class="page-title">Loyalty Rewards</h1>
          <p class="page-subtitle">Redeem points for discounts on your services</p>
        </div>
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-size: 14px; color: rgba(255,255,255,0.8); text-transform: uppercase; font-weight: 600;">Your Points Balance</div>
              <div style="font-size: 48px; font-weight: 700; color: white;">${customerData.points.toLocaleString()}</div>
              <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-top: 8px;">$${customerData.totalSpent.toLocaleString()} total spent</div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 64px;">&#127873;</div>
              ${activeCoupons.length > 0 ? `<div style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; color: white; font-size: 13px; margin-top: 8px;">${activeCoupons.length} coupon${activeCoupons.length !== 1 ? 's' : ''} ready</div>` : ''}
            </div>
          </div>
        </div>

        <div style="display: flex; gap: 8px; margin-bottom: 20px;">
          ${tabBtn('rewards', 'Available Rewards')}
          ${tabBtn('coupons', 'My Coupons', activeCoupons.length)}
        </div>

        ${custLoyaltyTab === 'rewards' ? rewardsView : couponsView}
      `;
    }

    function copyCouponToClipboard(code) {
      navigator.clipboard.writeText(code).then(() => {
        showToast('Coupon code copied!', 'success');
      });
    }

    function customerRedeemReward(rewardId) {
      const reward = demoRewards.find(r => r.id === rewardId);
      if (!reward) return;

      if (customerData.points < reward.pointsCost) {
        showToast('Not enough points!', 'error');
        return;
      }

      showConfirm(
        'Redeem Reward',
        `Redeem ${reward.pointsCost} points for "${reward.name}"? You'll receive a coupon code to use at checkout.`,
        'Redeem',
        () => {
          // Deduct points
          customerData.points -= reward.pointsCost;

          // Generate coupon code
          const couponCode = generateCouponCode(customerData.name, reward.discountValue);

          // Create redemption record (linked to customer ID 1 = Sarah Smith)
          const redemption = {
            id: nextRedemptionId++,
            customerId: 1,
            customerName: customerData.name,
            rewardId: reward.id,
            rewardName: reward.name,
            pointsSpent: reward.pointsCost,
            couponCode: couponCode,
            status: 'active',
            redeemedAt: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
            usedAt: null
          };
          demoRedemptions.unshift(redemption);

          // Show success with coupon code
          showToast('Coupon redeemed! Check My Coupons tab.', 'success');
          setCustLoyaltyTab('coupons');
        }
      );
    }

    function renderCustVehicles() {
      return `
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <h1 class="page-title">My Vehicles</h1>
            <p class="page-subtitle">Manage your registered vehicles</p>
          </div>
          <button class="btn btn-primary" onclick="showModal('modal-add-vehicle')">+ Add Vehicle</button>
        </div>
        ${customerData.vehicles.map(v => `
          <div class="card" style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="display: flex; gap: 16px; align-items: center;">
                <div style="width: 64px; height: 64px; background: var(--gray-200); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 28px;">&#x1F697;</div>
                <div>
                  <div style="font-size: 18px; font-weight: 600;">${v.year} ${v.make} ${v.model}</div>
                  <div style="font-size: 14px; color: var(--gray-500); margin-top: 4px;">${v.color} | Plate: ${v.plate}</div>
                </div>
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary" onclick="showPage('cust-book')">Book Service</button>
                <button class="btn btn-secondary" onclick="showToast('Edit vehicle form coming soon!', 'info')">Edit</button>
                <button class="btn btn-secondary" style="color: var(--error);" onclick="showConfirm('Remove Vehicle', 'Are you sure you want to remove this vehicle?', 'Remove', () => showToast('Vehicle removed!', 'success'))">Remove</button>
              </div>
            </div>
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--gray-200);">
              <div style="font-size: 13px; font-weight: 600; margin-bottom: 8px;">Recent Services</div>
              <div style="display: flex; gap: 8px;">
                <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Full Detail - Dec 15</span>
                <span style="background: var(--gray-100); padding: 4px 10px; border-radius: 4px; font-size: 12px;">Express Wash - Dec 1</span>
              </div>
            </div>
          </div>
        `).join('')}
      `;
    }

    function renderCustProfile() {
      return `
        <div class="page-header">
          <h1 class="page-title">Profile</h1>
          <p class="page-subtitle">Manage your account settings</p>
        </div>
        <div class="card" style="margin-bottom: 20px;">
          <h3 class="card-title" style="margin-bottom: 16px;">Personal Information</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div>
              <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">Full Name</label>
              <input type="text" value="${customerData.name}" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
            <div>
              <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">Email</label>
              <input type="email" value="${customerData.email}" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
            <div>
              <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">Phone</label>
              <input type="tel" value="${customerData.phone}" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
            <div>
              <label style="font-size: 13px; color: var(--gray-600); display: block; margin-bottom: 4px;">Birthday</label>
              <input type="date" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
          </div>
          <button class="btn btn-primary" style="margin-top: 16px;" onclick="saveSettings()">Save Changes</button>
        </div>
        <div class="card" style="margin-bottom: 20px;">
          <h3 class="card-title" style="margin-bottom: 16px;">Notification Preferences</h3>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <label style="display: flex; align-items: center; gap: 12px;">
              <input type="checkbox" checked>
              <div>
                <div style="font-weight: 500;">Appointment Reminders</div>
                <div style="font-size: 13px; color: var(--gray-500);">Get reminders 24 hours before your appointment</div>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 12px;">
              <input type="checkbox" checked>
              <div>
                <div style="font-weight: 500;">Promotional Offers</div>
                <div style="font-size: 13px; color: var(--gray-500);">Receive special deals and discounts</div>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 12px;">
              <input type="checkbox" checked>
              <div>
                <div style="font-weight: 500;">Loyalty Updates</div>
                <div style="font-size: 13px; color: var(--gray-500);">Get notified when you earn or redeem points</div>
              </div>
            </label>
          </div>
        </div>
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 16px;">Communication Method</h3>
          <div style="display: flex; gap: 16px;">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="comm" checked> Email
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="comm"> SMS
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="comm"> Both
            </label>
          </div>
        </div>
      `;
    }

    // ===========================================
    // MODAL FUNCTIONS
    // ===========================================
    function showModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    function hideModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    // Close modal when clicking overlay
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal-overlay')) {
        e.target.classList.remove('active');
        document.body.style.overflow = '';
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay.active').forEach(modal => {
          modal.classList.remove('active');
        });
        document.body.style.overflow = '';
      }
    });

    // ===========================================
    // TOAST NOTIFICATIONS
    // ===========================================
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;

      const icons = {
        success: '&#x2713;',
        error: '&#x2717;',
        info: '&#x2139;'
      };

      toast.innerHTML = `
        <div class="toast-icon">${icons[type]}</div>
        <div class="toast-message">${message}</div>
        <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
      `;

      container.appendChild(toast);

      // Trigger animation
      setTimeout(() => toast.classList.add('show'), 10);

      // Auto remove after 4 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // ===========================================
    // CONFIRMATION DIALOG
    // ===========================================
    let confirmCallback = null;

    function showConfirm(title, message, actionText, callback) {
      document.getElementById('confirm-title').textContent = title;
      document.getElementById('confirm-message').textContent = message;
      document.getElementById('confirm-action').textContent = actionText;
      confirmCallback = callback;
      showModal('modal-confirm');
    }

    document.getElementById('confirm-action')?.addEventListener('click', function() {
      if (confirmCallback) {
        confirmCallback();
        confirmCallback = null;
      }
      hideModal('modal-confirm');
    });

    // ===========================================
    // FORM SUBMISSIONS
    // ===========================================
    function submitAddClient() {
      const name = document.getElementById('client-name').value;
      const owner = document.getElementById('client-owner').value;
      const email = document.getElementById('client-email').value;

      if (!name || !owner || !email) {
        showToast('Please fill in all required fields', 'error');
        return;
      }

      // Simulate API call
      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-add-client');
        showToast(`Client "${name}" added successfully!`, 'success');

        // Clear form
        document.getElementById('client-name').value = '';
        document.getElementById('client-owner').value = '';
        document.getElementById('client-email').value = '';

        // Refresh page
        renderPage(currentPage);
      }, 1000);
    }

    function submitAddService() {
      const name = document.getElementById('service-name').value;
      const price = document.getElementById('service-price').value;

      if (!name || !price) {
        showToast('Please fill in service name and price', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-add-service');
        showToast(`Service "${name}" added successfully!`, 'success');

        // Clear form
        document.getElementById('service-name').value = '';
        document.getElementById('service-description').value = '';
        document.getElementById('service-price').value = '';
        document.getElementById('service-duration').value = '';

        renderPage(currentPage);
      }, 1000);
    }

    function submitAddStaff() {
      const name = document.getElementById('staff-name').value;
      const email = document.getElementById('staff-email').value;

      if (!name || !email) {
        showToast('Please fill in name and email', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-add-staff');
        showToast(`${name} added to your team!`, 'success');

        // Clear form
        document.getElementById('staff-name').value = '';
        document.getElementById('staff-email').value = '';
        document.getElementById('staff-phone').value = '';

        renderPage(currentPage);
      }, 1000);
    }

    function submitAddCustomer() {
      const name = document.getElementById('customer-name').value;
      const email = document.getElementById('customer-email').value;

      if (!name || !email) {
        showToast('Please fill in name and email', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-add-customer');
        showToast(`Customer "${name}" added successfully!`, 'success');

        // Clear form
        document.getElementById('customer-name').value = '';
        document.getElementById('customer-email').value = '';
        document.getElementById('customer-phone').value = '';
        document.getElementById('vehicle-make').value = '';
        document.getElementById('vehicle-model').value = '';
        document.getElementById('vehicle-year').value = '';
        document.getElementById('vehicle-color').value = '';

        renderPage(currentPage);
      }, 1000);
    }

    function submitNewBooking() {
      const customer = document.getElementById('booking-customer').value;
      const service = document.getElementById('booking-service').value;
      const date = document.getElementById('booking-date').value;
      const staff = document.getElementById('booking-staff').value;

      if (!customer || !service || !date || !staff) {
        showToast('Please fill in all booking details', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-new-booking');
        showToast('Booking created successfully!', 'success');

        // Clear form
        document.getElementById('booking-customer').value = '';
        document.getElementById('booking-service').value = '';
        document.getElementById('booking-date').value = '';
        document.getElementById('booking-staff').value = '';
        document.getElementById('booking-notes').value = '';

        renderPage(currentPage);
      }, 1000);
    }

    function submitAddVehicle() {
      const make = document.getElementById('new-vehicle-make').value;
      const model = document.getElementById('new-vehicle-model').value;

      if (!make || !model) {
        showToast('Please fill in vehicle make and model', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-add-vehicle');
        showToast(`${make} ${model} added to your vehicles!`, 'success');

        // Clear form
        document.getElementById('new-vehicle-make').value = '';
        document.getElementById('new-vehicle-model').value = '';
        document.getElementById('new-vehicle-year').value = '';
        document.getElementById('new-vehicle-color').value = '';
        document.getElementById('new-vehicle-plate').value = '';

        renderPage(currentPage);
      }, 1000);
    }

    function submitBookService() {
      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-book-service');
        showToast('Booking confirmed! You will receive a confirmation email shortly.', 'success');
        showPage('cust-appointments');
      }, 1500);
    }

    function submitRedeemPoints() {
      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-redeem-points');
        showToast('Points redeemed! Your reward has been added to your account.', 'success');
        renderPage(currentPage);
      }, 1000);
    }

    function submitSendEmail() {
      const to = document.getElementById('email-to').value;
      const subject = document.getElementById('email-subject').value;
      const message = document.getElementById('email-message').value;

      if (!subject || !message) {
        showToast('Please fill in subject and message', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-send-email');

        const recipients = {
          'all': '156 customers',
          'active': '89 customers',
          'inactive': '45 customers'
        };

        showToast(`Email sent to ${recipients[to]}!`, 'success');

        // Clear form
        document.getElementById('email-subject').value = '';
        document.getElementById('email-message').value = '';
      }, 1500);
    }

    // ===========================================
    // HELPER FUNCTIONS
    // ===========================================
    function switchClient(clientId) {
      currentClient = clientId;
      if (clientId) {
        const client = demoClients.find(c => c.id === clientId);
        showToast(`Viewing: ${client.name}`, 'info');
      }
    }

    function openBookingModal(serviceId, serviceName, servicePrice) {
      document.getElementById('booking-service-name').textContent = serviceName;
      document.getElementById('booking-service-price').textContent = '$' + servicePrice;

      // Set default date to tomorrow
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('book-date').value = tomorrow.toISOString().split('T')[0];

      showModal('modal-book-service');
    }

    function openBookingWithTime(dayIndex, hourStr) {
      // Calculate the date based on day index (0 = today/Sunday in our demo week)
      const baseDate = new Date();
      baseDate.setDate(baseDate.getDate() + dayIndex);
      const dateStr = baseDate.toISOString().split('T')[0];

      // Parse hour string like "9 AM" or "1 PM" to 24h format for select value
      const hourMatch = hourStr.match(/(\d+)/);
      let hour = parseInt(hourMatch[1]);
      if (hourStr.includes('PM') && hour !== 12) hour += 12;
      if (hourStr.includes('AM') && hour === 12) hour = 0;
      const timeStr = hour + ':00'; // Format: "9:00", "13:00", etc.

      // Pre-populate the booking form
      const bookingDate = document.getElementById('booking-date');
      const bookingTime = document.getElementById('booking-time');

      if (bookingDate) bookingDate.value = dateStr;
      if (bookingTime) bookingTime.value = timeStr;

      // Show the day/time in a toast for feedback
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      showToast(`New booking: ${days[dayIndex]} at ${hourStr}`, 'info');

      showModal('modal-new-booking');
    }

    // ===========================================
    // CALENDAR DRAG & DROP
    // ===========================================
    let draggedAppointmentId = null;

    function handleDragStart(event, appointmentId) {
      draggedAppointmentId = appointmentId;
      event.target.style.opacity = '0.5';
      event.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      event.dataTransfer.effectAllowed = 'move';
      event.dataTransfer.setData('text/plain', appointmentId);

      // Add visual feedback to all drop zones
      setTimeout(() => {
        document.querySelectorAll('.calendar-slot').forEach(slot => {
          slot.style.border = '2px dashed var(--gray-300)';
        });
      }, 0);
    }

    function handleDragEnd(event) {
      event.target.style.opacity = '1';
      event.target.style.boxShadow = '';

      // Remove visual feedback from all drop zones
      document.querySelectorAll('.calendar-slot').forEach(slot => {
        slot.style.border = '';
        slot.style.background = slot.dataset.day === '0' ? 'rgba(37, 99, 235, 0.05)' : '';
      });

      draggedAppointmentId = null;
    }

    function handleDragOver(event) {
      event.preventDefault();
      event.dataTransfer.dropEffect = 'move';
      event.currentTarget.style.background = 'rgba(37, 99, 235, 0.15)';
      event.currentTarget.style.border = '2px solid var(--cd-primary)';
    }

    function handleDragLeave(event) {
      const dayIndex = event.currentTarget.dataset.day;
      event.currentTarget.style.background = dayIndex === '0' ? 'rgba(37, 99, 235, 0.05)' : '';
      event.currentTarget.style.border = '2px dashed var(--gray-300)';
    }

    function handleDrop(event, dayIndex, hourStr) {
      event.preventDefault();
      event.stopPropagation();

      const appointmentId = event.dataTransfer.getData('text/plain') || draggedAppointmentId;
      if (!appointmentId) return;

      const appt = demoAppointments.find(a => a.id == appointmentId);
      if (!appt) return;

      // Calculate new date/time
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const dayNames = ['Today', 'Tomorrow', 'Dec 24', 'Dec 25', 'Dec 26', 'Dec 27', 'Dec 28'];

      // Update appointment (in demo, just show confirmation)
      const oldTime = `${appt.date} at ${appt.time}`;
      const newTime = `${dayNames[dayIndex]} at ${hourStr}`;

      // Show confirmation dialog
      showConfirm(
        'Reschedule Appointment',
        `Move "${appt.customer}'s ${appt.service}" from ${oldTime} to ${newTime}?`,
        'Reschedule',
        () => {
          // Update the demo data
          appt.date = dayNames[dayIndex];
          appt.time = hourStr;
          showToast(`Appointment rescheduled to ${days[dayIndex]} at ${hourStr}`, 'success');
          renderPage('cd-calendar');
        }
      );

      // Reset slot styling
      event.currentTarget.style.background = dayIndex === 0 ? 'rgba(37, 99, 235, 0.05)' : '';
      event.currentTarget.style.border = '';
    }

    function openRedeemModal(rewardName, pointsCost) {
      document.getElementById('redeem-reward-name').textContent = rewardName;
      document.getElementById('redeem-points-cost').textContent = 'Cost: ' + pointsCost + ' points';
      document.getElementById('redeem-balance').textContent = (customerData.points - pointsCost).toLocaleString() + ' points';
      showModal('modal-redeem-points');
    }

    function jumpToClient(clientId) {
      const client = demoClients.find(c => c.id === clientId);
      if (client) {
        showToast(`Entering ${client.name} portal...`, 'info');
        setTimeout(() => {
          switchPortal('detailer');
        }, 500);
      }
    }

    function markAppointmentComplete(appointmentId) {
      showConfirm(
        'Complete Appointment',
        'Mark this appointment as completed?',
        'Complete',
        () => {
          showToast('Appointment marked as complete!', 'success');
          renderPage(currentPage);
        }
      );
    }

    function cancelAppointment(appointmentId) {
      showConfirm(
        'Cancel Appointment',
        'Are you sure you want to cancel this appointment? The customer will be notified.',
        'Cancel Appointment',
        () => {
          showToast('Appointment cancelled. Customer has been notified.', 'info');
          renderPage(currentPage);
        }
      );
    }

    function deleteClient(clientId) {
      const client = demoClients.find(c => c.id === clientId);
      showConfirm(
        'Delete Client',
        `Are you sure you want to delete ${client?.name}? This action cannot be undone.`,
        'Delete',
        () => {
          showToast(`${client?.name} has been deleted.`, 'success');
          renderPage(currentPage);
        }
      );
    }

    function suspendClient(clientId) {
      const client = demoClients.find(c => c.id === clientId);
      showConfirm(
        'Suspend Client',
        `Suspend ${client?.name}? Their website and portal access will be disabled.`,
        'Suspend',
        () => {
          showToast(`${client?.name} has been suspended.`, 'info');
          renderPage(currentPage);
        }
      );
    }

    function requestReview(customerId) {
      showToast('Review request sent! Customer will receive an email/SMS.', 'success');
    }

    function saveSettings() {
      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        showToast('Settings saved successfully!', 'success');
      }, 1000);
    }

    // Set default date for booking forms
    function setDefaultBookingDate() {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      const dateStr = tomorrow.toISOString().split('T')[0];

      const bookingDate = document.getElementById('booking-date');
      if (bookingDate) bookingDate.value = dateStr;

      const bookDate = document.getElementById('book-date');
      if (bookDate) bookDate.value = dateStr;
    }

    // ===========================================
    // EDIT APPOINTMENT FUNCTIONS
    // ===========================================
    let currentEditAppointment = null;

    // Open appointment DETAIL popup (view mode)
    function openAppointmentDetail(appointmentId) {
      const appt = demoAppointments.find(a => a.id == appointmentId);
      if (!appt) return;

      currentEditAppointment = appt;

      // Populate detail view fields
      document.getElementById('detail-appt-customer').textContent = appt.customer;
      document.getElementById('detail-appt-vehicle').textContent = appt.vehicle;
      document.getElementById('detail-appt-service').textContent = appt.service;
      document.getElementById('detail-appt-duration').textContent = '~2-3 hours';
      document.getElementById('detail-appt-amount').textContent = '$' + appt.amount;
      document.getElementById('detail-appt-date').textContent = appt.date;
      document.getElementById('detail-appt-time').textContent = appt.time;
      document.getElementById('detail-appt-staff').textContent = appt.staff;
      document.getElementById('detail-appt-notes').value = appt.notes || '';

      // Set status badge
      const statusEl = document.getElementById('detail-appt-status');
      statusEl.textContent = appt.status;
      statusEl.className = 'status-badge status-' + (appt.status === 'confirmed' ? 'active' : appt.status === 'in-progress' ? 'pending' : 'inactive');

      showModal('modal-appointment-detail');
    }

    // Open appointment EDIT modal (edit mode)
    function openEditAppointment(appointmentId) {
      const appt = demoAppointments.find(a => a.id == appointmentId);
      if (!appt) return;

      currentEditAppointment = appt;

      // Populate edit form fields
      document.getElementById('edit-appt-customer').textContent = appt.customer;
      document.getElementById('edit-appt-vehicle').textContent = appt.vehicle;
      document.getElementById('edit-appt-service').textContent = appt.service;
      document.getElementById('edit-appt-date').value = appt.date === 'Today' ? new Date().toISOString().split('T')[0] : '2024-12-23';
      document.getElementById('edit-appt-time').value = appt.time.replace(/[APM ]/g, '').padStart(5, '0');
      document.getElementById('edit-appt-staff').value = appt.staff;
      document.getElementById('edit-appt-status').value = appt.status;
      document.getElementById('edit-appt-price').value = appt.amount;
      document.getElementById('edit-appt-notes').value = appt.notes || '';

      showModal('modal-edit-appointment');
    }

    function submitEditAppointment() {
      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-edit-appointment');
        showToast('Appointment updated successfully!', 'success');
        renderPage(currentPage);
      }, 1000);
    }

    // Detail modal action buttons
    function editFromDetailModal() {
      hideModal('modal-appointment-detail');
      if (currentEditAppointment) {
        openEditAppointment(currentEditAppointment.id);
      }
    }

    function completeFromDetailModal() {
      hideModal('modal-appointment-detail');
      if (currentEditAppointment) {
        openPaymentModal(currentEditAppointment.id);
      }
    }

    function cancelFromDetailModal() {
      hideModal('modal-appointment-detail');
      if (currentEditAppointment) {
        cancelAppointment(currentEditAppointment.id);
      }
    }

    function handlePhotoUpload(input) {
      if (input.files.length > 0) {
        showToast(`${input.files.length} photo(s) uploaded successfully!`, 'success');
      }
    }

    // ===========================================
    // PAYMENT MODAL FUNCTIONS
    // ===========================================
    let currentPaymentAmount = 0;
    let currentTipAmount = 0;

    function openPaymentModal(appointmentId) {
      const appt = demoAppointments.find(a => a.id === appointmentId);
      if (!appt) return;

      currentPaymentAmount = appt.amount;
      currentTipAmount = 0;

      document.getElementById('payment-service').textContent = appt.service;
      document.getElementById('payment-customer').textContent = appt.customer;
      document.getElementById('payment-subtotal').textContent = '$' + appt.amount;
      document.getElementById('payment-tip').textContent = '$0.00';
      document.getElementById('payment-total').textContent = '$' + appt.amount.toFixed(2);

      // Reset tip buttons
      document.querySelectorAll('.tip-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('custom-tip').value = '';

      showModal('modal-payment');
    }

    function setTip(percent) {
      currentTipAmount = currentPaymentAmount * (percent / 100);
      document.getElementById('payment-tip').textContent = '$' + currentTipAmount.toFixed(2);
      document.getElementById('payment-total').textContent = '$' + (currentPaymentAmount + currentTipAmount).toFixed(2);

      // Update active state
      document.querySelectorAll('.tip-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('custom-tip').value = '';
    }

    function updateCustomTip() {
      const customValue = parseFloat(document.getElementById('custom-tip').value) || 0;
      currentTipAmount = customValue;
      document.getElementById('payment-tip').textContent = '$' + currentTipAmount.toFixed(2);
      document.getElementById('payment-total').textContent = '$' + (currentPaymentAmount + currentTipAmount).toFixed(2);

      document.querySelectorAll('.tip-btn').forEach(btn => btn.classList.remove('active'));
    }

    function submitPayment() {
      const method = document.querySelector('input[name="payment-method"]:checked')?.value;
      if (!method) {
        showToast('Please select a payment method', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-payment');
        showToast(`Payment of $${(currentPaymentAmount + currentTipAmount).toFixed(2)} processed successfully!`, 'success');
        renderPage(currentPage);
      }, 1500);
    }

    // ===========================================
    // EDIT CUSTOMER FUNCTIONS
    // ===========================================
    let currentEditCustomer = null;

    function openEditCustomerModal(customerId) {
      const customer = demoCustomers.find(c => c.id === customerId);
      if (!customer) return;

      currentEditCustomer = customer;

      document.getElementById('edit-customer-name').value = customer.name;
      document.getElementById('edit-customer-email').value = customer.email;
      document.getElementById('edit-customer-phone').value = customer.phone;
      document.getElementById('edit-customer-notes').value = customer.notes || '';
      document.getElementById('edit-customer-tags').value = customer.tags?.join(', ') || '';

      // Populate vehicles
      const vehicleList = document.getElementById('edit-customer-vehicles');
      vehicleList.innerHTML = customer.vehicles?.map((v, i) => `
        <div class="vehicle-row" style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
          <input type="text" value="${v.year}" placeholder="Year" style="width: 70px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
          <input type="text" value="${v.make}" placeholder="Make" style="width: 100px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
          <input type="text" value="${v.model}" placeholder="Model" style="width: 100px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
          <input type="text" value="${v.color}" placeholder="Color" style="width: 80px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
          <button type="button" class="btn btn-secondary" onclick="this.parentElement.remove()" style="padding: 6px 10px;"></button>
        </div>
      `).join('') || '';

      showModal('modal-edit-customer');
    }

    function addVehicleRow() {
      const vehicleList = document.getElementById('edit-customer-vehicles');
      const newRow = document.createElement('div');
      newRow.className = 'vehicle-row';
      newRow.style = 'display: flex; gap: 8px; margin-bottom: 8px; align-items: center;';
      newRow.innerHTML = `
        <input type="text" placeholder="Year" style="width: 70px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <input type="text" placeholder="Make" style="width: 100px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <input type="text" placeholder="Model" style="width: 100px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <input type="text" placeholder="Color" style="width: 80px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 6px;">
        <button type="button" class="btn btn-secondary" onclick="this.parentElement.remove()" style="padding: 6px 10px;"></button>
      `;
      vehicleList.appendChild(newRow);
    }

    function submitEditCustomer() {
      const name = document.getElementById('edit-customer-name').value;
      const email = document.getElementById('edit-customer-email').value;

      if (!name || !email) {
        showToast('Name and email are required', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-edit-customer');
        showToast('Customer updated successfully!', 'success');
        renderPage(currentPage);
      }, 1000);
    }

    function openCustomerDetail(customerId) {
      const customer = demoCustomers.find(c => c.id === customerId);
      if (!customer) return;

      currentEditCustomer = customer;

      document.getElementById('cust-detail-name').textContent = customer.name;
      document.getElementById('cust-detail-email').textContent = customer.email;
      document.getElementById('cust-detail-phone').textContent = customer.phone;
      document.getElementById('cust-detail-visits').textContent = customer.visits;
      document.getElementById('cust-detail-spent').textContent = '$' + customer.spent;
      document.getElementById('cust-detail-points').textContent = customer.points.toLocaleString() + ' pts';

      // Show active coupons count
      const customerCoupons = demoRedemptions.filter(r => r.customerId === customer.id && r.status === 'active');
      const tierEl = document.getElementById('cust-detail-tier');
      if (tierEl) {
        tierEl.textContent = customerCoupons.length > 0 ? customerCoupons.length + ' active coupon(s)' : 'No active coupons';
        tierEl.className = 'status-badge status-' + (customerCoupons.length > 0 ? 'active' : 'inactive');
      }

      // Populate vehicles
      const vehiclesList = document.getElementById('cust-detail-vehicles');
      vehiclesList.innerHTML = customer.vehicles?.map(v => `
        <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
          <div style="font-weight: 600;">${v.year} ${v.make} ${v.model}</div>
          <div style="font-size: 13px; color: var(--gray-500);">Color: ${v.color}</div>
        </div>
      `).join('') || '<p style="color: var(--gray-500);">No vehicles on file</p>';

      // Populate service history
      const historyList = document.getElementById('cust-detail-history');
      const customerAppts = demoAppointments.filter(a => a.customer === customer.name).slice(0, 5);
      historyList.innerHTML = customerAppts.length ? customerAppts.map(a => `
        <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--gray-100);">
          <div>
            <div style="font-weight: 500;">${a.service}</div>
            <div style="font-size: 13px; color: var(--gray-500);">${a.date} at ${a.time}</div>
          </div>
          <div style="text-align: right;">
            <div style="font-weight: 600;">$${a.amount}</div>
            <span class="status-badge status-${a.status === 'confirmed' ? 'active' : a.status === 'completed' ? 'active' : 'pending'}">${a.status}</span>
          </div>
        </div>
      `).join('') : '<p style="color: var(--gray-500);">No service history</p>';

      showModal('modal-customer-detail');
    }

    function editFromDetail() {
      hideModal('modal-customer-detail');
      openEditCustomerModal(currentEditCustomer?.id);
    }

    function emailFromDetail() {
      hideModal('modal-customer-detail');
      openIndividualEmail(currentEditCustomer?.id);
    }

    // ===========================================
    // EDIT SERVICE FUNCTIONS
    // ===========================================
    let currentEditService = null;

    function openEditServiceModal(serviceId) {
      const service = demoServices.find(s => s.id === serviceId);
      if (!service) return;

      currentEditService = service;

      document.getElementById('edit-service-name').value = service.name;
      document.getElementById('edit-service-description').value = service.description;
      document.getElementById('edit-service-price').value = service.price;
      document.getElementById('edit-service-duration').value = service.duration;
      document.getElementById('edit-service-category').value = service.category;
      document.getElementById('edit-service-active').checked = service.active;

      showModal('modal-edit-service');
    }

    function submitEditService() {
      const name = document.getElementById('edit-service-name').value;
      const price = document.getElementById('edit-service-price').value;

      if (!name || !price) {
        showToast('Name and price are required', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-edit-service');
        showToast('Service updated successfully!', 'success');
        renderPage(currentPage);
      }, 1000);
    }

    function deleteService() {
      hideModal('modal-edit-service');
      showConfirm(
        'Delete Service',
        `Are you sure you want to delete "${currentEditService?.name}"? This cannot be undone.`,
        'Delete',
        () => {
          showToast('Service deleted successfully!', 'success');
          renderPage(currentPage);
        }
      );
    }

    // ===========================================
    // EDIT STAFF FUNCTIONS
    // ===========================================
    let currentEditStaff = null;

    function openEditStaffModal(staffId) {
      const staff = demoStaff.find(s => s.id === staffId);
      if (!staff) return;

      currentEditStaff = staff;

      document.getElementById('edit-staff-name').value = staff.name;
      document.getElementById('edit-staff-email').value = staff.email;
      document.getElementById('edit-staff-phone').value = staff.phone;
      document.getElementById('edit-staff-role').value = staff.role;

      // Set service checkboxes
      document.querySelectorAll('#edit-staff-services input[type="checkbox"]').forEach(cb => {
        cb.checked = staff.services?.includes(cb.value);
      });

      showModal('modal-edit-staff');
    }

    function submitEditStaff() {
      const name = document.getElementById('edit-staff-name').value;
      const email = document.getElementById('edit-staff-email').value;

      if (!name || !email) {
        showToast('Name and email are required', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-edit-staff');
        showToast('Staff member updated successfully!', 'success');
        renderPage(currentPage);
      }, 1000);
    }

    function removeStaff() {
      hideModal('modal-edit-staff');
      showConfirm(
        'Remove Staff Member',
        `Are you sure you want to remove ${currentEditStaff?.name} from your team?`,
        'Remove',
        () => {
          showToast('Staff member removed successfully!', 'success');
          renderPage(currentPage);
        }
      );
    }

    // ===========================================
    // LOYALTY & POINTS FUNCTIONS
    // ===========================================
    let currentAdjustCustomer = null;

    function showAdjustPointsModal(customerId) {
      const customer = demoCustomers.find(c => c.id === customerId);
      if (!customer) return;

      currentAdjustCustomer = customer;

      document.getElementById('adjust-customer-avatar').textContent = customer.name.split(' ').map(w => w[0]).join('');
      document.getElementById('adjust-customer-name').textContent = customer.name;
      document.getElementById('adjust-current-points').textContent = customer.points.toLocaleString() + ' pts';
      document.getElementById('adjust-points-amount').value = '';
      document.getElementById('adjust-points-reason').value = '';
      document.getElementById('adjust-points-notes').value = '';
      document.getElementById('adjust-type-add').checked = true;
      selectAdjustType('add');

      showModal('modal-adjust-points');
    }

    function selectAdjustType(type) {
      const addLabel = document.getElementById('adjust-type-add-label');
      const subtractLabel = document.getElementById('adjust-type-subtract-label');

      if (type === 'add') {
        document.getElementById('adjust-type-add').checked = true;
        addLabel.style.borderColor = 'var(--cd-primary)';
        addLabel.style.background = '#dbeafe';
        subtractLabel.style.borderColor = 'var(--gray-200)';
        subtractLabel.style.background = 'white';
      } else {
        document.getElementById('adjust-type-subtract').checked = true;
        subtractLabel.style.borderColor = 'var(--cd-primary)';
        subtractLabel.style.background = '#dbeafe';
        addLabel.style.borderColor = 'var(--gray-200)';
        addLabel.style.background = 'white';
      }
    }

    function submitAdjustPoints() {
      const amount = parseInt(document.getElementById('adjust-points-amount').value);
      const reason = document.getElementById('adjust-points-reason').value;
      const isAdd = document.getElementById('adjust-type-add').checked;

      if (!amount || isNaN(amount) || amount <= 0) {
        showToast('Please enter a valid point amount', 'error');
        return;
      }

      if (!currentAdjustCustomer) return;

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        // Actually update the customer points
        if (isAdd) {
          currentAdjustCustomer.points += amount;
        } else {
          currentAdjustCustomer.points = Math.max(0, currentAdjustCustomer.points - amount);
        }

        btn.classList.remove('btn-loading');
        hideModal('modal-adjust-points');

        const action = isAdd ? 'added to' : 'deducted from';
        showToast(`${amount} points ${action} ${currentAdjustCustomer.name}'s account!`, 'success');
        renderPage(currentPage);
      }, 800);
    }

    // ===========================================
    // REWARD & REDEMPTION FUNCTIONS
    // ===========================================
    let currentEditReward = null;
    let currentRedeemCustomer = null;
    let selectedRewardId = null;
    let nextRewardId = 4;

    function updateDiscountTypeUI() {
      const isPercent = document.getElementById('discount-type-percent').checked;
      const percentLabel = document.getElementById('discount-type-percent-label');
      const dollarLabel = document.getElementById('discount-type-dollar-label');
      const valueLabel = document.getElementById('discount-value-label');

      if (isPercent) {
        percentLabel.style.borderColor = 'var(--cd-primary)';
        percentLabel.style.background = '#dbeafe';
        dollarLabel.style.borderColor = 'var(--gray-200)';
        dollarLabel.style.background = 'white';
        valueLabel.textContent = 'Discount Percentage';
      } else {
        dollarLabel.style.borderColor = 'var(--cd-primary)';
        dollarLabel.style.background = '#dbeafe';
        percentLabel.style.borderColor = 'var(--gray-200)';
        percentLabel.style.background = 'white';
        valueLabel.textContent = 'Discount Amount ($)';
      }
    }

    function openAddRewardModal() {
      currentEditReward = null;
      document.getElementById('reward-modal-title').textContent = 'Add Reward';
      document.getElementById('reward-name').value = '';
      document.getElementById('reward-points-cost').value = '';
      document.getElementById('reward-discount-value').value = '';
      document.getElementById('discount-type-percent').checked = true;
      updateDiscountTypeUI();
      showModal('modal-add-reward');
    }

    function openEditRewardModal(rewardId) {
      const reward = demoRewards.find(r => r.id === rewardId);
      if (!reward) return;

      currentEditReward = reward;
      document.getElementById('reward-modal-title').textContent = 'Edit Reward';
      document.getElementById('reward-name').value = reward.name;
      document.getElementById('reward-points-cost').value = reward.pointsCost;
      document.getElementById('reward-discount-value').value = reward.discountValue;

      if (reward.discountType === 'percent') {
        document.getElementById('discount-type-percent').checked = true;
      } else {
        document.getElementById('discount-type-dollar').checked = true;
      }
      updateDiscountTypeUI();
      showModal('modal-add-reward');
    }

    function submitReward() {
      const name = document.getElementById('reward-name').value.trim();
      const pointsCost = parseInt(document.getElementById('reward-points-cost').value);
      const discountValue = parseInt(document.getElementById('reward-discount-value').value);
      const discountType = document.getElementById('discount-type-percent').checked ? 'percent' : 'dollar';

      if (!name) {
        showToast('Please enter a reward name', 'error');
        return;
      }
      if (!pointsCost || pointsCost <= 0) {
        showToast('Please enter a valid points cost', 'error');
        return;
      }
      if (!discountValue || discountValue <= 0) {
        showToast('Please enter a valid discount value', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        if (currentEditReward) {
          // Update existing reward
          currentEditReward.name = name;
          currentEditReward.pointsCost = pointsCost;
          currentEditReward.discountValue = discountValue;
          currentEditReward.discountType = discountType;
          showToast('Reward updated successfully!', 'success');
        } else {
          // Add new reward
          demoRewards.push({
            id: nextRewardId++,
            name,
            pointsCost,
            discountType,
            discountValue,
            active: true
          });
          showToast('Reward created successfully!', 'success');
        }

        btn.classList.remove('btn-loading');
        hideModal('modal-add-reward');
        renderPage('cd-loyalty');
      }, 800);
    }

    function deleteReward(rewardId) {
      showConfirm(
        'Delete Reward',
        'Are you sure you want to delete this reward? Customers will no longer be able to redeem it.',
        'Delete',
        () => {
          const idx = demoRewards.findIndex(r => r.id === rewardId);
          if (idx !== -1) {
            demoRewards.splice(idx, 1);
            showToast('Reward deleted successfully!', 'success');
            renderPage('cd-loyalty');
          }
        }
      );
    }

    function openRedeemPointsModal(customerId) {
      const customer = demoCustomers.find(c => c.id === customerId);
      if (!customer) return;

      currentRedeemCustomer = customer;
      selectedRewardId = null;

      // Update customer info
      document.getElementById('redeem-customer-avatar').textContent = customer.name.split(' ').map(w => w[0]).join('');
      document.getElementById('redeem-customer-name').textContent = customer.name;
      document.getElementById('redeem-customer-points').textContent = customer.points.toLocaleString() + ' pts';

      // Build reward options
      const container = document.getElementById('reward-options-container');
      container.innerHTML = demoRewards.filter(r => r.active).map(reward => {
        const canAfford = customer.points >= reward.pointsCost;
        return `
          <label style="display: flex; align-items: center; padding: 12px; border: 2px solid var(--gray-200); border-radius: 8px; cursor: ${canAfford ? 'pointer' : 'not-allowed'}; opacity: ${canAfford ? '1' : '0.5'};"
                 class="reward-option" data-reward-id="${reward.id}" onclick="${canAfford ? `selectReward(${reward.id})` : ''}">
            <input type="radio" name="selected-reward" value="${reward.id}" style="display: none;" ${!canAfford ? 'disabled' : ''}>
            <div style="flex: 1;">
              <div style="font-weight: 500;">${reward.name}</div>
              <div style="font-size: 12px; color: var(--gray-500);">${reward.discountType === 'percent' ? reward.discountValue + '% off' : '$' + reward.discountValue + ' off'}</div>
            </div>
            <div style="font-weight: 600; color: ${canAfford ? 'var(--cd-primary)' : 'var(--gray-400)'};">${reward.pointsCost} pts</div>
          </label>
        `;
      }).join('');

      // Reset summary and button
      document.getElementById('redeem-summary').style.display = 'none';
      document.getElementById('btn-submit-redemption').disabled = true;

      showModal('modal-redeem-for-customer');
    }

    function selectReward(rewardId) {
      selectedRewardId = rewardId;
      const reward = demoRewards.find(r => r.id === rewardId);
      if (!reward || !currentRedeemCustomer) return;

      // Update visual selection
      document.querySelectorAll('.reward-option').forEach(opt => {
        opt.style.borderColor = 'var(--gray-200)';
        opt.style.background = 'white';
      });
      const selectedOpt = document.querySelector(`.reward-option[data-reward-id="${rewardId}"]`);
      if (selectedOpt) {
        selectedOpt.style.borderColor = 'var(--cd-primary)';
        selectedOpt.style.background = '#dbeafe';
      }

      // Update summary
      const newBalance = currentRedeemCustomer.points - reward.pointsCost;
      document.getElementById('redeem-cost').textContent = '-' + reward.pointsCost + ' pts';
      document.getElementById('redeem-new-balance').textContent = newBalance.toLocaleString() + ' pts';
      document.getElementById('redeem-summary').style.display = 'block';
      document.getElementById('btn-submit-redemption').disabled = false;
    }

    function submitRedemption() {
      if (!selectedRewardId || !currentRedeemCustomer) return;

      const reward = demoRewards.find(r => r.id === selectedRewardId);
      if (!reward) return;

      if (currentRedeemCustomer.points < reward.pointsCost) {
        showToast('Insufficient points!', 'error');
        return;
      }

      const btn = document.getElementById('btn-submit-redemption');
      btn.classList.add('btn-loading');

      setTimeout(() => {
        // Deduct points from customer
        currentRedeemCustomer.points -= reward.pointsCost;

        // Generate coupon code
        const couponCode = generateCouponCode(currentRedeemCustomer.name, reward.discountValue);

        // Create redemption record
        const redemption = {
          id: nextRedemptionId++,
          customerId: currentRedeemCustomer.id,
          customerName: currentRedeemCustomer.name,
          rewardId: reward.id,
          rewardName: reward.name,
          pointsSpent: reward.pointsCost,
          couponCode: couponCode,
          status: 'active',
          redeemedAt: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
          usedAt: null
        };
        demoRedemptions.unshift(redemption);

        btn.classList.remove('btn-loading');
        hideModal('modal-redeem-for-customer');

        // Show success modal with coupon code
        document.getElementById('generated-coupon-code').textContent = couponCode;
        showModal('modal-coupon-success');

        renderPage('cd-loyalty');
      }, 1000);
    }

    function cancelRedemption(redemptionId) {
      const redemption = demoRedemptions.find(r => r.id === redemptionId);
      if (!redemption) return;

      showConfirm(
        'Cancel Redemption',
        `Cancel coupon "${redemption.couponCode}" and refund ${redemption.pointsSpent} points to ${redemption.customerName}?`,
        'Cancel Redemption',
        () => {
          // Refund points to customer
          const customer = demoCustomers.find(c => c.id === redemption.customerId);
          if (customer) {
            customer.points += redemption.pointsSpent;
          }

          // Mark redemption as cancelled
          redemption.status = 'cancelled';

          showToast(`Redemption cancelled. ${redemption.pointsSpent} points refunded to ${redemption.customerName}.`, 'success');
          renderPage('cd-loyalty');
        }
      );
    }

    function viewCustomerRedemptions(customerId) {
      const customer = demoCustomers.find(c => c.id === customerId);
      if (!customer) return;

      // Update header info
      document.getElementById('history-customer-avatar').textContent = customer.name.split(' ').map(w => w[0]).join('');
      document.getElementById('history-customer-name').textContent = customer.name;
      document.getElementById('history-customer-points').textContent = customer.points.toLocaleString() + ' pts';

      // Build redemption history table
      const customerRedemptions = demoRedemptions.filter(r => r.customerId === customerId);
      const tbody = document.getElementById('customer-redemptions-body');

      if (customerRedemptions.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--gray-400);">No redemption history</td></tr>';
      } else {
        tbody.innerHTML = customerRedemptions.map(r => `
          <tr>
            <td>${r.rewardName}</td>
            <td><code style="background: var(--gray-100); padding: 4px 8px; border-radius: 4px; font-size: 12px;">${r.couponCode}</code></td>
            <td>${r.pointsSpent}</td>
            <td>${r.redeemedAt}</td>
            <td>
              <span class="status-badge status-${r.status === 'active' ? 'active' : r.status === 'used' ? 'pending' : 'inactive'}">
                ${r.status === 'active' ? 'Active' : r.status === 'used' ? 'Used' : 'Cancelled'}
              </span>
            </td>
            <td>
              ${r.status === 'active' ? `<button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="cancelRedemption(${r.id})">Cancel</button>` : ''}
            </td>
          </tr>
        `).join('');
      }

      showModal('modal-customer-redemptions');
    }

    function copyCouponCode() {
      const code = document.getElementById('generated-coupon-code').textContent;
      navigator.clipboard.writeText(code).then(() => {
        showToast('Coupon code copied to clipboard!', 'success');
      });
    }

    function emailCouponCode() {
      showToast('Email sent to customer with coupon code!', 'success');
    }

    function exportRedemptions() {
      const headers = ['Customer', 'Reward', 'Coupon Code', 'Points', 'Redeemed Date', 'Status', 'Used Date'];
      const rows = demoRedemptions.map(r => [
        r.customerName,
        r.rewardName,
        r.couponCode,
        r.pointsSpent,
        r.redeemedAt,
        r.status,
        r.usedAt || ''
      ]);

      const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'redemption-history.csv';
      a.click();
      URL.revokeObjectURL(url);
      showToast('Redemption history exported!', 'success');
    }

    // ===========================================
    // INDIVIDUAL EMAIL FUNCTIONS
    // ===========================================
    let currentEmailCustomer = null;

    function openIndividualEmail(customerId) {
      const customer = demoCustomers.find(c => c.id === customerId);
      if (!customer) return;

      currentEmailCustomer = customer;

      document.getElementById('ind-email-to').textContent = customer.email;
      document.getElementById('ind-email-subject').value = '';
      document.getElementById('ind-email-message').value = '';

      showModal('modal-individual-email');
    }

    function loadEmailTemplate() {
      const template = document.getElementById('ind-email-template').value;
      const templates = {
        appointment: {
          subject: 'Your Upcoming Appointment',
          message: `Hi ${currentEmailCustomer?.name.split(' ')[0]},\n\nThis is a reminder about your upcoming appointment with us.\n\nWe look forward to seeing you!\n\nBest regards`
        },
        thankyou: {
          subject: 'Thank You for Your Visit!',
          message: `Hi ${currentEmailCustomer?.name.split(' ')[0]},\n\nThank you for choosing us for your recent car detailing service. We hope you're enjoying your sparkling clean vehicle!\n\nWe'd love to hear your feedback.\n\nBest regards`
        },
        promo: {
          subject: 'Special Offer Just for You!',
          message: `Hi ${currentEmailCustomer?.name.split(' ')[0]},\n\nAs a valued customer, we're excited to offer you an exclusive discount on your next visit!\n\nUse code VALUED20 for 20% off.\n\nBest regards`
        }
      };

      if (templates[template]) {
        document.getElementById('ind-email-subject').value = templates[template].subject;
        document.getElementById('ind-email-message').value = templates[template].message;
      }
    }

    function submitIndividualEmail() {
      const subject = document.getElementById('ind-email-subject').value;
      const message = document.getElementById('ind-email-message').value;

      if (!subject || !message) {
        showToast('Please fill in subject and message', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-individual-email');
        showToast(`Email sent to ${currentEmailCustomer?.name}!`, 'success');
      }, 1500);
    }

    // ===========================================
    // PACKAGE SALE FUNCTIONS
    // ===========================================
    function openSellPackageModal() {
      document.getElementById('package-customer').value = '';
      document.getElementById('package-type').value = '';
      updatePackagePrice();
      showModal('modal-sell-package');
    }

    function updatePackagePrice() {
      const packageType = document.getElementById('package-type').value;
      const prices = {
        'basic-5': { name: 'Basic Wash - 5 Pack', price: 45, savings: 10 },
        'basic-10': { name: 'Basic Wash - 10 Pack', price: 85, savings: 25 },
        'full-5': { name: 'Full Detail - 5 Pack', price: 425, savings: 50 },
        'full-10': { name: 'Full Detail - 10 Pack', price: 800, savings: 150 },
        'unlimited': { name: 'Unlimited Washes - Monthly', price: 79, savings: 40 }
      };

      const priceDisplay = document.getElementById('package-price-display');
      if (prices[packageType]) {
        priceDisplay.innerHTML = `
          <div style="font-size: 24px; font-weight: 700; color: var(--cd-primary);">$${prices[packageType].price}</div>
          <div style="font-size: 13px; color: var(--success);">Save $${prices[packageType].savings}!</div>
        `;
      } else {
        priceDisplay.innerHTML = '<div style="color: var(--gray-400);">Select a package</div>';
      }
    }

    function submitSellPackage() {
      const customer = document.getElementById('package-customer').value;
      const packageType = document.getElementById('package-type').value;

      if (!customer || !packageType) {
        showToast('Please select a customer and package', 'error');
        return;
      }

      const btn = event.target;
      btn.classList.add('btn-loading');

      setTimeout(() => {
        btn.classList.remove('btn-loading');
        hideModal('modal-sell-package');
        showToast('Package sold successfully!', 'success');
        renderPage(currentPage);
      }, 1000);
    }

    // ===========================================
    // FILTER FUNCTIONS
    // ===========================================
    let currentAppointmentFilter = 'all';
    let customerSearchQuery = '';

    function filterAppointments(filter) {
      currentAppointmentFilter = filter;
      renderPage('cd-appointments');
    }

    function searchCustomers(query) {
      customerSearchQuery = query.toLowerCase();
      renderPage('cd-customers');
    }

    // ===========================================
    // EXPORT FUNCTIONS
    // ===========================================
    function exportToCSV(type) {
      showToast(`Exporting ${type} to CSV...`, 'info');

      setTimeout(() => {
        // Simulate download
        const link = document.createElement('a');
        link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent('Sample,CSV,Data\n1,2,3');
        link.download = `${type}-export-${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        showToast(`${type} exported successfully!`, 'success');
      }, 1000);
    }

    // ===========================================
    // INITIALIZE
    // ===========================================
    document.addEventListener('DOMContentLoaded', function() {
      renderPage('ds-dashboard');
      setDefaultBookingDate();
    });
  </script>
</body>
</html>
